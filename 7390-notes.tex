\documentclass{article}

\usepackage{7390-style}

\title{Arithmetic of curves}
\author{Daniel Miller
  \thanks{based on a course taught by David Zywina at Cornell}}
\date{fall 2013}

\begin{document}
\maketitle
\tableofcontents










\section*{Disclaimer}

These notes originated in a course on the arithmetic of curves taught by David 
Zywina at Cornell. However, a significant amount of material (including, no 
doubt, many errors) has been added since then, so their content is \emph{not} 
an exact reflection of what he covered in class. Moreover, the notation has 
been changed in many places (sometimes significantly) as has the order in which 
material is covered. Any errors in these notes are entirely my fault. 










\section{Motivation: plane curves}

Fir a non-constant polynomial $f(x,y)\in\dQ[x,y]$. Assume $f$ is 
geometrically irreducible, that is, irreducible in the ring 
$\overline{\dQ}[x,y]$. We can define the curve $C$ over $\dQ$ determined by the 
equation $f(x,y)=0$. For now, we will think of $C$ in terms of its functor of 
points. To any $\dQ$-algebra $A$, we have $C(A)=\{(a,b)\in A^2:f(a,b)=0\}$. 
As a scheme, $C=\spec\left(\dQ[x,y]/f\right)$. Some big questions are:
\begin{enumerate}
  \item Is $C(\dQ)=\varnothing$?
  \item Is $C(\dQ)$ finite?
  \item Can we compute $C(\dQ)$?
\end{enumerate}
None of these questions can be answered in full generality. 

\begin{example}
Let $f=x^2+y^2-1$, i.e. $C$ is the circle. It is well-known that 
\[
  C(\dQ)=\left\{\left(\frac{1-t^2}{1+t^2},\frac{2t}{1+t^2}\right):t\in\dQ\right\}\cup \{(-1,0)\}
\]
This can be proved in the usual manner by choosing the point $(-1,0)$ in $C$, 
and then drawing lines with rational slopes through $(-1,0)$. As a Riemann 
surface, $C(\dC)$ is a sphere with two points removed. 
\end{example}

\begin{example}
Let $f=x^2+y^2+1$. Then $C(\dR)=\varnothing$, hence $C(\dQ)=\varnothing$. But 
as a Riemann surface, $C(\dC)$ is the same sphere with two points removed. Thus 
the geometry of $C$ does not necessarily determine $C(\dQ)$. 
\end{example}

\begin{example}
Let $f=x^4+y^4-1$. Then it is a theorem of Fermat that 
$C(\dQ)=\{(\pm 1,0),(0,\pm 1)\}$. It is a (much harder) theore of Wiles that if 
$C_n$ is the curve given by $f=x^n+y^n-1$ for $n\geqslant 3$, then 
$Cn(\dQ)=\{(\pm 1,0),(0,\pm 1)\}$. 
\end{example}

\begin{example}[Stoll]
Consider 
\begin{align*}
  C : y^2 = 82342800 x^6 &- 470135160 x^5 + 52485681 x^4 + 2396040466 x^3 \\
    &+ 567207969 x^2 - 985905640 x + 247747600
\end{align*}
This is a curve of genus 2, i.e. $C(\dC)$ is a punctured two-holed 
torus. It turns out that $\# C(\dQ)\geqslant 642$ \cite[\S 6]{st09}. 
However, by a theorem of Faltings, $\# C(\dQ)$ is finite. It is 
currently the largest known number of rational points of a genus two curve 
over $\dQ$. If we take $C:y^2=f(x)$ with $f\in\dQ[x]$ a 
``random'' sextic polynomial, then the expectation is that 
$C(\dQ)=\varnothing$. 
\end{example}

\begin{question}
Does there exist a number $B_g$ such that if a curve $C/\dQ$ has 
genus $g\geqslant 2$, then $\# C(\dQ)\leqslant B_g$?
\end{question}

This is not even known for genus $g=2$. 

\begin{example}
Let $C:y^2=x^3+875 x$. Note that $C(\dQ)$ has the obvious point 
$(0,0)$, and one can do a bit of work to show that this is the only point. 
\end{example}

\begin{example}
Let $C:y^2=x^3+877 x$. Then $C(\dQ)$ once again contains $(0,0)$. A 
computer search showed that $(0,0)$ is the only point on $C$ of height 
$\leqslant 1000000$. For now, the \emph{height} of a solution is just the 
largest absolute value of the numerator / denominator of a solution written 
in reduced fractions. But other methods lead us to expect many more solutions
(infinitely many, in fact). Let $E$ be the projective curve over $\dQ$ obtained 
by adjoining a point $O$ to $C$. As a Riemann surface, $E(\dC)$ is just a 
torus. 

We can give $E/\dQ$ the 
structure of an abelian variety. That is, we can give $E$ the structure of a 
commutative algebraic group, i.e. the operation is given by regular  
functions, with $O$ being the identity. Later, we will think of $E$ as 
being identified with its jacobian $\jac(E)$ via the choice of a single point 
$O\in E(\dQ)$. Since $E$ is a commutative algebraic group, $E(\dQ)$ is an 
abelian group (with identity $O$). It is a theorem of Mordell that $E(\dQ)$ is 
finitely generated. We know the structure of such groups: 
$E(\dQ)\simeq A\times \dZ^r$, where $A$ is finite, and $r=\rank E$ 
is the \emph{(algebraic) rank} of $E$. 

In general, the $A$ is computable. In our case, $A=\dZ/2$. It is much harder to 
compute the algebraic rank of $E$. The Birch and Swinnerton-Dyer 
conjecture says that $r$ agrees with the order of vanishing $r'$ of a certain 
holomorphic function $L(E,s)$ at $s=1$. Sometimes, $r'$ can be computed.  
In our example, a computation shows that $r'=1$, so we expect 
$E(\dQ)\simeq \dZ/2\times\dZ$. In particular, 
$E(\dQ)$ should be infinite. One can show (using other methods) that 
$E(\dQ)=\langle (0,0),(x_0,y_0)\rangle$, where 
\[
  x_0 = \frac{37 5494 5281 2716 2193 1055 0406 9942 0927 9234 6201}{6215 9877 7687 1505 4254 6322 0780 6972 3804 4100}
\]
For details, see \cite{br84}. One method to construct such large solutions for 
a rank one elliptic curve uses Heegner points. 
\end{example}

In general, we will take a curve $C/\dQ$, consider its jacobian $J$, and study 
$J(\dQ)$. This will be a group, and its structure heavily influences $C(\dQ)$. 
For example, we could study how the rank of $J(\dQ)$ affects $C(\dQ)$. In the 
case that $C=E$ is an elliptic curve, $\jac(E)=E$, so studying the curve and 
studying its jacobian is the same thing. The ``average rank of an elliptic 
curve'' is not known, nor is there a general consensus on what is should be. 
Some expect it the rank of a random curve to be $0$ or $1$, both with 
probability $\frac 1 2$. Others suppose that elliptic curves over $\dQ$ have 
rank $2$ with nonzero probability as well. It was proven recently (see 
\cite[\S 1]{bh10}) that 
\[
  \limsup_{x\to\infty} \frac{1}{4 x^2} \sum_{\substack{|a|,|b|\leqslant B \\ 4 a^3+27 b^2\ne 0}} \rank(E_{a,b}) \leqslant\frac 7 6 \text{,}
\]
where $E_{a,b}$ is the elliptic curve over $\dQ$ defined by $y^2=x^3 +a x+b$.

\begin{question}
Is $\rank E(\dQ)$ bounded for all elliptic curves 
$E/\dQ$?
\end{question}

It is known that there are curves with rank at least $28$, but their exact 
ranks are not known \cite{du}. The largest known rank is $19$. 
%It is generally thought that the answer is no, and that the NSA has examples of curves with 
%much larger ranks than publicly known. 

Our assumption that $f(x,y)$ is irreducible is not a serious one. For example, 
if $f=y^2-x^2$, then we can factor $f$ as $(x+y)(x-y)$, and then treat the 
solutions to $x+y=0$ and $x-y=0$ separately. Another example is $f=x^2+y^2$, 
which only factors over $\dQ(i)$ as $(y+i x)(y-i x)$, and we the rational 
points lie in the intersection of the two components over $\dQ(i)$. In general, 
a curve over $\dQ$ will be the union of finitely many geometrically irreducible 
components, each of which is defined over some finite extension of $\dQ$. Also, 
the assumption that $f\in \dQ[x,y]$ is not serious. One can prove that every 
curve $C/\dQ$ embeds into $\dP^2_\dQ$, hence is birational to a plane curve. 

Let $C/\dQ$ be a curve. Then 
$C(\dC)\smallsetminus \{\text{singular points}\}$ is a compact Riemann 
surface with points removed, i.e. it is a torus with $g$ handles with finitely 
many points removed. Call this $g$ the \emph{genus} of $C$. 

\begin{theorem}[Faltings, conjectured by Mordell]
If $C$ is a curve over $\dQ$ with $g\geqslant 2$, then $C(\dQ)$ 
is finite. 
\end{theorem}

For curves of genus $g<2$, $\# C(\dQ)$ can be infinite. In Faltings' 
theorem, $\dQ$ can be replace by any field finitely generated over 
$\dQ$. 

Now let $C$ be a smooth projective curve of genus $g$ over $\mathbb{F}_p$. 
We are interested in $\#C(\mathbb{F}_{p^n})$, which is obviously computable 
for each $n$. Define the \emph{zeta function} of $C$ to be the formal power 
series 
\[
  Z(C,t) = \exp\left( \int\sum_{n\geqslant 1} \# C(\mathbb{F}_{p^n}) t^n\, \frac{dt}{t}\right) \text{.}
\]

\begin{theorem}[Weil]\label{thm:Weil-curve}
If $C/\mathbb{F}_p$ is a smooth projective curve of genus $g$, then 
\[
  Z(C,t) = \frac{P(C,t)}{(1-t)(1-p t)} \text{,}
\]
where $P(C,t)\in \dZ[t]$ has degree $2 g$. Moreover, if 
$P(C,t) = \prod_{i=1}^{2 g} (1-\alpha_i t)$, then for each $i$, one has 
$|\alpha_i|=p^{1/2}$. 
\end{theorem}

The second statement in the theorem is called the \emph{Riemann hypothesis} 
for $C$. It can be used to obtain explicit bounds on the size of 
$C(\mathbb{F}_{p^n})$ as $n\to\infty$. For example, we can compute 
\begin{align*}
  \sum_{n>0} \# C(\mathbb{F}_{p^n}) \frac{t^n}{n} 
    &= \log Z(C,t) \\
    &= -\log(1-t) - \log(1-p t) + \sum_i \log(1-\alpha_t t) \\
    &= \sum_{n>0} \left(p^n+1-\sum_{i=1}^{2 g} \alpha_i^n\right) \frac{t^n}{n} \text{.}
\end{align*}
Therefore, $\# C(\mathbb{F}_{p^n}) = p^n+1-\sum_{i=1}^{2 g} \alpha_i^n$. It 
follows easily that $|\# C(\mathbb{F}_{p^n})-(p^n+1)| \leqslant 2 g p^{n/2}$. 
This is equivalent to saying 
\[
  p^n-2 g p^{n/2}+1 
    \leqslant \# C(\mathbb{F}_{p^n}) 
    \leqslant p^n + 2 g p^{n/2} + 1 \text{.}
\]
In particular, setting $n = g = 1$, we obtain 
$\# C(\mathbb{F}_p) \geqslant (p^{1/2}-1)^2>0$, hence 
$C(\mathbb{F}_p)\ne\varnothing$. 










% notes taken on 09-03-2013

\section{Jacobians and abelian varieties}

%\subsection*{Abelian varieties over $\dC$}

At first, we will work over $\dC$ and treat curves as Riemann surfaces. Since 
the category of smooth projective curves over $\dC$ is equivalent to the 
category of compact connected Riemann surfaces, there is no loss of 
information here. Let's start with some general definitions.

\begin{definition}
A \emph{variety} over a field $k$ is a separated scheme of finite type over 
$\spec(k)$. We call a variety $X/k$ \emph{nice} if it is smooth, projective, 
and geometrically integral.
\end{definition}

Recall that $X/k$ is \emph{geometrically integral} if 
$X_{\bar k}=X\times_k \spec(\bar k)$ is integral. A \emph{curve} is a 
variety of dimension one. If we are interested in $C(k)$ for general curves, 
it is sufficient to consider nice curves. If $X$ is a variety, we can consider 
its functor of points $h_X:\mathsf{Alg}_k\to \mathsf{Set}$ which assigns to a 
$k$-algebra $A$ the set $X(A)$ of ``$A$-valued points.'' This determines a 
functor $h_X:\mathsf{Sch}_k^\circ\to\mathsf{Set}$ which is defined by 
$h_X(Y)=\hom_k(Y,X)$. 

Earlier, for $f\in \dQ[x,y]$ and $C$ defined by the equation $f=0$, we 
defined $C(A)=\{(a,b)\in A^2:f(a,b)=0\}$ for any $\dQ$-algebra $A$. 
Note that 
\begin{align*}
  C(A) &= \{(a,b)\in A^2:f(a,b) = 0\} \\
    &= \hom_{\mathsf{Alg}_\dQ}(\dQ[x,y]/f,A) \\
    &= \hom_{\mathsf{Sch}_k}\left(\spec A,\spec(\dQ[x,y]/f)\right) \text{,}
\end{align*}
so this agrees with our general definition. The functor $h_X$ determines $X$ 
up to isomorphism. (This is just the Yoneda lemma.)






\subsection*{Jacobians over $\dC$}

For the rest of this section, let $C$ be a nice curve over $\dC$. Set 
$X=C(\dC)$; this is a compact connected Riemann surface. So 
topologically, $X$ is a many-handled torus. Let $\Lambda=\h_1(X,\dZ)$, 
the first singular homology group of $X$, which can be identified with 
$\pi_1(X)^\text{ab}$. We will regard elements of $\Lambda$ are equivalence 
classes $[\gamma]$ for $\gamma\in \pi_1(X)$. 

%\begin{remark}
%The notation $\h_\bullet$, $\pi_1$\ldots will always denote the 
%\emph{topological} homology, fundamental group\ldots. For, e.g. 
%etale cohomology, we will write $\h_\text{et}^\bullet(C,\dQ_\ell)$, or 
%$\h_\text{crys}^\bullet(X/\dZ_p)$ for crystalline cohomology.
%\end{remark}

It is a theorem of algebraic topology that $\Lambda\simeq\dZ^{2 g}$; we 
will call $g$ the \emph{genus} of $X$ (and also of $C$). Let $K$ be the field 
of meromorphic functions on $X$. That is, elements of $K$ are of the 
form $f=g/h$ where $g$ and $h$ are holomorphic functions on $X$ and $g\ne 0$. 
(This forces $g\ne 0$ except on a finite subset of $X$.) At any point 
$x\in X$, we can write $f$ in local coordinates as $z^n(a_0+a_1 z+\cdots)$ 
where $a_0\ne 0$ and $n\in\dZ$. We call $n=\ord_x(f)$ the \emph{order 
of vanishing} of $f$ at $x$. The \emph{degree} of $f$ is the sum 
$\deg(f)=\sum_{x\in X}\ord_x(f)$. If $f$ is holomorphic instead of just 
meromorphic, then $\deg(f)=0$.  
 
\begin{remark}
We can identify $K$ with the function field of $C$, i.e.\ the set of rational 
maps $C\to\mathbb{A}^1$. Certainly rational maps yield meromorphic functions, 
and it is a basic theorem of Riemann surface theory that meromorphic functions 
are in fact algebraic. Moreover, if $C$ is nice, then $C$ can be recovered 
from $K$. To do this, pick some $x\in K\smallsetminus \dC$. If we let $A$ be 
the integral closure of $\dC[x]$ in $K$, then $\spec(A)$ will be a 
smooth affine curve. Pick some embedding of $\spec(A)$ into projective space; 
the closure of its image will be a projective curve $C'$ (possibly with 
singularities) with function field $K$. We can resolve the singularities of 
$C'$ to obtain a smooth projective curve $C''$ with function field $K$. 
Clearly $C''$ and $C$ are birational -- in fact this forces them to be 
isomorphic. Indeed, let $f:C''\to C$ be a birational map. By 
\cite[thm 3.1]{mi}, $f$ and $f^{-1}$ are regular, hence $f$ is an 
isomorphism of varieties. 
\end{remark}

One might ask whether the singular homology $\h_1(X,\dZ)$ can be 
defined ``algebraically.'' Essentially, the answer is no -- that is, there is 
no known algebraic definition for $\h_1(X,\dZ)$ that gives the 
``right'' answers. On the other hand, $\h_1(X,\dQ)$ is naturally 
isomorphic to the dual of the algebraic de Rham cohomology 
$\h_\text{dR}^1(X/\dQ)$, and $\h_1(X,\dZ_\ell)$ is naturally 
isomorphic to the dual of the $\ell$-adic cohomology 
$\h_\text{et}^1(X,\dZ_\ell)$. Both of these isomorphisms are hard 
theorems -- the first follows from work of Grothendieck \cite{gr66}, the 
second from \cite[I 4.6.3]{de77}. 

With $C$ as before, let $V=\Omega^1(X)=\h^0(X,\Omega^1)=\h^1_\text{dR}(X)$. 
This is a complex vector space of dimension $g$. (Here, $\h_\text{dR}^1(X,\dC)$ 
is the analytic de Rham cohomology of $C$ -- the algebraic de Rham cohomology 
would be written $\h_\text{dR}^1(C/\dC)$.) This gives us an algebraic 
definition of $g$. We can consider $\Omega^1$ as the sheaf of (algebraic) 
differentials, and $g=\dim_\dC\h^0(X,\Omega^1)$. There is a pairing 
$\h_1(X,\dZ)\otimes\h_\text{dR}^1(X)\to\dC$, defined by 
\[
  [\gamma]\otimes \omega \mapsto \int_\gamma \omega
\]
This pairing is $\dC$-linear in the second component, and is in fact 
non-degenerate. It gives us a map $\Phi:\Lambda\to V^\vee$. 

\begin{definition}[analytic]
The \emph{Jacobian} of $X$ is 
$\jac(X)=V^\vee/\Phi(X) = \h_\textnormal{dR}^1(X)^\vee/\h_1(X,\dZ)$. 
\end{definition}

Is is known that $\Phi(\Lambda)$ is a lattice in $V^\vee$, i.e. it is discrete 
and $V^\vee/\Phi(\Lambda)$ is compact. There is the \emph{Abel-Jacobi map} from 
$X$ to $\jac(X)$ defined as follows. Fix $x_0\in X$; we send $x\in X$ to 
$\omega\mapsto \int_{[x_0,x]} \omega$, where $[x_0,x]$ denotes some path from 
$x_0$ to $x$. A different choice of $[x_0,x]$ will differ by a closed loop, 
i.e. an element of $\h_1(X,\dZ)$. So $X\to\jac X$ is well-defined. Note 
that $\jac X$ is a compact complex Lie group. 

\begin{remark}
After choosing a basis for $V^\vee$, we have $\jac X\simeq \dC^g/L$, where 
$L\simeq \dZ^{2 g}$. As a real Lie group, $\jac X$ is isomorphic to 
$(S^1)^{2 g}$. 
\end{remark}

We care about $\jac X$ because, despite its analytic definition, it is in fact 
a projective variety.

\begin{theorem}
For $X$ a compact Riemann surface, $\jac X$ is algebraic, i.e. there exists a 
variety $J$ defined over $\dC$ such that $J(\dC)\simeq\jac X$ as 
complex manifolds. Moreover, the group operation on $\jac X$ is algebraic, 
i.e. there is a morphism $m:J\times_\dC J\to J$ such that 
$J(\dC)\times J(\dC)\to J(\dC)$ corresponds to the 
addition law on $\jac X$. 
\end{theorem}
\begin{proof}
See \cite[I.18]{mi}. Essentially, $X$ is the analytification of a curve $C$, 
and one proves that $\jac X$ (defined analytically) is isomorphic as a complex 
manifold to the analytification of $\jac C$ (defined algebraically). 
\end{proof}

Let $\divisor X$ be the free abelian group generated by the points of $X$. There 
is a map $\deg:\divisor X\to \dZ$, defined by 
$\sum n_x\cdot x\mapsto \sum n_x$. We define $\divisor^\circ X$ by the short exact 
sequence 
\[\xymatrix{
  0 \ar[r]
    & \divisor^\circ X \ar[r]
    & \divisor X \ar[r]
    & \dZ \ar[r]
    & 0
}\]
There is also a map $\operatorname{div}:K^\times\to \divisor X$, where 
$\operatorname{div}(f) = \sum_x \ord_x(f)\cdot x$. It is a basic fact that 
$\deg(\operatorname{div}(f)) = 0$, so we can define the \emph{Picard group} 
of $X$ to be $\picard X = \divisor X/\operatorname{div}(K^\times)$ and 
$\picard^\circ X = \divisor^\circ (X)/\operatorname{div}(K^\times)$. 

\begin{remark}
Let $\mathscr{M}$ be the sheaf of meromorphic functions on $X$. It is a basic 
fact that $\divisor(X)=\h^0(X,\mathscr{M}^\times/\sO^\times)$ and 
$\picard(X)=\h^1(X,\sO^\times)$. 
\end{remark}

\begin{example}
One can prove that $\picard^\circ(\dP^1) = 0$.
\end{example}

The Abel-Jacobi map $\mu:X\to \jac X$ extends to a map 
$\mu:\divisor^\circ X\to \jac X$. 

\begin{theorem}[Jacobi]
The map $\mu:\divisor^\circ X\to\jac X$ is surjective.
\end{theorem}

\begin{theorem}[Abel]
The kernel of $\mu:\divisor^\circ X\to \jac X$ is $\operatorname{div}(K^\times)$. 
\end{theorem}

It follows that $\mu$ induces an isomorphism $\mu:\picard^\circ X\to \jac X$. 
Note that $\picard^\circ X$ parameterizes invertible sheaves (line bundles) on 
$X$ of degree zero. 

Note that in general, $\dC^g/L$ for some lattice $L$ need not be 
algebraic if $g>1$. In the future, we'll try to define $\jac C$ for a curve 
$C$ over an any field. The variety $\jac C$ will be a nice variety, i.e. 
smooth, projective and geometrically integral. We will use this to give an 
algebraic definition of $\h_1(X,\dZ/n)$. 





% lecture on 09-05-2013
\subsection*{Abelian varieties over arbitrary fields}

Recall that a variety $X/k$ is \emph{nice} if it is smooth, projective, and 
geometrically connected. 

\begin{definition}
Let $k$ be a field. An \emph{abelian variety} over $k$ is a nice group variety 
over $k$.
\end{definition}

In other words, there are morphisms $m:A\times A\to A$, $i:A\to A$, 
$e:\spec(k)\to A$ such that the induced maps $m_*:h_A\times h_A\to h_A$ etc. 
turn $h_A$ into a group-valued functor. In particular, $A(X)$ is an ``honest  
group'' for each $k$-scheme $X$. 

\begin{example}
The general linear group $\operatorname{GL}(n)$ is a group variety, but not 
nice (at least, not in the technical sense) because it is not projective. More 
generally, no linear algebraic group is an abelian variety, for the same 
reason. 
\end{example}

Note that abelian varieties are not required to be commutative, but this is in 
fact the case. This is easy to see over $\dC$. If $A/\dC$ is an 
abelian variety, then $G=A(\dC)$ is a compact connected complex Lie 
group. Let $\mathfrak{g}$ be its Lie algebra. Consider the composite map 
$f:G\xrightarrow{\text{ad}}\operatorname{GL}(\mathfrak{g}) \hookrightarrow 
\End(\mathfrak{g})$, where 
$\operatorname{ad}:G\to\operatorname{GL}(\mathfrak{g})$ is the adjoint 
representation. After picking a basis for $\End(\mathfrak{g})$, 
the components of $f$ are entire holomorphic functions on a compact complex 
manifold, hence locally constant. Since $G$ is connected, $f$ is constant, i.e. 
the adjoint representation of $G$ is trivial. But 
$\ker(\operatorname{ad}) = Z(G)$, so $G$ is commutative. For more details, see 
\cite[I.1]{mu08}. The case $A/k$ for arbitrary $k$ of characteristic zero 
follows from the Lefschetz principle, or one can just prove commutativity 
directly using a ``rigidity principle'' for maps on projective varieties
\cite[I.1.4]{mi}. 





\subsection*{Albanese varieties}

We'd like to describe the jacobian $J$ of a nice curve $C/k$ with 
$C(k)\ne\varnothing$. It will be an abelian variety over $k$ of dimension 
$g$, the genus of $C$. We had only defined the genus of a curve $C/k$ with 
$k\subset \dC$. For an arbitrary field $k$ and a curve $C/k$, set 
$g(C)=h^0(C_{\bar k},\Omega^1) = h^1(\sO_C)$. In general, if $\sF$ is some 
sheaf on a scheme $X$ over $k$, we write $h^i(X,\sF)$ or $h^i(\sF)$ for 
$\dim_k \h^i(X,\sF)$.

\begin{definition}[Albanese]
Let $C/k$ be a curve with fixed $x_0\in C(k)$. The \emph{jacobian} of $C$ is 
an abelian variety $J$ with a morphism $\mu:C\to J$ taking $x_0$ to $0$, such 
that for any morphism $f:C\to A$ to an abelian variety $A$ with $f(x_0)=0$, 
thre is a unique $\tilde f:J\to A$ making the following diagram commute:
\[\xymatrix{
  C \ar[r]^-\mu \ar[dr]_-f 
    & J \ar@{.>}[d]^-{\tilde f} \\
  & A
}\]
\end{definition}

Since $(J,\mu)$ is the solution of a universal problem, it is unique up to 
unique isomorphism. Our definition can be made much more concise. Let 
$\mathsf{AbVar}_k$ be the category of abelian varieties over $k$, and let 
$\mathsf{Var}_{k,\ast}$ be the category of ``nice pointed varieties'' over $k$, 
i.e. nice varieties $X/k$ with chosen $x\in X(k)$. Forgetting the group 
structure gives an inclusion functor 
$\iota:\mathsf{AbVar}_k\to \mathsf{Var}_k$. Our definition of $\jac C$ can be 
rephrased as saying that $\mu:C\to A$ induces a natural isomorphism 
\[
  \hom_{\mathsf{Var}_{k,\ast}}(C,\iota A) \simeq \hom_{\mathsf{AbVar}_k}(\jac C,A)\text{.}
\]
It turns out that for any nice pointed variety $X$, there is an abelian variety 
$A=\operatorname{Alb} X$, the \emph{Albanese variety} of $X$, with a morphism 
$\mu:X\to \operatorname{Alb} X$ that induces a same natural isomorphism (with 
$\operatorname{Alb} X$ in place of $\jac C$). So the jacobian may be seen as 
the left-adjoint to the forgetful functor from abelian varieties to pointed 
varieties. For a proof that $\operatorname{Alb} X$ exists, see 
\cite[A.11]{mo12}.

In general, the map $X\to \operatorname{Alb} X$ need not be an embedding. 
For example, if $C$ is a curve of genus $0$, then $\operatorname{Alb} X=0$ by 
\cite[I.3.9]{mi}. On the other hand, if the genus $g\geqslant 1$, then 
$C\to J$ is an embedding. The map $C(\bar k)\to \picard^\circ(C_{\bar k})$ sends 
a point $x$ to the divisor $[x]-[x_0]$, and one can check that this is 
injective. For, principal divisors correspond to morphisms 
$f:C\to\dP^1$. These cannot have zeros and poles of multiplicity one, 
otherwise $f$ would have degree one, hence it would be an isomorphism. This 
cannot be the case. 

If $C(k)=\varnothing$, we can still define $J=\jac C$. It will be a $k$-variety 
with a morphism $\eta:C\times C\to J$ such that $\mu(\Delta)=0$. We require 
that for any abelian variety $A$ over $k$ with $f:C\times C\to A$ such that 
$f(\Delta)=0$, there is a unique lift $\tilde f:J\to A$ of $f$. The map $\eta$ 
should be thought of $(x,y)\mapsto \mu(x)-\mu(y)$, even though the embedding 
$\mu:C\to J$ may not be defined over $k$. 





\subsection*{Picard schemes}

Another approach to defining $J=\jac C$ involves the Picard group. Recall 
that over $\dC$, we proved that $J(\dC)\simeq\picard^\circ(C)$. 
One might hope that $J$ satisfies $J(L)=\picard^\circ(C_L)$ for all field 
extensions $L/k$. This works if $C(k)\ne\varnothing$, but not otherwise. For, 
if $J(k^s)=\picard^\circ(C_{k^s})$, then we would have 
$\picard^\circ(C) = J(k) = J(k^s)^{G_k} = \picard^\circ(C_{k^s})^{G_k}$. But this 
does not always hold. 

For a curve $C$ over $k$, we will define an abelian variety $\picard^\circ(C)$ in 
terms of its functor of points. To do this, we need to define Picard groups for 
arbitrary schemes. For any scheme $X$, the \emph{Picard group} of $X$ is 
$\picard(X)=\h^1(X,\sO_X^\times)$. It is straightforward to show (using \v Cech 
cohomology) that $\picard(X)$ is isomorphic to the group of isomorphism classes of 
invertible sheaves on $X$, with group operation induced by tensor product, i.e. 
$[\sL] + [\mathscr{L'}] = [\sL\otimes \sL']$. 

Let $C$ be a nice curve. If $D=\sum D_x\cdot x$ is a divisor on $C$, the 
\emph{degree} of $D$ is $\deg D=\sum D_x\in \dZ$. Since $C$ is smooth, Cartier 
divisors are Weil divisors, so $\deg$ induces a well-defined map 
$\picard(C)\to \dZ$. For $T$ an arbitrary scheme, define 
$\picard^\circ(C\times T)$ to be the subset of $\picard(C\times T)$ consisting of 
invertible sheaves $\sL$ with $\deg(\sL_t)=0$ for all $t\in T$. That is, the 
following sequence is exact 
\[\xymatrix{
  0 \ar[r] 
    & \picard^\circ(C\times T) \ar[r]^-{(i_t^*)}
    & \displaystyle\prod_{t\in T} \picard^\circ (C)\text{,}
}\]
where $i_t:t\hookrightarrow T$ are the canonical injections. Now we define the 
functor $\picard_C^\circ:\mathsf{Sch}_k^\circ\to\mathsf{Ab}$ that sends $T$ to 
$\picard^\circ(C\times_k T)/\picard(T)$. 

\begin{theorem}
If $C(k)\ne \varnothing$, then $\picard_C^\circ$ is represented by $J=\jac C$.
\end{theorem}
\begin{proof}
See \cite[III.1.2]{mi}.
\end{proof}

In general, we might have $C(k)=\varnothing$. We will have 
$J(L)=\picard^\circ(C_{L'})^{\gal(L'/L)}$ where $L'/L$ is any separable extension 
with $C(L')\ne\varnothing$. 

The idea behind Weil's original construction is the following. We already 
know that $J=\jac C$ exists, and has a canonical map $\mu:C\to J$. Consider 
$C^g=C\times\cdots\times C$ ($g$-fold product), and consider the map 
$f:C^g\to J$, $f(x_1,\dotsc,x_g)=\mu(x_1)+\cdots+\mu(x_g)$. The symmetric 
group $S_g$ acts on $C^g$, and $f$ is $S_g$-equivariant. The quotient 
$\operatorname{Sym}^g C = C^g/S_g$ exists, and has a map 
$\operatorname{Sym}^g C\to J$. This is birational. Weil defined a ``rational 
group law'' on $\operatorname{Sym}^g C$ using the Riemann-Roch theorem. For 
more details on Weil's construction (and proofs), see \cite[III.7]{mi}. 










% lecture on 09-10-2013
%\section{More abelian varieties}
%\subsection*{Picard schemes}

%Let $k$ be a field, $C/k$ a nice curve, and $J=\jac_C = J_C = \jac C$ be its 
%jacobian. Recall that $J$ is a nice variety that is also a commutative group 
%scheme. We had $J(T) = \picard^\circ(C\times T)/\picard(T)$ for all $k$-schemes $T$, 
%under the assumption that $C(k)\ne \varnothing$. 

Now suppose $X$ is an arbitrary scheme. Recall that 
$\picard(X)=\h^1(X,\sO_X^\times)$; this classifies invertible sheaves on 
$X$, where the group operation on sheaves is $\otimes$. If $X$ is integral, 
$\picard(X)$ is isomorphic to the class group $\operatorname{Cl}(X)$ of Cartier 
divisors (Weil divisors if $X$ is a nice curve). This is easy to prove. Recall 
that if $\mathscr{M}$ is the sheaf of rational functions on $X$, then the 
group of Cartier divisors is $\divisor(X) = \h^0(X,\mathscr{M}^\times/\sO^\times)$. 
The short exact sequence 
\[
  1 \to \sO^\times \to \mathscr{M}^\times\to \mathscr{M}^\times/\sO^\times \to 1
\]
induces a long exact sequence in sheaf cohomology:
\[
  0 \to \h^0(\sO^\times) \to \h^0(\mathscr{M}^\times) \to \divisor(X) \to \picard(X) \to \h^1(\mathscr{M}^\times) \to \cdots
\]
When $X$ is integral, $\mathscr{M}^\times$ is flasque, so 
$\h^1(\mathscr{M}) = 0$, whence 
$\picard(X)=\divisor(X)/\h^0(\sO^\times) = \operatorname{Cl}(X)$. 

For $X/k$ an arbitrary scheme, consider the functor 
$\picard_X:\mathsf{Sch}_k^\circ\to\mathsf{Ab}$ given by 
$\picard_X(T) = \picard(X\times_k T)/\picard(T)$. This is not in general 
representable. However, if $X$ is a nice $k$-variety, then the 
fppf-sheafification of $\picard_X$ is representable \cite[4.1.38]{kl05}. Even 
better, if $X(k)\ne\varnothing$, then $\picard_X$ is representable 
\cite[2.5]{kl05}. We will also denote the representing scheme by $\picard_X$, and 
we call $\picard_X$ the \emph{Picard scheme} of $X$. It is not a variety, but it 
is a disjoint union of ind-varieties \cite[4.8]{kl05}. More precisely, choose 
a very ample line bundle $\sL$ on $X$. If $\sF$ is any coherent 
sheaf on $X$, write 
$\sF(n) = \sF\otimes\sL^{\otimes n}$. Recall that the 
\emph{Euler characteristic} of $\sF$ is 
$\chi(\sF) = \sum (-1)^i h^i(\sF)$. By \cite[2.5.3]{gr61}, 
there is a (unique) polynomial $\phi\in \dQ[t]$ such that 
$\chi\left(\sF(n)\right) = \phi(n)$ for all 
$n\in\dZ$; set $h_\sL(\sF) = \phi$. We call $\phi$ the 
\emph{Hilbert polynomial} of $\sF$. The Hilbert polynomial 
$h_\sL(\sF)$ does depend on $\sL$.

Denote by 
$\picard_X^\phi$ the functor which assigns to a scheme $T$ the subset of 
$\picard_X(T)$ consisting of invertible sheaves $\sF$ on $X\times T$ with 
$h_\sL(\sF_t) = \phi$ for all $t\in T$. By \cite[6.20]{kl05}, 
$\picard_X^\phi$ represents a clopen subscheme of $\picard_X$, and $\picard_X$ is 
covered by the $\picard_X^\phi$. Moreover, the $\picard_X^\phi$ are varieties. We can 
do even better. If we let $\picard_X^d$ send $T$ to the subset of $\picard_X(T)$ 
consisting of invertible sheaves $\sF$ with 
$\deg h_\sL(\sF_t) = d$ for all $t\in T$, then the 
$\picard_X^d$ form a cover of $\picard_X$ by clopen subvarieties. Just as the genus 
of a curve is the dimension of its jacobian, there is a natural isomorphism 
$\h^1(\mathscr{O}_X) \simeq \operatorname{Lie}(\picard_X)$, from which we deduce 
$\dim(\picard_X) = h^1(\mathscr{O}_X)$ when $X$ is nice \cite[5.11]{kl05}.

Unlike the case when $X$ is a curve, it is not always true that 
$\picard_X(\bar k)/\picard_X^\circ(\bar k) = \dZ$. In general, we set 
$\operatorname{NS}(X) = \picard_X(\bar k) / \picard_X^\circ(\bar k)$, and call 
$\operatorname{NS}(X)$ the \emph{N\'eron-Severi group} of $X$. 
Suppose $X=A$ is already an abelian variety over $k$. Then we have 
\[
  \picard_A^\circ(\bar k) = \left\{c\in \picard(A_{\bar k}) : t_a^* c = c\text{ for all }a\in A(\bar k)\right\} 
\]
where $t_a:A_{\bar k}\to A_{\bar k}$ is translation by $a$. See 
\cite[I.8.4]{mi} for a partial proof. 


In any case, the \emph{dual} of $A$ is defined to be $A^\vee = \picard_A^\circ$. 
Each $c\in \picard(A)$ gives a map $\varphi_c:A\to A^\vee$. At the level of 
points, it is defined as $a\mapsto t_a^* c - c$, where if $c=[\sL]$, 
the class $t_a^*c - c\in A^\vee(\bar k) = \picard^\circ(A)$ is represented by 
$[t_a^*\sL\otimes\sL^{-1}]$. 
It turns out that $A^{\vee\vee} \simeq A$, so calling $A^\vee$ the dual of $A$ 
is rather natural. The map $\varphi_c:A\to A^\vee$ is a homomorphism of abelian 
varieties. If $c$ is ample (i.e. the map from $A$ to some projective space 
induced by $n\cdot c$ for $n\gg 0$ is an embedding) then $\varphi_c$ is an 
\emph{isogeny}, where 

\begin{definition}
A homomorphism $\varphi:A\to B$ is an \emph{isogeny} if it is surjective with 
finite kernel.
\end{definition}

It is not at all obvious, but ``$A$ is isogenous to $B$'' is an equivalence 
relation on abelian varieties. The relation is clearly reflexive and 
transitive. To see that it is symmetric, suppose we have an 
isogeny $\varphi:A\to B$. For any ample $c\in \picard(A^\vee)$, $d\in \picard(B)$, 
the composite 
\[\xymatrix{
  B \ar[r]^-{\varphi_d} 
    & B^\vee \ar[r]^-{\varphi^\vee} 
    & A^\vee \ar[r]^-{\varphi_c}
    & A^{\vee\vee} \ar[r]^-\sim 
    & A
}\]
is an isogeny. 

\begin{definition}
Let $A$ be an abelian variety. A \emph{polarization} of $A$ is an isogeny 
of the form $\varphi_c:A\to A^\vee$ for some ample $c\in \picard(A)$.
\end{definition}





%\section{Jacobians revisited}
\subsection*{Recovering a curve from its jacobian}

Let $k$ be a field, $C/k$ a nice curve, and $J=\jac C$ its jacobian. What does 
(the arithmetic of) $J$ tell us about (the arithmetic of) $C$? In particular, 
can we recover $C$ from $J$? In general, $J$ does not determine $C$. For 
example, if $g=g(C)=0$, then $A=0$, and there are many non-isomorphic nice 
curves of genus zero (over a non-algebraically closed field). There are more 
difficult examples with genus $g>0$. 

Suppose we add some data. Assume $g\geqslant 2$ and $C(k)\ne\varnothing$. This 
gives us a map $\mu:C\to J$ determined by $x\mapsto 0$ for some distinguished 
$x\in C(k)$. Consider $\theta = \mu(C)+\cdots + \mu(C)$, where there are $g-1$ 
terms in the sum. It turns out that $\theta$ is an irreducible ample divisor of 
$J$. Thus $\theta$ induces a polarization $\varphi_\theta:J\to J^\vee$. 

\begin{theorem}[Torelli]
If $C,C'$ are nice curves over a field $k$ with $(J,\theta)\simeq (J',\theta')$, 
then $C\simeq C'$ over $k$. 
\end{theorem}

It is known that $\varphi_\theta:J\to J^\vee$ is actually an isomorphism. We 
call a polarization $A\to A^\vee$ \emph{principal} if it is an isomorphism. 

\begin{question}[Schottky]
What pairs $(A,c)$, with $c$ inducing a principal polarization, come from 
jacobians? 
\end{question}

This question has an easy partial answer if we are willing to use heavy 
machinery. Consider the functor $\mathcal{M}_g$ which sends a scheme $S$ to the 
set of isomorphism classes of curves of genus $g$ over $S$. The functor 
$\mathcal{M}_g$ is unfortunately not representable (there is n 
\emph{fine} moduli spaces for curves), but it is nearly so (there is a 
\emph{coarse} moduli space). That is, there is a scheme (a variety, 
actually) $M_g$ together with a natural transformation 
$\mathcal{M}_g\to h_{M_g}$ such that $\mathcal{M}_g(L)\to h_{M_g}(L)$ is a 
bijection whenever $L$ is an algebraically closed field, and such that 
$\mathcal{M}_g\to h_{M_g}$ is initial among all morphisms from $\mathcal{M}_g$ 
to representable functors. For a proof, see \cite[5]{mu94}. Along the same lines, 
we can let $\mathcal{A}_g$ be the functor which assigns to a scheme $S$ the set 
of isomorphism classes of principally polarized abelian schemes of dimension 
$g$ over $S$. The functor $\mathcal{A}_g$ has a coarse moduli space $A_g$. 

The operation ``take jacobian'' induces a natural transformation 
$j:\mathcal{M}_g\to\mathcal{A}_g$, and Torelli's theorem can be rephrased as 
saying that $j$ is injective. Shottky's question asks what the image of $j$ is. 
To see that it cannot be all of $\mathcal{A}_g$, simply note that 
$\dim(M_g) = 3 g - 3$, while $\dim(A_g) = \frac{g(g+1)}{2}$. For 
$g>3$, $A_g$ has greater dimension than $M_g$, so 
$j:M_g(\bar\dQ)\to A_g(\bar\dQ)$ cannot possibly be surjective. On the other 
hand, for $g\leqslant 3$, all principally polarized abelian varieties are 
jacobians (possibly after a change of the polarization). 

One might hope that all abelian varieties are at least isogenous to jacobians. 
While this is true for dimension $d\leqslant 3$, it is not true in general. 
In fact, for all $d>3$, there exists an abelian variety of dimension $d$ over 
$\overline{\dQ}$ which is not isogenous to a jacobian. This was proven 
recently in \cite{ts12}

\begin{example}[group law on elliptic curves]
Let $k$ be field of characteristic not $2$ or $3$. Let $E$ be an elliptic curve 
of the form $y^2=x^3+a x+b$ with $4 a^3+27 b^2\ne 0$. That is, $E$ is the 
subset of $\dP_k^2$ given by 
\[
  x_1^2 x_2 - x_0^3 - a x_0 x_2^2 - b x_2^3 \text{.}
\]
The choice of $O=(0:1:0)\in E(k)$ induces an embedding $j:E\to \jac(E)$ which 
is an isomorphism by the Riemann-Roch theorem. We would like to relate the 
induced group operation on $E$ with the classical definition using chords and 
tangents. 

Let $P,Q\in E(\bar k)$. If we assume $P,Q\ne O$, then we can write 
$P=(P_0:P_1:1)$, $Q=(Q_0:Q_1:1)$. Assume $P_0\ne Q_0$. Then there is a 
canonical rational function $\ell_{P,Q}$ with both $P$ and $Q$ as zeros. One 
has  
\[
 \ell_{P,Q}(x_0:x_1:x_2) = \frac{Q_1-P_1}{Q_0-P_0} \cdot \frac{x_0}{x_2} - \frac{x_1}{x_2} + \frac{P_1 Q_0 - P_0 Q_1}{Q_0-P_0} \text{.}
\]
The function $\ell_{P,Q}$ has $P$, $Q$ and a third point $R$ as simple zeros, 
and one can verify directly that 
$\operatorname{div}(\ell_{P,Q})=P+Q+R-3 O = (P-O)+(Q-O)+(R-O)$. Recall that 
$(\jac E)(\bar k)=\picard^\circ(E_{\bar k})$, and the map $j:E\to \jac(E)$ 
corresponds to $P\mapsto P-O$. Thus 
$j(P)+j(Q)+j(R)=\operatorname{div}(\ell_{P,Q})=0$ in 
$\picard^\circ(E_{\bar k})$, i.e. $j(P)+j(Q)=-j(R)$. 

It is well-known that $R$ can be written as a rational function of $P$ and $Q$, 
so the chord-tangent law defines a rational map $m:E\times E\to E$ with 
$j(m(P))+j(m(Q))=m(j(P),j(Q))$. It follows that $m$ is defined everywhere. 
\end{example}










% notes on 09-12-2013
\section{The Mordell-Weil theorem}

Let $k$ be a number field, i.e. $k$ is a finite extension of $\dQ$. Important 
examples are $k=\dQ(\sqrt d)$ and $\dQ(\zeta_{p^n})$. 

\begin{theorem}[Mordell-Weil]
Let $A$ be an abelian variety over a number field $k$. Then the abelian group 
$A(k)$ is finitely generated.
\end{theorem}

Note that is clearly false if $k=\dC$, for then $A(\dC)$ is a complex Lie 
group, hence uncountable. In fact, whenever $k$ is a local field, $A(k)$ is a 
Lie group over $k$, hence uncountable. The Mordell-Weil theorem actually holds 
whenever $k$ is finitely generated over its prime field. Basic algebra shows 
that $A(k) = A(k)_\text{tors}\oplus \dZ x_1\oplus \cdots \oplus \dZ x_r$, where 
the $x_i$ are linearly independent over $\dZ$. We call $r=\rank A$ 
the \emph{rank} of $A$. Mordell proved the theorem for $A=E/\dQ$ an elliptic 
curve, demonstrating an assertion of Poincar\'e.
%Mordell 1922, Poincare 1901

\begin{example}
Let $E\subset \dP_\dQ^2$ be the projective closure of the affine curve 
defined by $y=x^3+2 x+3$, with $O=(0:0:1)$ the point at infinity. The curve 
has a group law where $a+b+c=0$ if and only if $a,b,c$ are colinear. 
Alternatively, there is a unique map $E\hookrightarrow J_E$ with $O\mapsto 0$; 
this is an isomorphism, and we can use it to transfer the group structure of 
$J_E$ to $E$. The curve $E$ has an obvious rational point $(-1,0)$ of order 
two. Another rational points is $(3,6)$. Their sum is 
$\left(\frac 1 4,-\frac{15}{16}\right)$. One can show that 
$E(\dQ) = \langle (-1,0)\rangle \oplus \langle (3,6)\rangle$, where 
$(-1,0)$ has order two and $(3,6)$ has infinite order. So 
$E(\dQ) = \dZ/2\oplus \dZ$. 
\end{example}

\begin{example}
Let $E/\dQ$ be the projective closure of $y^2+y = x^3+x^2 - 2 x$. We claim 
that $E(\dQ) = \langle (0,0),(1,0)\rangle$. As an exercise, try to find ten 
more points in $E(\dQ)$. 
\end{example}

One thing that motivated Weil is the following conjecture of Mordell (now a 
theorem of Faltings). 

\begin{theorem}[Faltings]
If $C$ is a nice curve over a number field $K$ with genus $g\geqslant 2$, then 
$C(k)$ is finite.
\end{theorem}

Note that Mordell's conjecture definitely fails if $g\leqslant 1$. For $g=0$, 
$\dP^1$ has lots of rational points, and we have seen examples of 
elliptic curves with infinitely many rational points. Here is a heuristic. 
Assume $C(k)\ne\varnothing$ and consider the canonical embedding 
$C\hookrightarrow J$. We have $C(k)=C\cap J(k)$. The set $C$ has positive 
codimension, and $J(k)$ is a finitely generated abelian group. So 
$C(k)$ is the intersection of two ``sparse'' subsets of $J$. One would expect 
this forces $C(k)$ to be small. This heuristic is validated by the following 
theorem, which was conjectured by Mordell and Lang.

\begin{theorem}[Faltings]
Let $A$ be an abelian variety over an algebraically closed field $k$, and let 
$\Gamma$ be a finitely generated subgroup of $A(k)$. If $X\subset A$ is a 
subvariety, then there is a finite set $S\subset \Gamma$ and a finite set 
$\{B_s:s\in S\}$ of abelian subvarieties of $A$ contained in $X$ such that 
\[
  X(k)\cap \Gamma = \bigcup_{s\in S} \left(s+ B_s(k)\cap \Gamma\right)
\]
\end{theorem}
A proof in the case $k=\dC$ can be found in \cite{mc95}, who proves the theorem 
for more general group varieties than abelian varieties. 

\begin{corollary}
Let $A$ be an abelian variety over $\dC$, let $C$ be a nice curve in $A$ of 
genus $g\geqslant 2$. Let $\Gamma$ be a finitely generated subgroup of 
$A(\dC)$. Then $C(\dC)\cap \Gamma$ is finite. 
\end{corollary}
\begin{proof}
Since $C$ has genus $g\geqslant 2$, it cannot contain a nontrivial abelian 
variety. Thus each $B_s = 0$, so the theorem yields $C(\dC)\cap \Gamma = S$ 
for some finite set $S\subset \Gamma$. 
\end{proof}

There is a relative version of the Mordell-Lang conjecture known as the 
\emph{Lang-N\'eron theorem}. Let $K/k$ be a \emph{regular} field extension, 
that is, $\bar k\cap K = k$ and $K/k$ is separable. If $A$ is an abelian 
variety defined over $K$, then there is an abelian variety 
$\trace_{K/k}(A)$ defined over $k$ together which a morphism 
$\tau:\trace_{K/k}(A)_K\to A$ that is initial among abelian 
varieties $B/k$ with morphisms $B_K\to A$. One calls 
$\trace_{K/k}(A)$ the \emph{$K/k$-trace of $A$}. Intuitively, 
$\trace_{K/k}(A)$ is the smallest abelian subvariety of $A$ defined 
over $k$. A proof of the following theorem can be found in \cite{co06}. 

\begin{theorem}[Lang-N\'eron]
Let $K/k$ be a finitely generated regular extension, and let $A$ be an abelian 
variety over $K$. Then the group $A(K)/\trace_{K/k}(A)(k)$ is 
finitely generated.
\end{theorem}

This implies the Mordell-Weil theorem for finitely generated fields. If $K$ is 
a finitely generated field, let $k$ be the algebraic closure of the prime field 
of $K$ within $K$. Then $K/k$ is regular, and by the usual Mordell-Weil 
theorem, $\trace_{K/k}(A)(k)$ is finitely generated, so $A(K)$ has a 
finitely generated subgroup with finitely generated quotient. It follows that 
$A(K)$ is finitely generated.

\begin{proof}[Proof of Mordell-Weil]
Let $A$ be an abelian variety over a number field $k$. Our proof has three 
parts:
\begin{enumerate}
  \item construct a ``height function'' $|\cdot|:A(k)\to \dR_{\geqslant 0}$ 
    with good properties
  \item prove the weak Mordell-Weil theorem: $A(k)/n A(k)$ is finite for all 
    $n\geqslant 2$
  \item show that 1 and 2 formally imply the full Mordell-Weil theorem 
\end{enumerate}
We will prove 3 here, defer 2 to the next section, and cite a source for 1. 
Suppose $A$ is an arbitrary abelian group with a function 
$|\cdot|:A\to \dR_{\geqslant 0}$ satisfying 
\begin{itemize}
  \item for any $c>0$, the set $B_c = \{x\in A:|x|\leqslant c\}$ 
    is finite
  \item we have $|x-y|\leqslant |x|+|y|$ and $|n x|=n |x|$ for all 
    $x\in A$ and some $n\geqslant 2$
  \item for the same $n\geqslant 2$, the group $A/n$ is finite
\end{itemize}
We will prove that $A$ is finitely generated. Let $\{a_i\}$ be a (finite) set 
of coset representatives for $A/n$. Let $c=2\sup \{|a_i|\}$. We claim that $A$ 
is generated by the finite set $B_c$. This will be shown by 
descent. Let $x_1\in A$. By our assumptions, we can write 
$x_1 = y_{i_1} + n x_2$, and one see that 
\[
  |x_2| = \frac 1 n |x_1 - y_{i_1}| 
    \leqslant \frac{|x_1| + |y_{i_1}|}{n} 
    \leqslant \frac 1 n |x_1| + \frac{c}{2 n}
\]
Setting $x_{r+1} = y_{i_r} + n x_r$, we can continue this process, obtaining 
the inequality 
\[
  |x_{r+1}| \leqslant \frac 1 n |x_r| + \frac{c}{2 n}
    \leqslant \frac{1}{n^r} |x_1| + \frac 1 2\left(\frac 1 n + \cdots + \frac{1}{n^r}\right) c 
    \leqslant \frac{|x_1|}{n^r} + \frac c 2
\]
For $r\gg 0$, the quantity on the right is less than $c$. Thus $x_1$ is in the 
subgroup of $A$ generated by $B_c$ and $\{a_i\}$. Since $|a_i|\leqslant c$ for 
each $i$, we have $A=\left\langle B_c\right\rangle$. 
\end{proof}

We will prove the existence of a height function on $A(k)$ satisfying the 
desired properties in section \ref{sec:heights}. Very briefly, there is a 
canonical height function on $\dP^n(\bar k)$ defined by  
\[
  h(x_0:\cdots:x_n) = \frac{1}{[L:k]} \sum_v \log \sup\{|x_i|_v\} \text{,}
\]
where $L/k$ is some extension containing the $x_i$ and $|\cdot|_v$ is the 
normalized absolute value associated with $v$. For a very ample divisor $c$ on 
$A$, we get an embedding $\varphi_c:A\to \dP^n$, and thus a height function 
$h_c:A(\bar k)\to \dR_{\geqslant 0}$. As it stands, this is not well-defined, 
but there is a canonical way of adjusting $h_c$ by a bounded function on 
$A(\bar k)$ to get a function $\widehat h_c:A(\bar k)\to \dR$ such that 
\[
  (x,y)\mapsto \langle x,y\rangle_{\widehat h_c} = \widehat h_c(x+y) - \widehat h_c(x) - \widehat h_c(y)
\]
is bilinear. One calls $\widehat h_c$ the \emph{N\'eron-Tate height} associated 
with $c$. The function $|\cdot|$ in the proof is the absolute value 
$|\cdot|_c=\widehat h_c^{1/2}$ for any very ample even divisor $c$.





Our proof is very nearly effective. Given a set of generators for 
$A(k)/n A(k)$, it gives an algorithm for finding a set of generators for 
$A(k)$. Moreover, one can choose any $n$. Most people use $n = 2$ when doing 
computations. In the next section, we will give a proof of the weak 
Mordell-Weil theorem using Galois cohomology. Let $\bar k$ be the algebraic 
closure of $k$, and let  $G_k = \gal(\bar k/k)$ be the absolute Galois group of 
$k$. The abelian group $A(\bar k)$ has a continuous $G_k$-action. One way to 
see this is to embed $A$ into some $\dP^N$, and let $G_k$ act on 
coordinates. A fancier way to see this is to note that 
$A(\bar k) = \hom(\spec(\bar k),A)$, so if $\sigma\in G_k$, $x\in A(\bar k)$, 
the point $^\sigma x$ is the composite 
$\spec(\bar k)\xrightarrow{\sigma^*} \spec(\bar k) \xrightarrow{x} A$. 

Let $A[n]$ be the kernel of $\cdot n : A(\bar k)\to A(\bar k)$. We can take 
$G_k$-invariants of $A[n]$. We get an exact sequence 
\[\xymatrix{
  0 \ar[r] 
    & A[n]^{G_k} \ar[r] 
    & A(k) \ar[r]^-n 
    & A(k)
}\]
We are interested in continuing this exact sequence to the right, i.e. in 
constructing a long exact sequence 
\[
  0 \to A[n]^{G_k} \to A(k) \to A(k) \to \h^1(G_k,A[n]) \to \h^1\left(G_k,A(\bar k)\right)\to \h^1\left(G_k, A(\bar k)\right) \to \h^2\left(G_k, A[n]\right) \to \cdots
\]
This fits into a general framework of derived functors, but we will mostly 
just use the concrete definition of $\h^\bullet(G_k,-)$ using cocycles and 
coboundaries. 










% lecture 09-17-2013
\section{Group cohomology}

Eventually we'll get to Selmer groups and the weak Mordell-Weil theorem, but 
first we need to discuss group cohomology. Let $k$ be a number field, $\bar k$ 
an algebraic closure of $k$, and $G_k=\gal(\bar k/k)$ the \emph{absolute Galois 
group} of $k$. This is a \emph{profinite group} (compact, totally connected 
Hausdorff group) with a basis of neighborhoods of $1$ being the groups 
$G_L=\gal(\bar k/L)$ where $L$ ranges over the finite extensions of $k$. Let 
$A$ be an abelian variety over $k$ of dimension $d\geqslant 1$. There is no 
harm in thinking of $k=\dQ$ and $A$ as an elliptic curve. 

The homomorphism $A\xrightarrow n A$ that sends $x$ to $n\cdot x$ is an 
isogeny. Let $A[n]$ be the $n$-torsion subgroup of $A(\bar k)$, i.e. 
\[
  A[n] = \{x\in A(\bar k) : n\cdot x = 0\}
\]
If $k$ were a field of positive characteristic $p$ and $p\mid n$, it would be 
better to think of $A[n]$ as the scheme $A\times_A 0$ via $n:A\to A$. In any 
case, there is an exact sequence 
\[\xymatrix{
  0 \ar[r] 
    & A[n] \ar[r] 
    & A(\bar k) \ar[r]^-n 
    & A(\bar k) \ar[r] 
    & 0
}\]
Recall that if $G$ is an arbitrary group acting on some abelian group $M$, we 
define $M^G=\{m\in M:\sigma m = m\forall \sigma\in G\}$, the module of 
\emph{$G$-invariants} of $M$. Taking $G_k$-invariants of the above short exact 
sequence, we get an exact sequence 
\[\xymatrix{
  0 \ar[r] 
    & A[n]^{G_k} \ar[r] 
    & A(k) \ar[r]^-n 
    & A(k)
}\]
We don't have exactness on the right because $(-)^{G_k}$ is only left exact in 
general. More concretely, if $A(k)\xrightarrow n A(k)$ were always surjective, 
then $A(k)$ would be a divisible abelian group, which contradicts the fact that 
if $k$ is a number field, then $A(k)$ is finitely generated. 

We can define $\h^\bullet(G_k,A[n])$ using derived functors. Consider the 
category $G_k\text{-}\mathsf{Mod}$ of (discrete) abelian groups with continuous 
$G_k$-action. This is an abelian category with enough injectives. The functor 
$\Gamma=(-)^{G_k}:G_k\text{-}\mathsf{Mod}\to \mathsf{Ab}$ is left-exact, we we 
define the group cohomology as the derived functors of $\Gamma$, i.e. 
$\h^\bullet(G_k,-) = \mathsf{R}^\bullet \Gamma$. In particular, 
$\h^0(G_k,M) = M^{G_k}$ for any discrete $G_k$-module $M$. 

Choose $x\in A(k)$. Then $x=n\cdot y$ for some $y\in A(\bar k)$. Take 
$\sigma\in G_k$. Then $x=\sigma x$, so $\sigma(n\cdot y) = n\cdot \sigma(y)$. 
Then $n\cdot (\sigma y - y) = n\cdot \sigma y - n\cdot y = 0$, so 
$\sigma y-y\in A[n]$. Thus we have a map (\emph{not} a usually a homomorphism) 
$\varphi:G_k\to A[n]$, $\sigma\mapsto \sigma y - y$. Take $\sigma,\tau\in G_k$. 
Then one computes 
\begin{align*}
  \varphi(\sigma\tau) &= \sigma\tau(y) - y \\
    &= \sigma(\tau y - y) + \sigma y -y \\
    &= \sigma\varphi(\tau) + \varphi(\sigma)
\end{align*}
So $\varphi$ is a homomorphism exactly when the action of $G_k$ on 
$A[n]$ is trivial. Moreover, there is a number field $L/k$ such that 
$G_L\subset G_k$ fixes $y$. In particular, $\varphi(G_L)=0$, i.e. the map 
$\varphi:G_k\to A[n]$ is continuous. Suppose we choose some $y'$ distinct from 
$y$ with $x=n\cdot y'$. We could define $\varphi':G_k\to A[n]$ by 
$\sigma\mapsto \sigma y'-y'$. Since $n(y-y')=0$, we have $y'-y\in A[n]$, hence 
$y'=y+\alpha$ for some $\alpha\in A[n]$. We now have 
\begin{align*}
  \varphi'(\sigma) &= \sigma y'-y' \\
    &= \sigma(y+\alpha) - (y+\alpha) \\
    &= \sigma y - y + \sigma\alpha-\alpha \\
    &= \varphi(\sigma) + \sigma \alpha-\alpha
\end{align*}
Maps $G_k\to A[n]$ of the form $\sigma\mapsto \sigma \alpha-\alpha$ will be 
called \emph{coboundaries}. 

Suppose we have another point $x'\in A(k)$. Choose a $y'$ with $x'=n y'$. Then 
$x+x'=n(y+y')$, and the point $x+x'$ gives rise to a map $G_k\to A[n]$, 
$\sigma\mapsto \sigma(y+y')-(y+y')$; this map is just $\varphi+\varphi'$, where 
$\varphi':\sigma\mapsto \sigma y'-y$. 

\begin{definition}
Let $G$ be a profinite group, $M$ a discrete $G$-module. The group $Z^1(G,M)$ 
of \emph{$1$-cocycles} consists of continuous maps $\varphi:G\to M$ such that 
$\varphi(\sigma\tau)=\sigma\varphi(\tau)+\varphi(\sigma)$. The group $B^1(G,M)$ 
of \emph{$1$-coboundaries} consists of continuous maps $\varphi:G\to M$ of the 
form $\sigma\mapsto \sigma\alpha-\alpha$ for some $\alpha\in M$. The 
\emph{first cohomology of $G$ with coefficients in $M$} is 
\[
  \h^1(G,M) = Z^1(G,M) / B^1(G,M)
\]
\end{definition}
One can prove using a canonical projective resolution of $M$ that this agrees 
with the derived functor definition.One can check directly that if 
$0\to M'\xrightarrow f M\xrightarrow g M''$ is an exact sequence of 
$G_k$-modules, then there is a natural exact sequence:
\[\xymatrix{
  0 \ar[r] 
    & {M'}^G \ar[r]^-f
    & M^G \ar[r]^-g
    & {M''}^G \ar[r]^-\delta
    & \h^1(G,M') \ar[r]^-{f_*}
    & \h^1(G,M) \ar[r]^-{g_*}
    & \h^1(G,M'')
}\]
where $\delta(x)$ is defined as follows. Choose a lift $\tilde x$ in 
$M$, and let $\delta(x)(\sigma) = f^{-1}(\sigma \tilde x - \tilde x)$. One can 
check that this is a cocycle, and that choosing a different $\tilde x$ changes 
$\delta(x)(\sigma)$ by a coboundary. 

If $G$ is a discrete group, then the cohomology $\h^\bullet(G,M)$ can be 
interpreted as an $\operatorname{Ext}$-group. It is easy to see that the 
category of $G$-module is equivalent to the category of $\dZ[G]$-modules, and 
that $M^G\simeq \hom_{\dZ[G]}(\dZ,G)$. It follows that 
$\h^\bullet(G,M)\simeq \operatorname{Ext}_{\dZ[G]}^\bullet(\dZ,M)$. If $G$ is a 
profinite group, then $\dZ[G]$ is the wrong ring to use. Instead, one considers 
the \emph{completed group ring} 
\[
  \dZ\llbracket G\rrbracket = \varprojlim_{\substack{N\triangleleft G \\ N\text{ open}}} \dZ[G/N]
\]
where we give each $\dZ[G/n]$ the discrete topology and 
$\dZ\llbracket G\rrbracket$ the inverse limit topology. The category of 
discrete $G$-modules with continuous action is equivalent to the category of 
discrete $\dZ\llbracket G\rrbracket$-modules with continuous action, 
$M^G\simeq \hom_{\dZ\llbracket G\rrbracket}(\dZ,M)$, whence 
$\h^\bullet(G,M) \simeq \operatorname{Ext}_{\dZ\llbracket G\rrbracket}^\bullet(\dZ,M)$. 

In the case that $G=G_k$, one can interpret the groups $\h^\bullet(G,M)$ as a 
special case of \'etale cohomology. Recall that a morphism $f:X\to S$ of 
schemes is \emph{\'etale} if it is flat and unramified. The \emph{\'etale 
site} of $S$, denoted $\et S$, is the full subcategory of $\mathsf{Sch}_S$ 
consisting of $X\to S$ that are \'etale. A collection $\{f_i:U_i\to X\}$ in 
$\et S$ is a \emph{cover} if the images of the $f_i$ cover $X$. With this 
notion of a cover, $\et S$ is a (subcanonical) site, so we can talk about 
sheaves and cohomology on $\et S$. There are two key examples. If $k$ is a 
field, write $\et k$ for $\et{\spec(k)}$. Then the objects of $\et k$ are all 
of the form $\spec(L_1)\sqcup \cdots \sqcup \spec(L_n)\to \spec(k)$ for a 
finite family of separable field extensions $L_1,\dots,L_n$ of $k$. One can 
check that the category $\sheaf(\et k)$ of abelian sheaves on $\et k$ is 
equivalent to the category of discrete $G_k$-modules, via the functor 
$\sF\mapsto \sF_{\bar k} = \varinjlim_{L/k} \sF(\spec L)$, where $L$ ranves 
over all finite Galois extensions of $k$. If $M$ is a $G_k$-module, then there 
is a corresponding \'etale sheaf $\widetilde M$, determined by 
$\widetilde M(\spec L) = M^{G_L}$. Since 
$M^G\simeq \h^0(\et k,\widetilde M)$, we obtain that 
$\h^\bullet(G_k,M) \simeq \h^\bullet(\et k, \widetilde M)$. For more details, 
see \cite[I 2.4]{de77}. 

In our case, the exact sequence 
$0\to A[n]\to A(\bar k) \xrightarrow n A(\bar k) \to 0$ gives rise to a long 
exact sequence 
\[\xymatrix@=0.5cm{
  0 \ar[r] 
    & A[n]^{G_k} \ar[r] 
    & A(k) \ar[r]^-n 
    & A(k) \ar[r]^-\delta 
    & \h^1\left(G_k,A[n]\right) \ar[r] 
    & \h^1\left(G_k,A(\bar k)\right) \ar[r] 
    & \h^1\left(G_k, A(\bar k)\right) \ar[r] 
    & \cdots
}\]
It follows that we have an exact sequence 
\[\xymatrix{
  0 \ar[r] 
    & A(k) / n \ar[r]^-\delta
    & \h^1\left(G_k,A[n]\right) \ar[r] 
    & \h^1\left(G_k,A(\bar k)\right)[n] \ar[r]
    & 0
}\]
We will try to prove that $A(k)/ n$ is finite by embedding it into a group 
we know is finite. Unfortunately $\h^1(G_k, A[n])$ is infinite, so we cannot 
just use the above exact sequence show that $A(k)/n$ is finite. 

In general, suppose $G$ is a (commutative) group scheme over $k$. For example, 
$G$ could be the multiplicative group $\dG_m$, and abelian variety $A$. If 
$G$ is any commutative group scheme over $k$, we will use $G[n]$ to denote the 
fiber product $G\times_G 0$, where the map $G\to G$ is ``multiply by $n$.'' 
This conflicts with our earlier convention that $A[n]=A(\bar k)[n]$, but 
no confusion should arise from this. The group $G(\bar k)$ is 
a $G_k$-module, so we can consider the cohomology groups 
$\h^\bullet\left(G_k, G(\bar k)\right)$. We know that these are isomorphic to 
the \'etale cohomology groups 
$\h^\bullet\left(\et k, \widetilde{G(\bar k)}\right)$, and one can check quite 
easily that $\widetilde{G(\bar k)}$ is just $G$, regarded as a sheaf on $\et k$ 
via its functor of points. It follows that 
$\h^\bullet\left(G_k, G(\bar k)\right) = \h^\bullet(\et k, G)$, and we will 
pass between the two without comment in the future. 

To simplify the notation, we will often write $k$ for $\et k$, i.e. 
$\h^\bullet(k,G) = \h^\bullet(\et k,G)$. In this context, Hilbert's 
\emph{theorem 90} says that for $k$ a field, $\h^1(k,\dG_m) = 0$. If we write 
$\mu_n = \dG_m[n]$, then \emph{Kummer theory} starts with the short exact 
sequence $1\to \mu_n\to \dG_m\xrightarrow n \dG_m \to 1$ and uses Hilbert's 
theorem 90 together with the long exact sequence in sheaf cohomology to derive 
$\h^1(k,\mu_n) = k^\times / (k^\times)^n$. 

There is an alternate description of $\h^1(k,A)$. If $G$ is an arbitrary 
commutative algebraic group over $k$, a \emph{principal homogeneous space} 
(also called a \emph{torsor}) for $G$ over $k$ is a nonempty variety $X/k$ 
together with a morphism $G\times X\to X$ which, on $\bar k$-valued points, is 
a simply transitive group action. That is, if we write $g+x$ for the 
image of $(g,x)$ in $X$, we require that 
\begin{itemize}
  \item $g+(h+x) = (g+h)+x$ 
  \item $0+x = x$
  \item for all $x,y\in X(\bar k)$, there is a unique $g\in G(\bar k)$ such 
    that $g+x = y$
\end{itemize}
more generally, if $S$ is a scheme and $\sG$ is an abelian sheaf on $\et S$, a 
\emph{torsor} for $\sG$ is a sheaf of sets $\sT$ with a group action 
$\sG\times \sT\to\sT$ that, \'etale-locally on $S$, is isomorphic to $\sG$ as 
a sheaf with left $\sG$-action. Two torsors $\sT,\sT'$ are isomorphic if there 
is a sheaf isomorphism $\sT\to \sT'$ that commutes with the action of $\sG$. 
One can show (see e.g. \cite[IV 1.1]{de77}) that $\h^1(\et S,\sG)$ is 
naturally isomorphic as a pointed set to the set of isomorphism classes of 
$\sG$-torsors. 

Thus if $G$ is a commutative algebraic group over $k$, there is a natural 
bijection between the set of isomorphism classes of $G$-torsors and 
$\h^1(k,G)$. There is a non-abelian version of this. If $\sG$ is an arbitrary 
sheaf of groups over $\et S$, then one can still define the notion of a 
$\sG$-torsor. An identical theorem holds, except that one must define the 
``cohomology set'' $\h^1(\et S,\sG)$. For details, see \cite{sk01}. There is a 
non-abelian version of Hilbert's theorem 90: it says that 
$\h^1(k,\text{SL}_n) = \h^1(k,\text{GL}_n) = 0$ for all $n$ \cite[X 1]{se79}. 










% class on 09-19-2013
\section{Selmer groups and weak Mordell-Weil}

Recall that if $G$ is a profinite group (e.g $G_k$ for some field $k$) and $M$ 
is a discrete abelian group with continuous $G$-action, we directly defined the 
first cohomology group $\h^1(G,M) = Z^1(G,M) / B^1(G,M)$, where 
\[
  Z^1(G,M) = \{\varphi:G\to M\text{ continuous}: \varphi(\sigma\tau) = \sigma \varphi(\tau)+\varphi(\sigma)\}
\]
and $B^1(G,M)$ consisted of all $\varphi:G\to M$ of the form 
$\sigma\mapsto \sigma x-x$. Note that if $G$ acts trivially on $M$, then 
$\h^1(G,M) = \hom_\text{cts}(G,M)$. If $f:M\to M'$ is $G$-equivariant, then 
there is an obvious map $f_*L\h^1(G,M)\to \h^1(G,M')$ given by 
$f_*[\varphi] = [f\circ \varphi]$. Moreover, if $f:G'\to G$ is a continuous 
group homomorphism, then we have a map $f^*:\h^1(G,M) \to \h^1(G',M)$ given 
by $f^*[\varphi] = \varphi\circ f$, where we regard $G'$ as acting on $M$ via 
$f$. 

Let $k$ be a number field, $A$ be an abelian variety over $k$, and 
$n\geqslant 2$. The short exact sequence $0\to A[n]\to A\xrightarrow n A \to 0$ 
of group schemes induces an exact sequence 
\[\xymatrix{
  0 \ar[r]  
    & A(k)/n \ar[r] 
    & \h^1\left(k,A[n]\right) \ar[r] 
    & \h^1(k,A)[n] \ar[r] 
    & 0
}\]
We are trying to prove that $A(k)/n$ is finite. Since $\h^1\left(k,A[n]\right)$ 
can be infinite, we'll need to do some work to show this. 

\begin{example}
Let $K=\dQ$, and let $E$ be the elliptic curve defined by 
$y^2=(x-a)(x-b)(x-c)$ for distinct $a,b,c\in \dQ$. Then 
$E[2](\bar\dQ) = \{0,(a,0),(b,0),(c,0)\}$. Thus 
\begin{align*}
  \h^1(\dQ,E[2]) &= \hom(G_\dQ,E[2]) \\
    &= \hom(G_\dQ,\dZ/2\times \dZ/2) \\
    &= \hom(G_\dQ,\dZ/2) \times \hom(G_\dQ,\dZ/2)
\end{align*}
This is easily seen to be infinite (either using global class field theory, or 
by noting that $\dQ$ has lots of Galois extensions of degree $2$.) In fact, 
using Kummer theory, one can show that 
$\h^1(\dQ,E[2]) = \bigoplus_{\aleph_0} \dZ/2$. 
\end{example}

Our goal is to find a finite subgroup of $\h^1(k,A[n])$ containing $A(k)/n$. 
We haven't really used the fact that $k$ is a number field yet -- everything so 
far works for any perfect field. That changes when we start looking at 
completions of $k$. 

As before, let $k$ be a number field, and let $k_v$ denote the completion of 
$k$ at a place $v$. One can show that $k_v$ will either be $\dR$, $\dC$, or a 
finite extension of some $\dQ_p$. Choose $\overline{k_v}\supset k$; this gives 
a homomorphism $G_{k_v} \to G_k$, where $\sigma\mapsto \sigma|_{\bar k}$. It 
turns out that this is injective, but we will prove this later. As an example, 
if $k=\dQ$, $k_v=\dR$, then $G_{\dR}=\{1,c\}$ where $c:\dC\to \dC$ is complex 
conjugation. The image of $c$ in $G_\dQ$ is some element of order two. 

The functoriality of $\h^\bullet(-,-)$ applied to the map $G_{k_v} \to G_k$ 
gives us a map $\h^1(k,A[n]) \to \h^1(k_v,A[n])$, where we regard $A[n]$ as a 
group scheme over $k_v$ by base extension. We now have a commutative diagram: 
\[\xymatrix{
  0 \ar[r] 
    & A(k)/n \ar[r] \ar[d] 
    & \h^1(k,A[n]) \ar[r] \ar[d]^-\beta 
    & \h^1(k,A)[n] \ar[r] \ar[d] 
    & 0 \\
  0 \ar[r] 
    & \displaystyle\prod_v A(k_v)/n \ar[r]^-\alpha 
    & \displaystyle\prod_v \h^1(k_v,A[n]) \ar[r] 
    & \displaystyle\prod_v \h^1(k_v,A)[n] \ar[r] 
    & 0
}\]
The \emph{$n$-Selmer group} of $A$ over $k$ is 
\begin{align*}
  \selmer_n(A) = \{x\in \h^1(k,A[n]) : \beta(x) \in \im(\alpha)\} 
    = \ker\left(\h^1(k,A[n]) \to \prod_v \h^1(k_v,A)[n]\right)
\end{align*}
Similarly, we define the \emph{Tate-Shafarevich group} of $A$ by the exact 
sequence 
\[\xymatrix{
  0 \ar[r] 
    & \sha(A) \ar[r] 
    & \h^1(k,A) \ar[r]
    & \displaystyle\prod_v \h^1(k_v,A)
}\]
Putting these two definitions together, we obtain a short exact 
sequence 
\[\xymatrix{
  0 \ar[r] 
    & A(k)/n \ar[r] 
    & \selmer_n(A) \ar[r] 
    & \sha(A)[n] \ar[r] 
    & 0
}\]
We will soon prove that $\selmer_n(A)$ is finite, hence $A(k)/n$ and 
$\sha(A)[n]$ are finite. 

\begin{question}[Tate-Shafarevich]
If $A$ is an abelian variety over a number field $k$, is $\sha(A)$ finite?
\end{question}
This is currently open. A positive answer would show that for $n$ sufficiently 
large, $A(k)/n \simeq \selmer_n(A)$. In particular, this would imply that for $p$ 
large enough, $\rank(A) = \dim_{\dF_p} \selmer_p(A)$, where as before 
$\rank(A) = \rank_\dZ A(k)$ is the algebraic rank of 
$A$. 

\begin{remark}
The Selmer groups $\selmer_n(A)$ are effectively computable. If $\sha(A)$ were 
always finite, then $A(k)$ would be computable. 
\end{remark}





\section{Crash course in algebraic number theory}

If $k$ is a number field, we already used (without defining) the notion of a 
\emph{place} of $k$. In this section, we will see that $k$ comes with a lot of 
extra structure which will be used later on. Let's start with places. 

\begin{definition}
A \emph{local field} is a topological field that is locally compact as a 
topological space. 
\end{definition}

Let $k$ be a local field. Then the additive group of $k$ is a locally compact 
group, so it has a nontrivial \emph{Haar measure}, i.e. a 
translation-invariant Borel measure $\mu$. For $\alpha\in k$, the measure 
$\alpha^*\mu$ defined by $\alpha^* \mu(S) = \mu(\alpha S)$ is easily seen to 
be translation-invariant as well. It is known that $\mu$ is unique up to 
scalar, so there is a real number, denoted $|\alpha|$, such that 
$\alpha^*\mu = |\alpha|\mu$. One can prove that the function 
$|\cdot|:k\to \dR_{\geqslant 0}$ is an \emph{absolute value}. That is, 
\begin{enumerate}
  \item $|x|=0$ if and only if $x=0$
  \item $|x y| = |x|\cdot |y|$
  \item $|x+y|\leqslant |x|+|y|$
\end{enumerate}
It turns out that $|\cdot|$ induces the topology that $k$ already has, and 
that $k$ is complete with respect to $|\cdot|$. 

Local fields can be completely classified. If the strict triangle inequality 
holds, i.e. $|x+y|\leqslant \sup\{|x|,|y|\}$ for all $x,y\in k$, we say that 
$k$ is \emph{non-archimedean}. If $k$ is not non-archimedean, we say it is 
\emph{archimedean}. If $k$ is archimedean, one can prove that $k$ has 
characteristic zero, so $\dQ\subset k$. The absolute value on $k$ induces one 
on $\dQ$, and it is a theorem that the only archimedean absolute value on 
$\dQ$ is the usual one. Thus $\dR\subset k$. It is a general theorem that $k$ 
can only be locally compact if $[k:\dR]<\infty$, from which it follows that 
either $k=\dR$ or $k=\dC$. 

If $k$ is non-archimedean of characteristic $p$, then one can prove that 
$k=\dF_q\lau t$ for some finite field $\dF_q$, where $q=p^r$. If $k$ is 
non-archimedean of characteristic zero, then once again $\dQ\subset k$. It is 
known (Otrowski's theorem) that the only non-archimedean absolute values on 
$\dQ$ are of the form $|\cdot|_p$ for primes $p$, where $|x|_p=p^{-v_p(x)}$. 
Here $v_p:\dQ^\times \to \dZ$ is the unique homomorphism with 
$v_p(p)=1$, $v_p(n)=0$ for $p\nmid n$. If we write $\dQ_p$ for the completion 
of $\dQ$ with respect to $|\cdot|_p$, then $k$ contains some $\dQ_p$. Once 
again a general theorem shows that $[k:\dQ_p]<\infty$. To summarize, local 
fields are one of the following:
\begin{itemize}
  \item $\dR$ or $\dC$
  \item $\kappa\lau t$ for some finite field $\kappa$
  \item a finite extension of $\dQ_p$
\end{itemize}

If $k$ is a non-archimedean local field, we write 
$\fo_k=\{x\in k:|x|\leqslant 1\}$ and $\fp_k = \{x\in k:|x|<1\}$. It turns 
out that $\fo_k$ is a complete discrete valuation ring with maximal ideal 
$\fp_k$. We denote the residue field by $\kappa_k=\fo_k/\fp_k$. When $k$ is 
understood, we write $\fo,\fp,\kappa$ instead of $\fo_k,\fp_k,\kappa_k$. 
Choose a separable closure $k^s$ of $k$. Because the field $k$ is 
\emph{henselian} ($|\cdot|$ has a unique extension to $k^s$), the integral 
closure $\fo_{k^s}$ of $\fo_k$ in $k^s$ is a local ring (no longer noetherian) 
and elements of $G_k$ preserve $|\cdot|$. The field 
$\fo_{k^s}/\fp_{k^s}$ is separably closed, so we get a map 
$G_k\to G_\kappa$, given by $\sigma\mapsto \bar\sigma$, where 
$\bar\sigma(\bar x)=\overline{\sigma x}$. The kernel is called the 
\emph{inertia group} of $k$, and denoted $I_k$. 

\begin{definition}
A \emph{global field} is either a finite extension of either $\dQ$ or 
$\dF_p(t)$ for some prime $p$. 
\end{definition}
A \emph{place} of a global 
field $k$ is an equivalence class of embeddings $k\hookrightarrow K$, where 
$K$ is a local field such that the image of $k$ is dense. Two such 
embeddings are equivalent if they are (topologically) isomorphic over $k$. 
We will use the letter $v$ to denote places of $k$, and denote a choice of 
representative by $k_v$. If $k_v$ is non-archimedean, we call $v$ 
\emph{finite}, otherwise it is \emph{infinite}. For the remainder, let $v$ be 
a finite place of $k$. 

The absolute value on $k_v$ induces one on $k$, which we will denote by 
$|\cdot|_v$. If $v$ is non-archimedean (i.e. $k_v$ is non-archimedean) then we 
will also use $v$ to denote the valuation on $k$ induced by the canonical 
valuation on $k_v$. We will write $\fo_v$, $\fp_v$, $\kappa_v$ instead of 
$\fo_{k_v}$\ldots. We can choose $k_v^s\supset k^s$, in which case restriction 
induces a continuous homomorphism $G_{k_v} \to G_k$. We will prove later that 
this is injective. The image is often denoted $G_v$, and the image of 
$I_{k_v}$ inside $G_v$ will be written $I_v$. Note that $G_v$, as a subset of 
$G_k$, is only well defined up to conjugacy. 

There is a lot more to be said about global fields, but we will conclude with 
the \emph{product formula}. Given the canonical absolute value $|\cdot|_v$ 
associated with a place, one can prove that 
\[
  \prod_v |x|_v = 1
\]
This property actually characterizes global fields -- see \cite{ar45}. For 
more details on local and global fields, see \cite{we95}. 










% class on 09-24-2013
%\section{Crash course in algebraic number theory}

Let $k$ be a number field, i.e. a finite extension of $\dQ$. Let $\fo_k$ be the 
\emph{ring of integers} of $k$, that is, $\fo_k$ is the integral closure of 
$\dZ$ in $k$. The ring $\fo_k$ is a dedekind domain. Thus if $\fa\subset \fo_k$ 
is a nonzero ideal, we have a factorization $\fa=\fp_1^{e_1}\dotsm \fp_r^{e_r}$ 
where the $\fp_i\subset\fo_k$ are prime (hence maximal) ideals, and each 
$e_i\geqslant 1$. This factorization is unique up to reordering if we require 
that the $\fp_i$ be distinct. 

For a prime $\fp\subset \fo_k$, we write (as before) $\kappa_\fp = \fo_k/\fp$ 
for the \emph{residue field} of $\fp$. The field $\kappa_\fp$ is finite because 
it is finitely generated (as a ring) over its prime field. There is a unique 
homomorphism $v_\fp:k^\times \twoheadrightarrow \dZ$ such that for 
$a\in \fo_k\smallsetminus 0$, we have $(a)=\fp^{v_\fp(a)}\cdot \fb$ with 
$(\fb,\fp)=1$. This gives us an absolute value 
\[
  |a|_\fp = \begin{cases}
              0 & \text{if $a=0$} \\
              (\# \kappa_\fp)^{-v_\fp(a)} & \text{otherwise}
            \end{cases}
\]
Completing $k$ with respect to this absolute value, we get a local field 
$k_\fp$. Our valuation (and absolute value) extend by continuity to a 
valuation $v_\fp:k_\fp^\times\to\dZ$ and absolute value 
$|\cdot|_\fp:k_\fp\to\dR_{\geqslant 0}$. 

Let $L/k$ be a finite extension, $\fp\subset \fo_k$ a prime ideal. The ideal 
$\fp\fo_L$ factors uniquely as 
$\fq_1^{e(\fq_1/\fp)}\dotsm\fq_r^{e(\fq_r/\fp)}$, where the $\fq_i\subset\fp_L$ 
are prime. For example, if $L=\dQ(i)$, then $2=-i(1+i)^2$ and $5=(1+2i)(1-2i)$. 
One can show that 
\begin{align*}
  2\fo_L &= ((1+i)\fo_L)^2 \\
  3\fo_L &= 3\fo_L \\
  5\fo_L &= ((1+2i)\fo_L)\cdot ((1-2i)\fo_L)
\end{align*}
are prime factorizations in $\fo_L$. One says that $\fp$ is \emph{unramified} 
in $L$ if $e(\fq_i/\fp)=1$ for all $i$. It is an easy theorem that only 
finitely many primes can ramify. 

Now assume $L/k$ is Galois. The action of the galois group $G=\gal(L/k)$ 
preserves $\fo_L$, fixing $\fo_k$. This action does \emph{not} fix ideals in 
$\fo_L$. In fact, if $\fq_1,\dots,\fq_r$ are the primes lying above 
$\fp\subset \fo_k$, then $G$ acts transitively on $\{\fp_1,\dots,\fp_r\}$, 
from which we see that each $e(\fq_i/\fp)$ is the same integer, denoted 
$e_\fp$. Fix $\fq=\fq_1$. The \emph{decomposition group} of $\fq/\fp$ is 
\[
  D(\fq/\fp) = \{\sigma\in \gal(L/k) : \sigma(\fq) = \fq\}
\]
There is a canonical homomorphism 
$D(\fq/\fp) \to \gal(\kappa_\fq/\kappa_\fp)$ given by ``reduce $\sigma$ modulo 
$\fp$.'' This gives us an exact sequence 
\[\xymatrix{
  1 \ar[r] 
    & I(\fq/\fp) \ar[r] 
    & D(\fq/\fp) \ar[r] 
    & \gal(\kappa_\fq/\kappa_\fp) \ar[r] 
    & 1
}\]
(One can prove that the map on the right is surjective.) So the \emph{inertia 
group} of $\fq/\fp$, denoted $I(\fq/\fp)$, is the subgroup of $D(\fq/\fp)$ 
consisting of automorphisms whose action is trivial modulo $\fq$. Choosing 
$\fq=\fq_i$ for some $i\ne 1$ gives a $D(\fq_i/\fp)$ that is conjugate to 
$D(\fq/\fp)$. We will often write $D_\fp$ and $I_\fp$, keeping in mind that 
they are only well-defined up to conjugacy. We will use the fact that 
$\# I_\fp = e_\fp$. So $\fp$ is unramified in $L$ if and only if 
$I_\fp = 1$. 

Choosing $\fq$ lying over $\fp$, we can complete $L$ and $k$ to get an 
extension $L_\fq/k_\fp$ of local fields. We have seen that restriction 
gives a map $\gal(L_\fq/k_\fp) \to \gal(L/k)$. It turns out that this map is an 
isomorphism onto the image $D(\fq/\fp)\subset \gal(L/k)$. We'll write 
$I(L_\fq/k_\fp)$ for the inverse image of $I(\fq/\fp)$ in 
$\gal(L_\fq/k_\fp)$. It can be defined directly in exactly the same manner as 
$I(\fq/\fp)$. 

Passing to the algebraic closure of $k_\fp$, we can consider the absolute 
Galois group 
\[
  G_{k_\fp} = \varprojlim_{L_\fq\supset k_\fp} \gal(L_\fq/k_\fp)
\]
where $L_\fq$ ranges over all finite Galois extensions of $k_\fp$. The group 
$G_{k_\fp}$ has a distinguished subgroup $I_\fp$, which is the inverse limit 
\[
  I_\fp = \varprojlim_{L_\fq/k_\fp} I(L_\fq/k_\fp)
\]
Our exact sequence 
\[\xymatrix{
  1 \ar[r] 
    & I_\fp \ar[r] 
    & G_{k_\fp} \ar[r] 
    & \gal(\overline{\kappa_\fp}/\kappa_\fp) =\hat\dZ \ar[r] 
    & 1
}\]
extends to a filtration of $G_{k_\fp}$ by normal closed subgroups whose 
successive quotients are abelian. Once again, recall that there is a canonical 
embedding $G_{k_\fp}\hookrightarrow G_k$ via an embedding 
$\bar k\hookrightarrow \overline{k_\fp}$. 










\section{Reduction of abelian varieties}

Let $A$ be an abelian variety over a local field $k_\fp$. Let $\fo_\fp$ be the 
ring of integers of $k_\fp$, i.e. $\fo_\fp=\{x\in k_\fp:|x|_\fp\leqslant 1\}$. 
The ideal $\fp\fo_\fp$ is the unique maximal ideal of $\fo_\fp$, and it turns 
out that $\fp\fo_\fp = \{x\in k_\fp:|x|_\fp<1\}$. In an abuse of notation, we 
write $\fp$ for $\fp\fo_\fp$. 

\begin{definition}
We say that a variety $X/k_\fp$ has \emph{good reduction} if there is a smooth 
proper model $\cX/\fo_\fp$ .
\end{definition}
That is, there is a smooth proper scheme $\cX$ over $\fo_\fp$ such that the 
following diagram is cartesian:
\[\xymatrix{
  X \ar[r] \ar[d]  
    & \cX \ar[d] \\
  \spec(k_\fp) \ar[r] 
    & \spec(\fo_k)
}\]
We write $X_\fp$ for $\cX\times_{\spec(\fo_k)}\spec(\kappa_\fp)$, and call 
$X_\fp$ the \emph{reduction of $X$ modulo $\fp$}. 

One can show that if $A$ is an abelian variety over $k_\fp$ with good 
reduction, then $A_\fp$ is independent of the choice of $\cA$, that $\cA$ gets 
the structure of an abelian scheme over $\fo_k$, and that $A_\fp/\kappa_\fp$ is 
an abelian variety. 

There is in fact a canonical model for $A$ over $\fo_p$, and it exists in great 
generality. Let $S$ be a connected dedekind scheme with field of fractions $k$. 
If $A$ is an abelian variety over $k$, one calls a \emph{N\'eron model} of $A$ 
a smooth model $\cA$ for $A$ over $S$ for which any morphism $X_k\to A$, where 
$X$ is a smooth scheme over $S$, has a unique extension to a morphism 
$X\to \cA$. In other words, $\cA$ represents the functor 
$X\mapsto \hom_k(X_k,A)$ from smooth schemes over $S$ to $k$-varieties. It is 
clear that $\cA$ (if it exists) is unique up to unique isomorphism. 
Fortunately, it is a theorem (see \cite[1.4.1]{blr90}) that in our setting 
($S$ a connected dedekind scheme and $A$ an abelian variety over $k$) N\'eron 
models always exist. Moreover, there is a unique structure of a group scheme 
on $\cA$ extending that of $A$ \cite[1.2.6]{blr90}. 

So if $S=\spec(\fo_k)$ for a number field $k$ and $\fp\subset \fo$ is a prime, 
we could have said that an abelian variety $A/k$ has good reduction at $\fp$ 
if the N\'eron model $\cA$ for $\fo_\fp$ (the localization of $\fo$ at 
$\fp$) is proper. 

\begin{example}
Let $E:y^2=x^3+a x+b$, where $a,b\in \dZ$ and $\Delta=-16(4 a^3+27b^2)\ne 0$. 
If $p\nmid \Delta$, then $E/\dQ_p$ has good reduction, and $E_p/\dF_p$ is given 
by the reduction of our original equation modulo $p$. 
\end{example}

There is a reduction map $A(k_\fp)\to A_\fp(\kappa_\fp)$ which is a group 
homomorphism. This is the composite 
\[
  A(k_\fp)=\cA(\fo_\fp) \to \cA(\kappa_\fp) = A_\fp(\kappa_\fp)
\]
To see that $A(k_\fp)=\cA(\fo_\fp)$, think of $A$ as being a subset of some 
projective space $\dP^N$. For a point
$x=(x_0:\cdots:x_N)\in \dP^N(k_\fp)$, we can scale $x$ be the 
denominators of the $x_i$ to get a model 
$x=(x_0:\cdots:x_N)\in\dP^N(\fo_\fp)$. We can even get a model with 
some $x_i\not\equiv 0\mod\fp$, and the image of $x$ in 
$\dP^N(\kappa_\fp)$ is in $A_\fp(\kappa_\fp)$. By Hensel's lemma, the 
map $A(k_\fp) \to A_\fp(\kappa_\fp)$ is a surjection. The kernel is a pro-$p$ 
group, where $p$ is the characteristic of $\kappa_\fp$. In fact, the kernel is 
a $p$-adic Lie group. 

We can extend our reduction map to algebraic closures, getting a homomorphism 
$A(\overline{k_\fp}) \to A_\fp(\overline{\kappa_\fp})$, that has a pro-$p$ 
kernel. Choose an integer $n\geqslant 2$ with $p\nmid n$. The map 
$A(\overline{k_\fp})[n] \to A_\fp(\overline{\kappa_\fp})[n]$ is an isomorphism 
because both groups have the same cardinality ($n^2$) and the kernel is 
pro-$p$. In that isomorphism both groups have a Galois action -- $G_{k_\fp}$ on 
the left and $G_{\kappa_\fp}=\hat\dZ$ on the right. The map is compatible with 
the Galois action, so in particular, the inertia group $I_\fp$ acts trivially 
on $A(\overline{k_\fp})[n]$. 

Let $A/k_\fp$ be an abelian variety with good reduction. Recall we had a map 
$\delta:A(k_\fp)/n A(k_\fp) \hookrightarrow \h^1(k_\fp,A[n])$ defined as 
follows. For $x\in A(k_\fp)$, choose $y\in A(\overline{k_\fp})$ such that 
$n\cdot y=x$. We define the $1$-cocycle $\varphi=\delta(x)$ by 
$\sigma\mapsto \sigma y - y$. For $\sigma\in I_\fp$, the elements 
$\sigma y$ and $y$ have the same image in $A_\fp(\overline{\kappa_\fp})$, hence  
$\sigma y - y\in A(\overline{k_\fp})[n]$ has trivial image modulo $\fp$. It 
follows that $\sigma y-y=0$ since it is an $n$-torsion point that is $0$ 
modulo $\fp$. This tells us that $\varphi(\sigma) = 0$ for all 
$\sigma\in I_\fp$, i.e. $\varphi(I_\fp) = 0$. 

\begin{lemma}
Let $A$ be an abelian variety over a number field $k$. With the above notation, 
$\varphi(I_\fp) = 0$ for all $\fp\subset \fo_k$ of good reduction for $A$. 
\end{lemma}

If we let $S$ be the finite set of primes for which $A$ has bad reduction, we 
will show that the group
\[
  \h_S^1(k,A[n]) = \{[\varphi]\in \h^1(k,A[n]) : \varphi(I_\fp) = 0\text{ for all } \fp\notin S\}
\]
is finite. 










% lecture 09-26-2013
\section{Torsion and weak Mordell-Weil}

Let $A$ be an abelian variety over a number field $k$. Recall that we are 
trying to show that $A(k)$ is finitely generated. We have shown that it is 
sufficient to prove that the quotients $A(k)/n$ are finite for all 
$n\geqslant 2$. Once we know that $A(k)$ is finitely generated, we can write 
$A(k)=A(k)_\text{tors}\oplus \dZ\cdot x_1\oplus \cdots \oplus \dZ x_r$, where 
each $x_i$ is of infinite order. The algebraic rank $r=\rank A$ is 
very difficult to compute in general, but $A(k)_\text{tors}$ is computable. 

Choose a prime $\fp\subset \fo_k$ at which $A$ has good reduction (this is true 
for all but finitely many $\fp$). We have a reduction map 
$A(k_\fp)\to A_\fp(\kappa_\fp)$, which has pro-$p$ kernel. The group 
$A(k)_\text{tors}$ is contained in $A(k_\fp)$, so we can think about its image 
in $A_\fp(\kappa_\fp)$. Since $A(k)_\text{tors}$ is finite, the kernel of 
$A(k)_\text{tors}\to A_\fp(\kappa_\fp)$ is a $p$-group. Pick another prime 
$\fp'$ of good reduction for $A$, with residue characteristic $\ell\ne p$. The 
kernel of the map 
$A(k)_\text{tors}\to A_\fp(\kappa_\fp)\times A_{\fp'}(\kappa_{\fp'})$ is a 
$p$-group and a $\ell$-group, hence trivial, i.e. $A(k)_\text{tors}$ is a 
subgroup of $A_\fp(\kappa_\fp)\times A_{\fp'}(\kappa_{\fp'})$. (This gives us a 
way to compute $A(k)_\text{tors}$, because $A_\fp(\kappa_\fp)$ and 
$A_{\fp'}(\kappa_{\fp'})$ are computable. ($X(\kappa)$ for $X$ any projective 
variety over any finite field $\kappa$ is computable, for stupid reasons.)

\begin{example}
Let $E$ be the elliptic curve over $\dQ$ given by $y^2=x^3+3$. This has 
descriminant $\Delta=-2^4\cdot 3^5$, so $E$ has good reduction away from $2$ 
and $3$. We can compute 
\begin{align*}
  E_5(\dF_5) &= \{O,(1,\pm 2),(2,\pm 1),(3,0)\} \\
  \left|E_7(\dF_7)\right| &= 13
\end{align*}
The kernel of $E(\dQ)_\text{tors}\to E_5(\dF_5)$ is a $5$-group, and the kernel 
of $E(\dQ)_\text{tors}\to E_7(\dQ_7)$ is a $7$-group. From this, we know that 
$E(\dQ)_\text{tors}$ has no points of order $5$ or $7$. Thus  
$E(\dQ)_\text{tors}$ embeds into groups of oder $6$ and $13$, so it is the 
trivial group. Since $(1,2)\in E(\dQ)$ and $E(\dQ)_\text{tors}=0$, we know that 
$E(\dQ)$ is infinite. 
\end{example}

\begin{example}
Let $E/\dQ$ be the curve defined by $y^2 + y = x^3-x^2-10 x-20$. One can check 
that $E$ has good reduction away from $11$. Easy computations yield 
\begin{center}
  \begin{tabular}{c|c}
    $p$ & $  \# E_p(\dF_p)$ \\ \hline
    2   & 5  \\
    3   & 5  \\
    5   & 5  \\
    7   & 10 \\
    13  & 10
  \end{tabular}
\end{center}
This shows us that $E(\dQ)_\text{tors}$ is either $0$ or $\dZ/5$. In fact, it 
is the latter with $E(\dQ)_\text{tors}=\langle (5,5)\rangle$. 
\end{example}

Let's get back to the weak Mordell-Weil theorem. Let $A$ be an abelian variety 
over a number field $k$, and let $S$ be the (finite) set of primes $\fp$ for 
which $A$ has bad reduction at $\fp$. We have a map 
$\delta:A(k_\fp)/n \to\h^1(k_\fp,A[n])$. If $[\varphi]=\delta(x)$ for 
$x\in A(k_\fp)$, then $\varphi(I_\fp) = 0$, where as before, $I_\fp$ is the 
inertia subgroup of $G_{k_\fp}$. Thus we have a commutative diagram with 
exact rows:
\[\xymatrix{
  0 \ar[r] 
    & A(k)/n \ar[r]^-\delta \ar[d]
    & \h^1(k,A[n]) \ar[d] \\
  0 \ar[r]
    & A(k_\fp)/n \ar[r]^-\delta 
    & \h^1(k_\fp,A[n])
}\]
We define 
\[
  \h^1(k,A[n]) = \{[\varphi]\in \h^1(k,A[n]) : \varphi(I_\fp) = 0\text{ for all }\fp\notin S\}
\]
Note that $A(k)/n\hookrightarrow \selmer_n(A)\subset \h_S^1(k,A[n])$. The group 
$\selmer_n(A)$ is a ``better approximation'' of $A(k)/n$ than $\h_S^1(k,A[n])$, 
but it is $\h_S^1(k,A[n])$ that we will actually show is finite. 

\begin{theorem}
Let $A$ be an abelian variety of dimension $d$ over a number field $k$, and let 
$S$ be the set of places of $k$ at which $A$ has bad reduction. Then the group 
$\h_S^1(k,A[n])$ is finite.
\end{theorem}
\begin{proof}
We need one last bit of group cohomology. Let $G$ be a profinite group acting 
continuously on a discrete abelian group $M$. Let $H\subset G$ be a closed 
subgroup. The \emph{inflation-restriction exact sequence} comes from the 
map $\h^1(G,M) \to \h^1(H,M)$ defined by $[\varphi]\mapsto [\varphi|_H]$: 
\[\xymatrix{
  0 \ar[r] 
    & \h^1(G/H,M^H) \ar[r]^-{\text{inf}} 
    & \h^1(G,M) \ar[r]^-{\text{res}}
    & \h^1(H,M)
}\]
It's easy to see that the map 
$\text{inf}:[\varphi]\mapsto [\varphi\circ (G\twoheadrightarrow G/H)]$ is 
well-defined. 

Let $L/k$ be a finite Galois extension such that $G_L$ acts trivially on the 
finite group $A[n]$. We can apply the inflation-restriction exact sequence to 
$(G_k,G_L,A[n])$ to get 
\[\xymatrix{
  0 \ar[r] 
    & \h^1\left(\gal(L/k), A[n]^{G_L}\right) \ar[r] 
    & \h^1(k,A[n]) \ar[r] 
    & \h^1(L,A[n])
}\]
We could have done this locally at all places of good reduction, and if we let 
$S'$ be the set of all places of $L$ laying over some place in $S$, we get 
\[\xymatrix{
  0 \ar[r] 
    & \h_S^1(\gal(L/k),A[n]^{G_L}) \ar[r] 
    & \h_S^1(k,A[n]) \ar[r]
    & \h_{S'}^1(L,A[n])
}\]
The first group is finite because both $\gal(L/k)$ and $A[n]^{G_L}$ are finite. 
If we can show that $\h_{S'}^1(L,A[n])$ is finite, we'll be done. In other 
words, in trying to show that $\h_S^1(k,A[n])$ is finite, we may assume that 
$A[n]\subset A(k)$. In this case, we have that 
\[
  \h^1(k,A[n]) = \h^1(G_k,A[n]) = \hom(G_k,A[n]) = \hom(G_k,\dZ/n)^{\oplus 2d}
\]
where ``$\hom$'' denotes the set of continuous group homomorphisms. The group 
$\hom(G_k,\dZ/n)$ is always infinite, but we only need to prove that 
\[
  \h_S^1(k,A[n]) = \{\varphi:G_k\to A[n] : \varphi(I_\fp) = 0\text{ for all }\fp\notin S\}
\]
is finite. Take such a $\varphi$; it will factor through a finite quotient 
$\gal(L/k)$ of $G_k$. Since $\varphi(I_\fp)=0$, the extension $L/k$ is 
unramified at $k$. Moreover, $[L:k]\leqslant n^{2 d}$. By theorem 
\ref{thm:hermite}, we know that $L\subset K$ for a fixed extension $K/k$. 
Thus $\h_S^1(k,A[n])\hookrightarrow \hom(\gal(K/k),\dZ/n)^{\oplus 2d}$, a  
finite group. 
\end{proof}

\begin{theorem}[Hermite]\label{thm:hermite}
Let $k$ be a number field, $S$ a finite set of places of $\fo_k$. For a fixed 
integer $N\geqslant 1$, there is a finite extension $K\subset \bar k$ such that 
if $L\subset \bar k$ is an extension of $k$ unramified outside of $S$ with 
$[L:k]\leqslant N$, then $L\subset K$. 
\end{theorem}
\begin{proof}
This follows easily from \cite[B.2.14]{bg06}. 
\end{proof}

There is a geometric interpretation of the Tate-Shafarevich group $\sha(A)$, 
defined by the exact sequence 
\[\xymatrix{
  0 \ar[r] 
    & \sha(A) \ar[r] 
    & \h^1(k,A) \ar[r] 
    & \displaystyle\prod_v \h^1(k_v,A)
 }\]
Recall that a \emph{torsor} of $A$ over $k$ is a nice variety $X/k$ with a 
simply transitive group action $A\times X\to X$ which is a morphism of 
$k$-varieties. In other words, we require $A(L)\times X(L)\to X(L)$ to be 
a simply transitive group action whenever $X(L)\ne\varnothing$. If 
$x\in X(L)$, we get an isomorphism $A_L\to X_L$ which is \emph{not} generally 
defined over $k$. Two torsors are equivalent if they have compatible group 
actions (i.e. if they are $A$-equivariantly isomorphic over $k$). A torsor is 
\emph{trivial} if it is equivalent to $A$ with the usual left action. It turns 
out that a torsor $X$ is trivial if and only if $X(k)\ne\varnothing$. 

There is a natural bijection 
\[
  \{\text{torsors over $A$}\}/\text{equivalence} \leftrightarrow \h^1(k,A)
\]

\begin{example}
Let $C/k$ be a nice curve of genus $1$. (It could be that $C$ is not elliptic, 
for instance if $C(k)=\varnothing$.) Let $E=\jac C$; this is an elliptic curve. 
There is a bijection $C\to \picard_C^1$ given by $x\mapsto [x]$. This induces a 
bijection $E=\picard_C^0$. There is an action 
$\picard_C^0\times \picard_C^1\to \picard_C^1$, induced by $(D_1,D_2)\mapsto D_1+D_2$. 
This makes $C$ a torsor over $E$. 
\end{example}





\section{Restricted ramification}

Let $k$ be a number field, and let $S$ be a finite set of primes of $k$. Recall 
that we defined, for a $G_k$-module $M$, the ``cohomology with restricted 
ramification'' 
\[
  \h_S^1(G_k,M) = \{[\varphi]\in \h^1(G,M) : \varphi(I_\fp) = 0\text{ for all }\fp\notin S\}
\]
We will see that $\h_S^1(G_k,M)$ can be defined directly both as a Galois 
cohomology group and as an \'etale cohomology group. First we need to clarify: 
requiring $\varphi(I_\fp)=0$ actually means that $\varphi(I_\fp)=0$ for 
\emph{any} choice of $I_\fp$. (Recall that the embeddings 
$G_{k_\fp}\hookrightarrow G_k$, and hence $I_\fp\hookrightarrow G_k$, are only 
well-defined up to conjugacy.) One easily checks that, for any 
$[\varphi]\in \h^1(G_k,M)$, the set 
$\ker(\varphi)=\{\sigma:\varphi(\sigma)=0\}$ is a subgroup of $G_k$. In other 
words, if $H\subset G_k$ denotes the (normal) subgroup generated by the 
$I_\fp$ for $\fp\notin S$, then 
\[
  \h_S^1(G_k,M) = \ker\left(\h^1(G_k,M) \to \h^1(H,M)\right) 
                = \h^1(G_k/H,M^H) \text{,}
\]
the second equality coming from the inflation-restriction sequence. 

The normal subgroup of $G_k$ generated by $\bigcup_{\fp\notin S} I_\fp$ is the 
Galois group of an extension $k_S/k$. One can prove that whenever $L/k$ is a 
finite extension unramified away from $S$, then $L\subset k_S$. We write 
$G_{k,S}=\gal(k_S/k) = G_k/G_{k_S}$, and call $G_{k,S}$ a Galois 
group \emph{with restricted ramification}. In the future, if $M$ is a 
$G_k$-module for which the action of $G_k$ on $M$ is unramified away from 
$S$, we will write $\h^1(G_{k,S},M)$ instead of $\h_S^1(G_k,M)$. 

Just as one can interpret the 
absolute Galois group $G_k$ as the \'etale fundamental group 
$\pi_1(\spec k)$, the group $G_{k,S}$ can be interpreted as an \'etale 
fundamental group using the following theorem.

\begin{theorem}
Let $S$ be normal connected scheme with function field $k$. Then the group 
$\pi_1(S)$ is naturally isomorphic to $\gal(k_S/k)$, where $k_S$ is the 
composite of all finite extensions $L\subset k^s$ for which the normalization 
of $S$ in $L$ is \'etale over $S$. 
\end{theorem}
\begin{proof}
See \cite[5.4.9]{sz09}.
\end{proof}

If $S$ is a finite set of primes of $k$, let $\fo_{k,S}=S^{-1}\fo_k$. We will 
also denote by $S$ the scheme $\spec(\fo_k)\smallsetminus S=\spec(\fo_{k,S})$. A 
field extension $L/k$ is unramified outside of $S$ precisely when integral 
closure of $\fo_{k,S}$ inside $L$ is \'etale over $\fo_k$. In other words, the 
above theorem shows that $\pi_1(S)=G_{k,S}$. Our proof of the weak Mordell-Weil 
theorem ended up relying on the fact that $G_{k,S}$ has only finitely many open 
subgroups of any given index. One calls a profinite group $G$ \emph{small} if 
this property holds for $G$. (Equivalently, if $\h^1(G,A)$ is finite for all 
finite $G$-modules $A$.) Hermite's theorem has a huge generalization: if $X$ is 
a connected scheme of finite type such that $X\to \spec(\dZ)$ has dense image, 
then $\pi_1(X)$ is small. For a proof, see \cite[2.8]{hh09}. 

A $G_{k,S}$-module induces a sheaf $\widetilde M$ on the \'etale site of 
$\spec(\fo_{k,S})$, and in pretty good generality (see \cite{fo11} or 
\cite[II.2.9]{mi06}) one has 
$\h^\bullet(G_{k,S},M) = \h^\bullet(\et{\spec(\fo_{k,S})},\widetilde M)$. We 
will often write $\h^\bullet(\fo_{k,S},M)$ for both groups. So, our statement 
that $\selmer_n(A)\subset \h_S^1(k,A[n])$ would now be written 
$\selmer_n(A)\subset \h^1(\fo_{k,S},A[n])$. 










% lecture on 10-01-2013
\section{Tate-Shafarevich groups}

Let $k$ be a number field, $A$ an abelian variety over $k$. Recall the 
Tate-Shafarevich group of $A$ is 
\[
  \sha(A) = \ker\left(\h^1(k,A) \to \prod_v \h^1(k_v,A)\right) \text{.}
\]
The \emph{Weil-Ch\^atelet group} of $A$, written $\operatorname{WC}(A)$, is 
the group of torsors over $A$ modulo equivalence. As we have seen, there is a 
bijection $\operatorname{WC}(A) = \h^1(k,A)$. If $k$ is a number field, then 
$\operatorname{WC}(A)$ is infinite, but if $k$ is finite then 
$\operatorname{WC}(A)=0$. We'll define the map 
$\operatorname{WC}(A)\to \h^1(k,A)$. Fix an $A$-torsor $X$. There exists some 
$L/k$ with $X(L)\ne\varnothing$. Choose $x\in X(L)$, and define a cocycle 
$\varphi:G_k\to A(\bar k)$ by $\sigma\mapsto \sigma x - x$, where 
$\sigma x- x$ is the unique point $a\in A(\bar k)$ such that $a+x=\sigma(x)$. 
The image of $X$ in $\h^1(k,A)$ is the cocycle $\varphi$. It isn't too hard to 
check that this map is well-defined. 

This tells us that there is a natural bijection between $\sha(A)$ and the set 
of torsors $X$ of $A/k$, such that $X(k_v)\ne\varnothing$ for all places $v$ of 
$k$. This can be generalized. Let $X/k$ be a nice variety. We say that $X$ 
satisfies the \emph{Hasse principle} if $X(k_v)\ne\varnothing$ for all $v$ 
implies $X(k)\ne\varnothing$. So $\sha(A)$ classifies torsors over $A$ that 
do not satisfy the Hasse principle. Clearly, if $X(k)\ne\varnothing$, then 
$X$ satisfies the Hasse principle. Similarly, if $X(k_v)=\varnothing$ for some 
$v$, then $X$ satisfies the Hasse principle. 

\begin{example}[Selmer]
The plane curve $C\subset \dP_\dQ^2$ given by $3 x^3+4 y^3+5 z^3=0$ fails the 
Hasse principle. In other words, $C(\dQ_p)\ne \varnothing$ for all $p$, 
$C(\dR)\ne\varnothing$, but $C(\dQ)=\varnothing$. If we let $E=\jac C$, then 
we know that $\sha(E)\ne 0$. 
\end{example}

It turns out that the Hasse principle can be checked. That is, for a nice 
variety $X$ over $\dQ$ there is an algorithm to determine whether 
$X(\dQ_v)\ne\varnothing$ for all primes. This is because $X$ will have good 
reduction at all but a finite (computable!) set of primes. If $X$ has good 
reduction at $p$ with integral model $\mathcal X$, then 
$\mathcal X(\dF_p)\ne\varnothing$ by the Weil conjectures. Since $\mathcal X$ 
is smooth, Hensel's lemma lets us lift an element of $\mathcal X(\dF_p)$ to 
$\mathcal X(\dZ_p)\subset X(\dQ_p)$. For a prime $p$ at 
which $X$ has bad reduction, we can still pick an integral model $\mathcal X$. 
Either there will be an $n$ for which $\mathcal X(\dZ/p^n)=\varnothing$, in 
which case $X(\dQ_p)=\varnothing$, or elements of $\mathcal X(\dZ/p^n)$ for 
$n\gg 0$ will lift to $X(\dZ_p)$. Checking whether $X(\dR)=\varnothing$ is easy 
analysis. 

If $C$ is a nice curve of genus zero over a number field, then $C$ satisfies 
the Hasse principle \cite[3.4]{ca67}. This is essentially the 
Hasse-Minkowski theorem. 

\begin{example}[descent]
Let $E/\dQ$ be the elliptic curve defined by $y^2=(x-e_1)(x-e_2)(x-e_3)$ where 
the $e_i\in \dZ$ are distinct. It's easy to see that 
$E[2]=\{0,(e_1,0),(e_2,0),(e_3,0)\}\simeq (\dZ/2)^{\oplus 2}$. We use 
$\{(e_1,0),(e_2,0)\}$ as a $\dF_2$-basis for $E[2]$. We have 
\begin{align*}
  \h^1(\dQ,E[2]) &= \hom(G_\dQ,E[2]) \\
    &= \hom(G_\dQ,\dZ/2)^{\oplus 2} \\
    &= \left(\dQ^\times/2\right)^{\oplus 2}
\end{align*}
Here, as always, ``$\hom$'' denotes the group of continuous homomorphisms, and 
we write $\dQ^\times/2$ for $\dQ^\times/(\dQ^\times)^2$. The isomorphism 
$\h^1(\dQ,E[2])\simeq (\dQ^\times/2)^{\oplus 2}$ comes from Kummer theory. 
Given a homomorphism $\varphi:G_\dQ\to \dZ/2$, the group $\ker(\varphi)$ 
fixes a field $k=\dQ(\sqrt d)$ with $d\in \dQ^\times$. The equivalence class of 
$d$ in $\dQ^\times/2$ is dependent only on $\varphi$. The fact that 
$\varphi\mapsto d$ is a bijection is the content of Kummer theory. 

The boundary morphism in group cohomology gives us a map 
$\delta:E(\dQ)/2 \hookrightarrow \h^1(\dQ,E[2])$. The 
composite of $\delta$ with the isomorphism 
$\h^1(\dQ,E[2])\xrightarrow\sim )=(\dQ^\times/2)^{\oplus 2}$ is quite explicit 
-- we have for $x=(x_0:x_1:1)$:
\[
  \delta(x) 
    = \begin{cases}
        (1,1)             & \text{if $x=0$} \\
        (x_0-e_1,x_1-e_2) & \text{if $x_0\notin \{e_2,e_3\}$} \\
        \left(\frac{e_1-e_3}{e_1-e_2},e_1-e_2\right) & \text{if $x_0=e_1$} \\
        \left(e_2-e_1,\frac{e_2-e_3}{e_2-e_1}\right) & \text{if $x_0=e_2$}
      \end{cases}
\]
Let $S$ be the set of primes that divide $2(e_1-e_3)(e_2-e_3)(e_2-e_1)$; this 
contains the set of primes at which $E$ has bad reduction. We know that the 
group $\h^1(\dZ_S,E[2]) = \h^1(G_{\dQ,S},E[2])$ is finite. Even better, one can 
show that it is $\mathcal H^{\oplus 2}$, where 
\[
  \mathcal H = \left\{b\in \dQ^\times/2 : \text{$v_p(b)\equiv 0\pmod 2$ for $p\notin S$}\right\}
\]
The group $\mathcal H$ is generated by $S\cup\{-1\}$. This allows us to bound 
the rank of $E$. We know that $\dim_{\dF_2}(\mathcal H)\leqslant \# S+1$, so 
the fact that $E(\dQ)/2\hookrightarrow \mathcal H^{\oplus 2}$ implies 
$\rank(E) \leqslant 2(\# S+1)$. 

We know that $E(\dQ)/2\hookrightarrow \selmer_2(E)\subset \mathcal H^{\oplus 2}$, 
so we could get a better bound on $\rank(E)$ if we could compute 
the image of $\selmer_2(E)$ inside of $\mathcal H^{\oplus 2}$. Recall that there 
is a commutative diagram:
\[\xymatrix{
  & \h^1(\dZ_S,E[2]) \ar[r] 
    & \h^1(\dQ,E) \\
  0 \ar[r] 
    & E(\dQ)/2 \ar[r] \ar@{^{(}->}[u] 
    & \selmer_2(E) \ar[r] \ar@{^{(}->}[u] 
    & \sha(E)[2] \ar[r]
    & 0
}\]
For a pair $b=(b_1,b_2)\in \mathcal H^{\oplus 2}$, we get an element of 
$\h^1(\dQ,E)$. This gives us a torsor $X_b$ of $E/\dQ$. Observe that 
$b\in \selmer_2(E)$ if and only if $X_b(\dQ_p)\ne \varnothing$ for all $p$ and 
$X_b(\dR)\ne\varnothing$. 

The curve $X_b$ can be computed. We have $X_b\subset \dP_\dQ^3$, a nice curve 
of genus one defined by 
\begin{align*}
  b_1 z_1^2 - b_2 z_2^2 &= (e_2-e_1)z_0^2 \\
  b_1 z_1^2 - b_1 b_2 z_3^2 &= (e_3 -e_1) z_0^2
\end{align*}
\end{example}

\begin{example}
Let $E/\dQ$ be the elliptic curve $y=x^3-x=x(x-1)(x+1)$. We'll pick 
$e_1=0$, $e_2=1$, $e_3=-1$. For our curve we have $S=\{2\}$, so $\mathcal H$ is 
the subgroup of $\dQ^\times/2$ generated by $\{-1,2\}$. The group 
$\mathcal H^{\oplus 2}$ has representatives 
$\{(\pm 1,\pm 1),(\pm 2,\pm 1),(\pm 1,\pm 2),(\pm 2,\pm 2)\}$. We know that for 
$b=(b_1,b_2)\in (\dQ^\times)^2$, the curve $X_b$ is 
\begin{align*}
  b_1 z_2^2 - b_2 z_2^2 &= z_0^2 \\
  b_1 z_1^2 - b_1 b_2 z_3^2&=-z_0^2 \\
\end{align*}
Thus $X_b(\dR)=\varnothing$ if $b_1<0$ and $b_2>0$, or if 
$b>0$ and $b_2<0$. That tells us that 
$\selmer_2(E)\subset \{(b_1,b_2)\in \mathcal H^{\oplus 2}:b_1 b_2>0\}$, a group of 
order eight with representatives $\{\pm (1,1),\pm (2,1),\pm (1,2),\pm (2,2)\}$. 

We have 
\[\xymatrix{
  0 \ar[r] 
    & E(\dQ)/2 \ar[r]^-\delta 
    & \selmer_2(E) \ar@{^{(}->}[r] 
    & \langle-(1,1),-(2,1),-(1,2),-(2,2)\rangle
}\]
Since $E[2]\subset E(\dQ)$, this tells us that $E(\dQ)/2$ has order at least 
four. We have $\delta(E[2])=\{(1,1),(-1,-2),(-1,-1),(1,2)\}$. Consider 
$b=(2,1)$. Then $X_b$ is 
\begin{align*}
  2 z_1^2 - z_2^2 &= z_0^2 \\
  2 z_1^2 - 2 z_3^2 &= -z_0^2
\end{align*}
This curve has real points, so we only need to check $X_b(\dQ_2)$. As an 
exercise, show that $X_b(\dZ/4)=\varnothing$, which implies 
$X_b(\dQ_2)=\varnothing$, which shows that $b\notin \selmer_2(E)$, and thus 
$\# E(\dQ)/2=4$. Since $4=\# E[2]$, we know that $\rank(E)=0$. 
\end{example}










% notes on 10-03-2013
\section{Heights}\label{sec:heights}

Recall that to prove the Mordell-Weil theorem, we needed the weak Mordell-Weil 
theorem and a good height function. We gave an extremely terse introduction to 
heights earlier -- here we will do things more carefully. 

The idea is as follows. Let $X$ be a nice variety over a number field $k$. We 
want a function $H:X(k)\to \dR$ that measures the ``arithmetic complexity'' of 
a point. For example, $\frac 1 2$ and $\frac{100001}{200001}$ are very close in 
$\dR$, but we should think of the latter as being much more ``arithmetically 
complex.'' We would want $H$ to have properties arising from the geometry of 
$X$, and (this is very important), be such that the sets 
$\{x\in X(k):|H(x)|\leqslant c\}$ are finite for all $c$. 

Let's start with heights on projective space over $\dQ$. Consider a point 
$x=(x_0:\cdots:x_n)\in \dP^n(\dQ)$. After scaling by a rational number, we can 
assume that the $x_i\in \dZ$ and $\gcd(x_0,\dots,x_n)=1$. We set 
\[
  H_\dQ(x) = \sup\{|x_0|,\dots,|a_n|\}
\]
It is easy to see that this is well defined, but it doesn't work very well over 
a general number field. Returning to our example, we have 
$H_\dQ(\frac 1 2:1)=2$, while $H_\dQ(\frac{100001}{200001}:1)=200001$, which is 
much larger. 

Now let $k$ be a number field. Each finite place $v$ of $k$ is associated with 
a prime $\fp_v\subset \fo=\fo_k$. We set 
\[
  \|a\|_v = |a|_{\fp_v} 
        = \begin{cases}
            \#(\fo/\fp_v)^{-v_\fp(a)} & \text{if $a\ne 0$} \\
            0                         & \text{if $a=0$}
          \end{cases}
\]
We call $\|\cdot\|_v$ the canonical absolute value associated with $v$. If $v$ 
is a real place of $k$, i.e. $v$ corresponds with $i:k\hookrightarrow \dR$, we 
set $\|a\|_v = |i(a)|$. Similarly, if $v$ is a place corresponding to an 
embedding $i:k\hookrightarrow \dC$ with dense image, we set 
$\|a\|_v=|i(a)|^2$. Note that $\|\cdot\|_v$ is \emph{not} an absolute value 
because it doesn't satisfy the triangle inequality. Recall the following 

\begin{theorem}[product formula]
Let $k$ be a global field. For $a\in k^\times$, we have 
\[
  \prod_v \|a\|_v = 1
\]
\end{theorem}
\begin{proof}
We'll only look at $k=\dQ$. Take $a=\pm \prod_p p^{v_p(a)}\in \dQ^\times$. We 
have $\|a\|_p=p^{-v_p(a)}$ for each $p$, while $\|a\|_\infty = |a|$. Thus
\[
  \prod_v \|a\|_v = \|a\|_\infty\cdot \prod_p p^{-v_p(a)}  = \prod_p p^{v_p(a)}\cdot \prod_p p^{-v_p(a)} = 1
\]
For general $k/\dQ$, one uses the norm map $N:k\to \dQ$ to prove the product 
formula for $k$.
\end{proof}

For $k$ a general number field, we define $H_k:\dP^n(k)\to [1,\infty)$ by 
\[
  H_k(a_0:\cdots:a_n) = \prod_v \sup\{ \|a_0\|_v,\dots,\|a_n\|_v\}
\]
If $k=\dQ$ and the $a_i\in \dZ$ with $\gcd(a_0,\dots,a_n)=1$, then 
$\max\{|a_0|_p,\dots,|a_n|_p\}=1$. Thus 
$H_\dQ(a_0:\cdots:a_n)=\sup\{|a_0|,\dots,|a_n|\}$. The height $H_k$ is 
well-defined because of the product formula. For $c\in k^\times$, we have 
\[
  \prod_v \sup\{\|ca_0\|_v,\dots,\|ca_n\|_v\} = \prod_v \|c\|_v \prod_v \sup\{\|a_0\|_v,\dots,\|a_n\|_v\} = 1\cdot \prod_v \sup\{\|a_0\|_v,\dots,\|a_n\|_v\}
\]
which implies $H_k(c a_0:\cdots:c a_n)=H_k(a_0:\cdots:a_n)$. It turns out that 
for each $c\in \dR$, we have  
\[
  \#\{a\in \dP^n(k) : H_k(a)\leqslant c\} = O\left(c^{(N+1)[k:\dQ]}\right)
\]
In particular, the set on the left is finite. 

The \emph{absolute height} is a map $H:\dP^n(\bar\dQ)\to [1,\infty)$ is defined 
by $H(a) = H_k(a)^{[k:\dQ]^{-1}}$ for any $k\subset \bar\dQ$ with $a\in k$. 
The sets $\{x\in \dP^n(\bar\dQ):H(a)\leqslant c\}$ can be infinite, but the 
sets 
\[
  \{x\in \dP^n(\bar\dQ):H(a)\leqslant c\text{ and } [\dQ(x):\dQ]\leqslant d\}
\]
are finite. The \emph{logarithmic absolute height} is the map 
$h=\log H:\dP^n(\bar\dQ)\to [0,\infty)$. 

Let $X$ be a nice variety over $k$. We would like to define a reasonable height 
function on $X$. One way to do this is to take an embedding $\phi:X\to \dP^n$ 
(probably for some very large $n$) and let $h_\phi:X(\bar k)\to [0,\infty)$ be 
the composite $X(k) \xrightarrow\phi \dP^n(\bar k) \xrightarrow{h} [0,\infty)$. 
We can rephrase this. Let $D\in \divisor(X)$ be a very ample divisor. A choice of a 
generating set for the global sections of $\sL(D)$ gives an embedding 
$\phi_D:X\hookrightarrow \dP^n$. We write $h_D(\bar k)\to [0,\infty)$ for the 
composite 
$X(\bar k) \xrightarrow{\phi_D} \dP^n(\bar k)\xrightarrow{h} [0,\infty)$. Note 
that the notation $h_D$ is a little bit misleading, because $h_D$ actually 
depends on a choice of a generating set for $\sL(D)$. If we chose another 
generating set, getting an embedding $\phi_D'$ of $X$ into some projective 
space, then we have $h \phi_D - h \phi_D'=O(1)$, i.e. the two heights differ by 
a (globally) bounded function $X(\bar k)\to \dR$. So if we consider 
$h_D$ as an equivalence class in $\dR^{X(\bar k)}$, then $h_D$ is well-defined. 
If $E\sim D$ is another very ample divisor, then $h_D-h_E=O(1)$, so the 
equivalence class of $h_D$ only depends on the class of $D$ in the class group 
of $X$. Finally, if $E,D\in \divisor(X)$ are very ample, then 
$h_{D+E}=h_D+h_E+O(1)$. 

\begin{theorem}[Weil's ``height machine'']\label{thm:weil-height}
Let $X$ be a nice variety over a number field $k$. Then there exists a unique 
homomorphism $h:\picard(X)\to \dR^{X(\bar k)}/O(1)$ such that 
\begin{enumerate}
  \item If $D$ is very ample, then $h_D=h\circ \phi_D+O(1)$. (normalization)
  \item For a morphism $\phi:X\to Y$ of nice $k$-varieties, we have 
    $h_{X,\phi^\ast D} = h_{Y,D}\circ\phi + O(1)$ for all $D\in \divisor(Y)$. 
    (functoriality)
  \item For all $D$, $h_D\geqslant O(1)$ on the complement of the base locus 
    of $D$. (positivity)
\end{enumerate}
\end{theorem}
\begin{proof}
The existence and uniqueness of $h$ follows easily from the above remarks. For 
a proof of 2 and 3, see \cite[\S2.4]{bg06}. 
\end{proof}

The case we are interested in is when $X=A$ is an abelian variety over $k$. For 
$D\in \divisor(A)$, one can show (see \cite[I.5.4]{mi}) that 
$[n]^\ast D\sim \frac{n(n+1)}{2} D + \frac{n(n-1)}{2}[-1]^\ast D$. In 
particular, if $D$ is symmetric (that is, $[-1]^\ast D=D$) then 
$[n]^\ast D\sim n^2 D$. (There are plenty of symmetric divisors: if $D$ is 
arbitrary, $D+[-1]^\ast D$ is symmetric). By theorem \ref{thm:weil-height}, 
if $D$ is symmetric, we have 
\begin{align*}
  h_{A,D}\circ[n]+O(1)
    &= h_{A,[n]^\ast D} + O(1) \\
    &= h_{A,n^2 D}+O(1) \\
    &= n^2 h_{A,D}+O(1)
\end{align*}
So for all $x\in A(\bar k)$, we have 
$h_{A,D}(n\cdot x) = n^2 h_{A,D}(x)+O(1)$. In other words, repeated addition 
gives a quadratic growth in the ``complexity'' of a point $x\in A(\bar k)$. 

Fix a symmetric divisor $D\in \divisor(A)$. Define the \emph{canonical (or 
N\'eron-Tate) height} associated to $D$, as a function 
$\widehat h_D:A(\bar k)\to \dR$, by 
\[
  \widehat h_D(a) = \lim_{n\to \infty} \frac{1}{4^n} h_D(2^n\cdot a) \text{.}
\]










% class on 10-08-2013
Let's show that the limit defining $\widehat h_D$ exists. Our previous 
discussion shows that $|h_D(2\cdot x)-h_D(x)|\leqslant C$ for some constant $C$ 
depending only on $A$. We write this as $h_D(2\cdot x)=h_D(X)+O(1)$, keeping in 
mind that this $O(1)$ only depends on $A$. Note that 
\[
  \frac{h_D(2^i\cdot x)}{4^i} = \frac{h_D(2\cdot (2^{i-1}\cdot x))}{4^i} = \frac{4 h_D(2^{i-1}\cdot x)+O(1)}{4^i} = \frac{h_D(2^{i-1}\cdot x)}{4^{i-1}} + \frac{O(1)}{4^i} \text{.}
\]
Thus, for any $n>m$, we have 
\begin{align*}
  \left| \frac{h_D(2^n \cdot x)}{4^n} - \frac{h_D(2^m\cdot x)}{4^m}\right|
    &\leqslant \sum_{i=m+1}^n \left|\frac{h_D(2^i\cdot x)}{4^i} - \frac{h_D(2^{i-1}\cdot x)}{4^{i-1}}\right| \\
    &= \sum_{i=m+1}^n \left|\frac{h_D(2^{i-1}\cdot x)}{2^{i-1}} +\frac{O(1)}{4^i} - \frac{h_D(2^{i-1}\cdot x)}{2^{i-1}}\right| \\
    &\leqslant \sum_{i=m+1}^n \frac{C}{4^i} \text{,}
\end{align*}
which shows that $\left\{4^{-n} h_D(2^n\cdot x)\right\}_{n=1}^\infty$ is a Cauchy 
sequence. So the limit defining $\widehat h_D(x)$ exists. If we set $m=0$ and 
let $n\to \infty$, we see that $h_D=\widehat h_D+O(1)$. 

If $D$ is antisymmetric, we define 
$\widehat h_D(x)=\lim_{n\to\infty} \frac{1}{2^n} h_D(2^n\cdot x)$
The same proof shows that $\widehat h_D$ is well-defined. We can extend 
$\widehat h$ to a function $\widehat h:\divisor(A)\to \dR^{A(\bar k)}$ by setting 
\[
  \widehat h_D=\frac 1 2 \left(\widehat h_{D+[-1]^\ast D} +  h_{D-[-1]^\ast D}\right) \text{.}
\]
It turns out that $\widehat h_D$ depends only on the class of $\sL(D)$ in 
$\picard(A)$, so we will think of $\widehat h$ as a function 
$\widehat h:\picard(A) \to \dR^{A(\bar k)}$. 

For $c\in \picard(A)$, the N\'eron-Tate height $\widehat h_c$ has many nice 
properties, for example 
\begin{align*}
  \widehat h_c(n\cdot x) &= n^2 \widehat h_c(x) \\
  \widehat h_c(x+y)+\widehat h_c(x-y) &= 2\left(\widehat h_c(x)+\widehat h_c(y)\right)
\end{align*}
These are easy corollaries of the following lemma.

\begin{lemma}\label{lem:height-quadratic}
Let $A$ be an abelian variety over a number field $k$, and let $c\in \picard(A)$. 
Then the function 
$\langle \cdot,\cdot\rangle:A(\bar k)\times A(\bar k)\to \dR$ defined by 
\[
  \langle x,y\rangle = \widehat h_c(x+y)-\widehat h_c(x)-\widehat h_c(y)
\]
is bilinear. 
\end{lemma}
\begin{proof}
We are trying to prove that for $x,y,z\in A(\bar k)$, we have 
\[
  \widehat h_c(x+y+z)-\widehat h_c(x+y)-\widehat h_c(z) = \left(\widehat h_c(x+z)-\widehat h_c(x)-\widehat h_c(z)\right) + \left(\widehat h_c(y+z)-\widehat h_c(y)-\widehat h_c(z)\right) \text{.}
\]
This is equivalent to 
\begin{equation}\label{eq:height-quadratic}
  -\widehat h_c(x+y+z)+\widehat h_c(x+y)+\widehat h_c(x+z)+\widehat h_c(y+z)-\widehat h_c(x)-\widehat h_c(y)-\widehat h_c(z) = 0 \text{.}
\end{equation}
Now we use the fact that for a morphism $f:A\to B$ of abelian varieties, one has 
$\widehat h_{f^\ast c}=\widehat h_c\circ f$. For a finite set $S$ and 
$\sigma\subset S$, write $\pi_\sigma:A^S=\prod_S A\to A$ for the map 
$(x_s)_{s\in S}\mapsto \sum_{s\in\sigma} x_s$. With this, we can rewrite 
equation \eqref{eq:height-quadratic} as 
\[
  \sum_{\sigma\subset \{1,2,3\}} (-1)^{|\sigma|}\widehat h_c\circ \pi_\sigma = 0 \text{.}
\]
By the functoriality of $\widehat h$, it is enough to show that one has 
\[
  \sum_{\sigma\subset \{1,2,3\}} (-1)^{|\sigma|} \pi_\sigma^\ast = 0 \text{.}
\]
This is just the ``theorem of the cube'' (theorem \ref{thm:cube}). 
\end{proof}

The basic idea in this proof comes from the proofs of theorems 8.6.11 and 
9.2.8 in \cite{bg06}. 

\begin{theorem}\label{thm:cube}
Let $A$ be an abelian variety over a field $k$. For any finite set $S$ with 
$\# S\geqslant 3$, one has 
\[
  \sum_{\sigma\subset S} (-1)^{|\sigma|} \pi_\sigma^\ast = 0
\]
as a map $\picard(A)\to \picard(A^S)$. 
\end{theorem}
\begin{proof}
For $\# S=3$ this is just \cite[III.10]{mu08}. The general case follows easily 
by induction. 
\end{proof}



If $c$ is the class of a very ample line bundle, then 
$\widehat h_c\geqslant 0$ and for all $x\in A(\bar k)$, 
$\widehat h_c(x)=0$ if and only if $x$ is torsion. 
Indeed, if $x$ is torsion, then for some $n>1$, we have 
$n^2 \widehat h_c(x)=\widehat h_c(n x)=\widehat h_c(x)$, which implies 
$\widehat h_c(x)=0$. On the other hand, if $\widehat h_c(x)=0$, then 
$\widehat h_c(n\cdot x)=0$ for all $n$. The set 
$\{x,2\cdot x,3\cdot x,\dots\}$ is contained inside $A(L)$, where $L=k(x)$ is 
the finite extension of $k$ generated by (the coordinates of) $x$. Thus 
$\mathbb{N}\cdot x\subset \{a\in A(L):\widehat h_c(a)\leqslant 0\}$, which we 
know is a finite set. It follows that $x$ is torsion. 

\begin{example}
Let $E/\dQ$ be an elliptic curve. Then a divisor on $E$ is just a formal sum 
$\sum_{x\in E} n_x\cdot x$. Of course, $E$ has a canonical point -- the origin 
$O$, so for each $n\in \dZ$, we can consider the N\'eron-Tate height associated 
with $n O$. Since $\widehat h_{n O}=n \widehat h_O$, we don't lose any 
information by restricting ourselves to $n=1$, but since $O$ isn't very ample, 
we can only directly compute $h_{n O}$ starting with $n=2$. 

For $n=2$, the Riemann-Roch theorem tells us that $\ell(2 O)=2$, i.e. 
$\h^0(\sL(2 O)) = k\oplus k x$, where $x$ is a rational function on $E$. For 
$E$ with chosen model $y^2=x^3+a x+b$, $x$ the rational function corresponds to 
the map $E\to \dP^1$ given by $(x:y:1)\mapsto (x:1)$. Thus 
$h_{2 O}(x:y:1)=h_\dQ(x)$. 

For $n=3$, the divisor $3 O$ is actually very ample. By the Riemann-Roch 
theorem, $\ell(3 O)=3$, so $\h^0(\sL(3 O))=k\oplus k x\oplus k y$, where 
$(x:y:1):E\to \dP^2$ gives a Weierstrass embedding. That is, there exist 
$a,b$ such that $y^2=x^3+a x+b$, and $\phi_{3 O}:E\to \dP^2$ induces an 
isomorphism between $E$ and the zero set of $y^2=x^3+a x+b$ in $\dP^2$. 
One has $\widehat h_{3 O}(e)=h_\dQ(x(e):y(e):1)+O(1)$. 
\end{example}

Once again, let $c$ be the class of a symmetric, very ample line bundle on an 
abelian variety $A/k$. The function  
\[
  \langle x,y\rangle_c = \frac 1 2 \left(\widehat h_c(x+y) - \widehat h_c(x)-\widehat h_c(y)\right)
\]
is bilinear, and descends to $A(\bar k)/A(\bar k)_\text{tors}$. 
We can even tensor with $\dR$ to get a bilinear form on 
$A(k)_\dR = A(k)\otimes \dR$. The form $\langle \cdot,\cdot\rangle_c$ 
is positive-definite on $A(k)_\dR$. Thus $A(k)_\dR$ with the pairing 
$\langle\cdot\rangle_c$ is isomorphic to $\dR^n$ with the standard inner 
product, where $n=\rank A$. The group $A(k)/A(k)_\text{tors}$ is a 
lattice in $A(k)_\dR$, and we can define the \emph{regulator} of $A$ with 
respect to $c$ to be the volume of the fundamental domain of 
$A(k)/A(k)_\text{tors}$ in $A(k)_\dR$. That is, 
\[
  \operatorname{Reg}_c(A) = \left|\det\left(\langle x_i,x_j\rangle_c\right)_{i,j}\right|
\]
where $\{x_i\}$ is a $\dZ$-basis for $A(k)/A(k)_\text{tors}$. 


If $A$ is an arbitrary abelian variety, there is no natural ``good choice'' for 
a canonical divisor on $A$. On the other hand, if $A=J=\jac C$ for some nice 
curve $C$ of genus $g$ with $C(k)\ne\varnothing$, then we can use the induced 
embedding $j:C\to J$ to define a canonical divisor on $J$. Let 
$\Theta=j(C)+\cdots + j(C)$ be the $(g-1)$-fold sum of $C$ in $J$, and consider 
$\Theta$ as a divisor on $J$. We call $\Theta$, and the induced class $\theta$ 
in $\picard(J)$, the \emph{theta-divisor of $J$}.Note that if $J=E$ is an elliptic 
curve with origin $O$, the theta-divisor is just $O$.  It turns out that 
$\theta$ is ample (see \cite[8.10.22]{bg06}), and thus 
$\langle\cdot,\cdot\rangle_\theta$ is positive-semidefinite. For any 
$c\in \picard(J)$ for which $\langle\cdot,\cdot\rangle_c$ is 
positive-semidefinite, set 
$|x|_c=\sqrt{\langle x,x\rangle_c} = \widehat h_c(x)^{1/2}$. The following 
theorem is very deep.

\begin{theorem}[Vojta's inequality]
Let $C$ be a nice curve of genus $g\geqslant 2$ over a number field $k$. Let 
$J=\jac C$, and let $\theta$ be the theta-divisor on $J$. Then there are 
effectively computable constants $\lambda,\lambda'$ depending only on $C$ and 
a chosen $x_0\in C(\bar k)$ such that for $x,y\in C\hookrightarrow J$, if 
$|x|_\theta\geqslant \lambda$ and 
$|y|_\theta\geqslant \lambda'|x|_\theta$, then 

\[
  \langle x,y\rangle_\theta \leqslant \frac 3 4 |x|_\theta\cdot |y|_\theta\text{.}
\]
\end{theorem}
\begin{proof}
This is hard -- see \cite[11.9.1]{bg06}. The constant $\frac 3 4$ is not 
important, as the theorem would hold for any constant in the interval 
$(g^{-1/2},1]$. 
\end{proof}










% notes on 10-10-2013



\begin{theorem}[Faltings]
Let $C$ be a nice curve of genus $g\geqslant 2$ over a number field $k$. Then 
$C(k)$ is finite.
\end{theorem}
\begin{proof}
We can assume $C(k)\ne\varnothing$, so the choice of $x_0\in C(k)$ gives us an 
embedding $j:C\hookrightarrow J=\jac C$ defined over $k$. Let 
$V=J(k)\otimes_\dZ\dR$. By Mordell-Weil, this is a finite-dimensional 
vector space, and its rank is just the (algebraic) rank of $J$. The induced 
pairing $\langle\cdot,\cdot\rangle_\theta$ on $V$ is now a nondegenerate 
positive-definite bilinear form, so $V$ is isomorphic as a Hilbert space to 
$\dR^n$ with the standard dot product. Note that by basic properties of 
heights, $S$ is a discrete subset of $V$. 

For nonzero $u,v\in V$, the \emph{angle} between $u$ and $v$ is the unique 
number $\varphi(u,v)$ in $[0,\pi]$ satisfying 
\[
  \cos\varphi(u,v) = \frac{\langle u,v\rangle_\theta}{|u|_\theta |v|_\theta} \text{.}
\]
For a nonzero $v$ and fixed $\alpha\in (0,\pi]$, define the cone 
$\Gamma_{v,\alpha} = \{u\in V\smallsetminus 0 : \varphi(u,v)<\alpha\}$. This is an open 
subset of $V$ that is stable under scaling by $\dR^+$. Let $S$ be the image of 
$C(k)$ in $J(k)/J(k)_\text{tors}\hookrightarrow V$. Since $J(k)_\text{tors}$ is 
finite, we only need to show that $S$ is finite. 

Let $\psi = \frac 1 2 \cos^{-1}(\frac 3 4)$, and for nonzero $v\in V$, let 
$U_v=\Gamma_{v,\psi}$. We claim that $U_v\cap S$ is finite. If it is not, 
then there exist $x,y\in S\cap U_v$  such that $|x|_\theta>\lambda$ and 
$|y|_\theta>\lambda'|x|_\theta$. By Vojta's theorem, 
$\cos\varphi(x,y)\leqslant \frac 3 4$, so 
$\varphi(x,y)\geqslant \cos^{-1}(\frac 3 4)$. This forces 
$\varphi(x,u)\geqslant \psi$, a contradiction. 

The sets $\{U_v:v\in V\smallsetminus 0\}$ form an open cover of $V$. Since the unit 
sphere $\{v\in V:|v|=1\}$ is compact, there is a finite list 
$v_1,\dots,v_n\in V$ such that $V=U_{v_1}\cup \cdots \cup U_{v_n}$. Since each 
$U_{v_i}\cap S$ is finite, the set $S$ is finite. 
\end{proof}

This proof essentially gives an effectively computable upper bound for 
$\# C(k)$. Indeed, since the dimension of $V$ can be bounded above (for 
instance, by computing certain Selmer groups) it is possible to give an 
effectively computable upper bound for $\# C(k)$. On the other hand, the set 
$C(k)$ is not known to be effectively computable, because our proof does 
\emph{not} give a bound for the heights of points in $C(k)$.










\section{Tate modules}

Let's start with some motivation. Let $A$ be an abelian variety of dimension 
$d$ over $\dC$. We have seen that $G=A(\dC)$ is a compact connected complex Lie 
group. Moreover, $G$ is a \emph{torus}, i.e. is of the form $V/\Lambda$ for 
some complex vector space $V$ and lattice $\Lambda\subset V$. We can realize 
$G$ as a torus quite explicitly. 

Let $\fg=T_0 G$ be the Lie algebra of $G$. Since $G$ is commutative, the 
exponential map $\exp:\fg\to G$ is a group homomorphism, and so its image is 
open (since the map $T_0 \fg\to G$ is surjective). Since $G$ is connected, 
the image of $\exp:\fg\to G$ is all of $G$, and so we have an exact sequence 
\[\xymatrix{
  0 \ar[r] 
    & \Lambda \ar[r] 
    & \fg \ar[r]^-{\exp} 
    & G \ar[r] 
    & 0
}\]
There is a natural isomorphism $\Lambda\simeq \h_1(G,\dZ)$. Indeed, we can 
identify $\fg$ with the set of one-parameter subgroups of $G$, and such a 
subgroup has trivial exponential if and only if it is of the form 
$\dR\cdot \lambda$ for some $\lambda\in\Lambda$. But those are exactly the 
one-parameter subgroups that are also closed curves, hence 
$\Lambda\simeq \h_1(G,\dZ)$. Alternatively, we can use the pairing 
$\h_1(G,\dZ)\times \fg^\vee\to \dC$ given by 
$\langle \sigma,\omega\rangle=\int_\sigma\omega$ to define 
$\h_1(G,\dZ)\to \fg$, and show that it is an injection with image the kernel 
of the exponential map. 

For any $\phi\in \End(G)$, we have an induced map $\phi_\ast$ on 
$\h_1(G,\dZ)$. Tensoring with $\dQ$, we this gives a representation 
\[
  \End(G) \to \End_\dQ{\h_1(G,\dQ)} \simeq M_{2 d}(\dQ)
\]
This lets us take the characteristic polynomial $P_\phi\in \dQ[t]$ of $\phi$ 
for any $\phi\in \End(G)$. In fact, the degree $2 d$ polynomial 
$P_\phi$ is an element of $\dZ[t]$ because $\phi$ fixes the lattice 
$\h_1(G,\dZ)$ inside $\h_1(G,\dQ)$. 

Since $G=\fg/\Lambda$, we have $G[n]=\Lambda/n$, and thus there are natural 
isomorphisms $G[n]\simeq \h_1(G,\dZ/n)$ for all integers $n\geqslant 2$. 
We will think of $G[n]$ as a kind of algebraic avatar for $\h_1(G,\dZ/n)$. 
Unfortunately, there is no algebraic analogue of $\h_1(G,\dZ)$, but there is a 
good substitute. Let $\widehat\dZ=\varprojlim \dZ/n$ be the profinite 
completion of $\dZ$. The isomorphisms $G[n]\simeq \h_1(G,\dZ/n)$ are 
compatible, so we get an isomorphism of $\widehat\dZ$-modules 
\[
  T G = \varprojlim G[n] \to \varprojlim \h_1(G,\dZ/n) = \h_1(G,\widehat\dZ) \text{.}
\]
Since $\widehat\dZ=\prod_p \dZ_p$, we will consider $T G$ only one $p$-part at 
a time. This is important because if $A$ is an abelian variety over a field of 
characteristic $p>0$, the groups $A[p^e]$ are not well behaved, so the 
$p$-part of $T A=\varprojlim A[n]$ should be excluded. 

Let $A$ be an abelian variety of dimension $d$ over an algebraically closed 
field $k$. For the moment, we will think of $A[n]$ as a scheme -- namely 
the fiber product 
\[\xymatrix{
  A[n] \ar[r] \ar[d] 
    & 0 \ar[d] \\
  A \ar[r]^-n 
    & A 
}\]
If $n$ is invertible in $k$, then we will have 
$A[n]\simeq (\dZ/n)^{\oplus 2 d}$. However, if $n=p$ and $k$ has 
characteristic $p$, then for some $r\leqslant d$, 
there will be an isomorphism of group schemes 
\[
   A[p]\simeq (\dZ/p)^r\times \alpha_p^{2(d-r)}\times \mu_p^r \text{.}
\]
Here $\alpha_p(R)=\{r\in R:r^p=0\}$ and $\mu_p(R)=\{r\in R:r^p=1\}$ for any 
$\dF_p$-algebra $R$. One might hope that $A[p^e]$ can be described just as 
easily for $e>1$, but this is false. The group schemes $A[p^e]$ can exhibit 
very complicated behavior as $e\to \infty$. Indeed, their ``formal inductive 
limit'' $A[p^\infty]$, called the Barsotti-Tate group of $A$, carries quite a 
lot of information about $A$. 

For the rest of this section, fix a prime $\ell$ that is invertible in $k$. 
The groups $A[\ell^n]$ come with natural surjections 
$A[\ell^{n+1}]\to A[\ell^n]$ given by $x\mapsto \ell \cdot x$. 

\begin{definition}
Let $A$ be an abelian variety over a field $k$. The \emph{$\ell$-adic Tate 
module of $A$} is 
\[
  T_\ell A = \varprojlim A[\ell^n] = \{(a_1,a_2,\dots) : a_n\in A[\ell^n],\ell x_{n+1}=x_n\}
\]
\end{definition}

The Tate module $T_\ell A$ is a free $\dZ_\ell$-module of rank $2 d$. We write 
$V_\ell$ for $T_\ell(A)\otimes_{\dZ_\ell} \dQ_\ell$; this is a 
$\dQ_\ell$-vector space of dimension $2 d$. The main idea is that 
$A[\ell^n]$, $T_\ell(A)$ and $V_\ell(A)$ are algebraic analogues of 
$\h_1(A,\dZ/\ell^n)$, $\h_1(A,\dZ_\ell)$ and $\h_1(A,\dQ_\ell)$. 

Two things act on $T_\ell A$. The ring $\End(A)$ of endomorphisms 
of $A$ defined over $k$ (as an abelian variety) acts on each $A[\ell^n]$, and 
hence on $T_\ell$ and $V_\ell$. Also, the group $G_k=\gal(\bar k/k)$ acts 
compatibly on each $A[\ell^n]$, so we get a representation 
\[
  \rho_{A,\ell}:G_k\to \operatorname{GL}(T_\ell)\simeq \operatorname{GL}(2 d,\dZ_\ell) \text{.}
\]
The action of $\End(A)$ and $G_k$ commute, so we actually have a 
representation 
\[
  \rho_{A,\ell}:\End(A)\llbracket G_k\rrbracket \to M_{2 d}(\dZ_\ell) \text{.}
\]

\begin{theorem}[Faltings]
Let $A,B$ be abelian varieties over a finitely generated field $k$. Then 
the natural map 
\[
  \hom(A,B)\otimes\dQ_\ell \to \hom_{\dQ_\ell\llbracket G_k\rrbracket}\left(V_\ell A,V_\ell B\right)
\]
is an isomorphism. 
\end{theorem}

It follows that the functor 
$V_\ell:\mathsf{AbVar}_k\otimes\dQ_\ell\to \mathsf{Rep}_{\dQ_\ell}(G_k)$ is 
fully faithful. 

\begin{corollary}
Abelian varieties $A,B$ over a finitely generated field $k$ are isogeneous if 
and only if $V_\ell A$ and $V_\ell B$ are isomorphic as 
$\dQ_\ell\llbracket G_k\rrbracket$-modules.
\end{corollary}

If $k$ has characteristic $p$, set $T_p A=0$. We define the ``global Tate 
module'' of $A$ to be 
\[
  T A = \prod_p T_p A \text{.}
\]
This is a $\widehat\dZ$-module that is isomorphic (if $k$ has characteristic 
zero) to $\widehat\dZ^{2d}$. It turns out that $T A$, as a $G_k$-module, has a 
natural interpretation in terms of \'etale fundamental groups. If 
$U\to A_{k^s}$ is an \'etale cover of $A_{k^s}=A\otimes k^s$, then it turns out 
that $U$ can be given the structure of an abelian variety in such a way that 
$U\to A_{k^s}$ is an isogeny. We can use a polarization of $A_{k^s}$ to 
majorize $U\to A_{k^s}$ by an isogeny $A_{k^s}\to A_{k^s}$, which must be of 
the form $[n]$ for some $n\in k^\times$. It follows that 
$\pi^1(A_{k^s}) \simeq T A$, though see \cite[10.37]{gm13} for an actual 
proof. The standard exact sequence for fundamental groups:
\[\xymatrix{
  1 \ar[r] 
    & \pi_1(A_{k^s}) \ar[r] 
    & \pi_1(A) \ar[r] 
    & G_k \ar[r] 
    & 1
}\]
induces a representation 
$\rho:G_k\to \aut\left(\pi_1(A_{k^s})\right)$. It turns out that 
this is exactly the action of $G_k$ on $T A$, so that we get a canonical 
isomorphism 
\[
  \pi_1(A) \simeq G_k \ltimes_\rho T A \text{.}
\]
In particular, for each prime $\ell$ invertible in $k$, we have an isomorphism 
$\pi_1(A)^{(\ell)} \simeq T_\ell A\ltimes_{\rho_{A,\ell}} G_k$, where 
$(-)^{(\ell)}$ denotes taking pro-$\ell$ completion. 

It is possible to define the $\ell$-adic representation 
$\rho_A:G_k\to \operatorname{GL}(2d,\dZ_\ell)$ without introducing Tate 
modules. Let $A[\ell^\infty] = \bigcup_{n\geqslant 1} A[\ell^n]$. As an 
abelian group, $A[\ell^\infty]\simeq (\dQ/\dZ)[\ell^\infty]$, which we denote 
by $\dZ(\ell^\infty)$ (such groups are called quasi-cyclic). It is easy to 
show that $\End \dZ(\ell^\infty)\simeq \dZ_\ell$ as topological 
rings, where $\End \dZ(\ell^\infty)$ is given the subset topology in 
$\prod_{\dZ(\ell^\infty)} \dZ(\ell^\infty)$ and $\dZ(\ell^\infty)$ has the 
discrete topology. Thus 
$\aut A[\ell^\infty]\simeq \operatorname{GL}(2 d,\dZ_\ell)$. The induced 
homomorphism $G_k \to \operatorname{GL}(2 d,\dZ_\ell)$ is continuous, and 
(after a change of basis) is the same as $\rho_{A,\ell}$. 





% notes on 10-17-2013
\section{Endomorphisms of abelian varieties}

Let $A$ be an abelian variety of dimension $d\geqslant 1$ over a field $k$, 
and fix a polarization $\lambda:A\to A^\vee=\picard_A^\circ$. 

\begin{definition}
An abelian variety $A$ is \emph{simple} if the only abelian subvarieties of $A$ 
defined over $k$ are $0$ and $A$.
\end{definition}

Note that this definition depends on $k$; it is possible for a simple variety 
to become non-simple after base change. We say $A$ is \emph{geometrically 
simple} if $A_L$ is simple for all fields $L\supset k$ (equivalently, if 
$A_{\bar k}$ is simple). 

\begin{theorem}[Poincar\'e]
If $B\subset A$ is a nontrivial abelian subvariety, then there is another 
abelian subvariety $C\subset A$ such that the morphism $B\times C\to A$, 
$(b,c)\mapsto b+c$, is an isogeny. 
\end{theorem}
\begin{proof}
This is taken from \cite[I.10.1]{mi}. Let $i:B\hookrightarrow A$ be the 
inclusion, and let $i^\vee:A^\vee \to B^\vee$ be its dual map. Let 
$C=\ker(i^\vee\circ\lambda)^\circ$ be the connected component of the identity 
in the kernel of $A\xrightarrow\lambda A^\vee \xrightarrow{i^\vee} B^\vee$. 
Since dimension is additive on exact sequences of abelian varieties, we see 
that $\dim C\geqslant \dim A-\dim B^\vee=\dim A-\dim B$. It turns out that 
$(\lambda\circ i^\vee)|_B$ is a polarization of $B$, so $B\cap C$ is finite, 
hence dimension zero. It follows that $B\times C\to A$ is an isogeny. 
\end{proof}

There need not be a complement to $B$ ``one the nose.'' That is, there may not 
exist $C$ such that $A\simeq B\times C$. So the category of all abelian 
varieties is not semisimple, but the category of ``abelian varieties up to 
isogeny'' is. The theorem of Poincar\'e implies that for any abelian variety 
$A$, there exist simple abelian varieties $B_1,\dots,B_r$ such that $A$ is 
isogenous to $B_1\times\cdots \times B_r$. Standard arguments show that this 
decomposition is unique up to ordering and isogeny. 

Denote by $\mathsf{AbVar}_k^\mathrm{iso}$ the localisation of the category of 
abelian varieties over $k$ by the collection of all isogenies. Morphisms from 
$A$ to $B$ in $\mathsf{AbVar}_k^\mathrm{iso}$ are (equivalence classes) of 
formal factorizations 
\[\xymatrix{
  A 
    & C \ar[l]_-\phi \ar[r]^-f 
    & B
}\]
where $\phi$ is an isogeny. From \cite[V.18]{mu08}, there exists an integer $n$ 
and an isogeny $\psi:A\to C$ such that $\phi\psi=n$. The commutative diagram:
\[\xymatrix{
  & C \ar[dl]_-\phi \ar[dr]^-f \\
  A & A \ar[l]|-n \ar[u]|-\psi \ar[r]|-{f\psi} \ar@{=}[d] & B \\
  & A \ar[ul]^-n \ar[ur]_-{f\psi}
}\]
shows that the factorization $f\circ \phi^{-1}$ is equivalent to 
$(f\psi)\circ n^{-1}$. It follows that $\mathsf{AbVar}_k^\mathrm{iso}$ is 
equivalent to the localisation of $\mathsf{AbVar}_k$ at all isogenies of the 
form $A\xrightarrow n A$. Thus 
\[
  \hom_{\mathsf{AbVar}_k^\mathrm{iso}}(A,B) = \hom_{\mathsf{AbVar}_k}(A,B)\otimes\dQ \text{.}
\]

Write $\End(A)=\hom_{\mathsf{AbVar}_k}(A,A)$ for ring of endomorphisms of $A$ 
as an abelian variety over $k$. If $n\circ f=0$ for some $f:A\to A$, then the 
image of $f$ is contained in the (discrete) subvariety $A[n]\subset A$. Since 
$f(A)$ is irreducible, we have $f=0$. Thus $\End A$ is torsion-free, so it 
embeds into the ring
\[
  \End^\circ A = \End_{\mathsf{AbVar}_k^\mathrm{iso}}(A) = \End(A)\otimes\dQ \text{.}
\]
Since $\End^\circ A$ can be defined in terms of the category 
$\mathsf{AbVar}_{k}^\mathrm{iso}$, it only depends on the isogeny class of 
$A$. In particular, an isogeny $f:A\to B$ induces an isomorphism 
$\End^\circ A\xrightarrow\sim \End^\circ B$. 
There is an obvious inclusion $\End^\circ(A)^\times\supset\aut(A)$, and  
$f\in \End^\circ(A)^\times$ if and only if $n f$ is an isogeny for some $n$.

The group $\End(A)$ has rank at most $(2 g)^2$. Over $\dC$, this is obvious, 
given the faithful action of $\End(A)$ on $\h_1(A(\dC),\dZ)\simeq \dZ^{2g}$. 
The general case in characteristic zero follows from the Lefschetz principle, 
or one can prove it directly as in \cite[IV.18.3]{mu08}. 

Poincar\'e's reducibility theorem shows that an abelian variety $A$ is 
isogenous to a product $B_1^{e_1}\times \cdots \times B_r^{e_r}$, where the 
$B_i$ are simple and pairwise non-isogenous over $k$. A standard argument 
(which works in any semisimple abelian category) shows that the rings 
$D_i=\End^\circ(B_i)$ are division algebras, and moreover 
\[
  \End^\circ(A) \simeq \prod_{i=1}^r M_{e_i}\left(D_i\right) \text{.}
\]
Thus the ring $\End^\circ(A)$ is semisimple, so we know that both the $e_i$ and 
the $D_i$ are uniquely determined by $A$. It follows that the decomposition 
type of $A$ can be inferred from the ring $\End^\circ(A)$. 

\begin{example}
If $A$ is two-dimensional, then $A$ is either simple or a product of elliptic 
curves. If $A$ is simple, then $\End^\circ(A)$ is a division algebra. If $A$ 
is isogenous to $E\times E'$ where $E$ and $E'$ are not isogenous, then 
$\End^\circ(A)\simeq \End^\circ(E)\times \End^\circ(E')$. On the other hand, if 
$A$ is isogenous to $E\times E$, then 
$\End^\circ(A)\simeq M_2\left(\End^\circ(E)\right)$. 
\end{example}

We have remarked several times that there is no good ``algebraic definition'' 
of $\h_1(X,\dQ)$ for varieties $X$ over a general field. Serre constructed an 
example of a variety over $\overline\dF_p$ which shows not only that there 
isn't a good definition, but that such an homology group cannot exist. 

First, we need to discuss Frobenius morphisms. Let $p$ be a prime, $q$ a power 
of $p$, and $\dF_q$ the field with $q$ elements. Let $X$ be a nice variety over 
$\dF_q$. Choose an embedding $X\hookrightarrow \dP_{\dF_q}^n$. Write 
$\Phi_X:X\to X$ for the map that on projective coordinates is 
\[
  (a_0:\cdots:a_N) \mapsto (a_0^q:\cdots :a_N^q) \text{.}
\]
This is well-defined because $x\mapsto x^q$ is a ring homomorphism on 
$\dF_q$-algebras. So if $X$ is the zero-set of homogeneous polynomials 
$f_i\in \dF_q[x_0,\dots,x_n]$ and $a\in X$, then 
\[
  f_i(a_0^q:\cdots:a_n^q) = f_i(a_0:\cdots:a_n)^q = 0
\]
so $\Phi_X(a)\in X$. Note that we have to raise to the $q$-th power rather 
than the $p$-th power because $x\mapsto x^p$ does not fix all elements of 
$\dF_q$. 

There is a scheme-theoretic definition of $\Phi_X$ that allows us to talk about 
the Frobenius on arbitrary schemes over $\dF_q$. For a scheme $X/\dF_q$, let 
$\Phi_X:X\to X$ be the the identity on the underlying topological space of $X$, 
with $\Phi_X^\ast:\sO_X\to \sO_X$ the map $x\mapsto x^q$. If 
$X=V(f_1,\dots,f_r)\subset \mathbb{A}_{\dF_q}^n$, then it is easy to see that 
these definitions are equivalent, for both correspond to the usual Frobenius 
map on $\dF_q[x_1,\dots,x_n]/(f_1,\dots,f_r)$. 

It may seem confusing that the scheme-theoretic Frobenius is the identity on 
points, while our coordinate-wise definition raises elements to the $q$-th 
power. Actually, there is no contradiction. A point $x\in X$ with coordinates in 
$\dF_{q^n}$ should be thought of as a map $x:\spec(\dF_{q^n})\to X$. Raising 
those coordinates to the $q$-th power corresponds to composing $x$ with 
$\Phi_X$, or, equivalently, precomposing $x$ with the automorphism 
$x\mapsto x^q$ of $\dF_{q^n}$. 



\begin{example}[Serre]
Choose a prime $p\equiv 3\pmod 4$. Let $E/\overline\dF_p$ be the elliptic 
curve $y^2=x^3-x$. It is possible to give an explicit description of the 
division ring $D=\End^\circ(E)$. Fix $\alpha\in \dF_{p^2}$ such that 
$\alpha^2=-1$. Then $\phi:E\to E$, defined by $(x,y)\mapsto (-x,\alpha y)$, is 
a well-defined endomorphism. One has $\phi^2(x,y)=(x,-y)$, so $\phi^2=-1$ in 
$D$. Moreover, 
\[
  \Phi_E\phi(x,y) = (-x^p, \alpha^p y^p) = -(-x^p, \alpha^p y^p) = -\phi \Phi_E(x,y) \text{,}
\]
so $\phi \Phi=-\Phi \phi$ in $D$. It turns out that $\Phi^2=-p$, so $D$ is the 
standard quaternion algebra with parameters $(-1,-p)$, i.e.  
\[
  D = \dQ\left\langle i,j,k : i^2=-1,j^2=-p,i j=k, j i=-k\right\rangle \text{.}
\]
\end{example}

Now can show that ``$V=\h_1(E,\dQ)$'' cannot exist. If it did, we would expect 
it to be functorial in $E$, so there would be an action of $D$ on $V$. But we 
would also want $V$ to be two-dimensional over $\dQ$. Since $D$ is 
four-dimensional over $\dQ$, this would mean that $V$ has $D$-dimension $1/2$, 
which is nonsense. Alternatively, we would have an (injective) ring 
homomorphism $D\to \End(V)\simeq M_2(\dQ)$. Since both rings have the same 
dimension, this would yield $D\simeq M_2(\dQ)$. But $M_2(\dQ)$ has 
zero-divisors and $D$ does not, so this cannot be the case. 





% notes on 10-22-2013

Let $A$ and $B$ be abelian varieties over a field $k$. If $f:A\to B$ is an 
isogeny, the \emph{degree} of $f$ is $[k(A):k(B)]$ via the embedding 
$f^\ast:k(B) \to k(A)$ induced by $f$. Equivalently, $\deg(f)$ is the order 
of $\ker(f)$, considered as a group scheme. The extension $k(B)/k(A)$ is 
separable if and only if $f$ is \'etale, if and only if $\ker(f)$ is \'etale 
over $k$. If $f$ is \'etale, then the scheme-theoretic order of $\ker(f)$ is 
equal to $\# \ker (f)(\bar k)$. 

\begin{example}
Let $n\ne 0$, and consider the isogeny $[n]:A\to A$ that is multiplication by 
$n$. One can show that $\deg[n]=n^{2 d}$, where $d=\dim A$. To see this,  note 
that $A[n]=\ker[n]\simeq (\dZ/n)^{\oplus 2 d}$, at least if $n\in k^\times$. 
\end{example}

\begin{example}
If $A$ is defined over a finite field $\dF_q$, let $\Phi=\Phi_A:A\to A$ be the 
Frobenius. With some difficulty, one can show that $\Phi_A$ is purely 
inseparable (i.e. $k(A)/\Phi^\ast k(A)$ is purely inseparable) of degree 
$q^d$. Alternatively, $\ker(\Phi)(\bar k)=0$, so $\ker(f)$ is ``as far from 
\'etale as possible.'' 
\end{example}

Define a map $\deg:\End(A) \to \dZ$ as follows. If $f$ is an isogeny, let 
$\deg(f)$  be as above. If $f$ is not an isogeny, set $\deg(f)=0$. Given 
$f,g\in \End(A)$, one has $\deg(f g)=\deg(f)\cdot \deg(g)$. If one of $f,g$ is 
not an isogeny this is obvious, and if they are both isogenies, this follows 
from the multiplicativity of the degree of field extensions. As a special case, 
$\deg(n f)=n^{2 d}\deg(f)$. Using the multiplicativity of the degree map, we 
can extend it to $\deg:\End^\circ(A)\to \dQ$ by $\deg(f/n) = \deg(f)/n^{2 d}$. 
The degree map is \emph{not} additive. 

\begin{theorem}
Let $A$ be an abelian variety of dimension $d$. Then the map 
$\deg:\End^\circ(A) \to \dQ$ is a homogeneous polynomial of degree $2 d$. 
\end{theorem}

By this we mean the following. Choose a $\dQ$-basis $e_1,\dots,e_r$ of 
$\End^\circ(A)$. The theorem claims that there is a homogeneous polynomial 
$f\in \dQ[x_1,\dots,x_r]$ of degree $2 d$ such that 
\[
  \deg\left(c_1 e_1 + \cdots + c_r e_r\right) = f(c_1,\dots,c_r) \text{.}
\]
It follows that for any $\alpha\in \End(A)$, there exists a unique polynomial 
$P_\alpha\in \dQ[x]$, called the \emph{characteristic polynomial} of $\alpha$, 
such that $P_\alpha(n) = \deg(n-\alpha)$ for all $n\in \dZ$. It turns out that 
the polynomial $P_\alpha$ is monic, has degree $2 d$, and has integer 
coefficients. 

\begin{example}
Let $k$ be an imaginary quadratic field, $\fo=\fo_k$, and let 
$E=\dC/\fo$. One has $\End(E)=\fo$ and $\End^\circ(E)=k$. It turns out that the 
degree map $\deg:k\to \dQ$ is the classical norm map $N_{k/\dQ}$.
More generally, let $T$ be a complex torus, written $\dC^d/\Lambda$. Let 
$\alpha$ be an endomorphism of $T$. We can lift $\alpha$ to a linear map 
$\widetilde\alpha:\dC^d\to \dC^d$. One has 
\[
  \End(A) = \{\phi\in \End_\dC(\dC^d) : \phi(\Lambda)\subset \Lambda\} \text{.}
\]
Note that $\Lambda=\h^1(T,\dZ)$. It is straightforward to check that 
\[
  \deg(\alpha) 
    = \#\ker(\alpha) 
    = \#\widetilde \alpha^{-1}(\Lambda)/\Lambda 
    = \# (\Lambda/\widetilde\alpha\Lambda) 
    = \det(\widetilde\alpha,\h_1(T,\dZ)) 
    = \det\left(\alpha_\ast,\h_1(T,\dZ)\right) \text{.}
\]
Thus $\deg(n-\alpha)=\det(n\cdot 1-\alpha_\ast,\h_1(T,\dZ))$, so 
$P_\alpha=\det\left(t\cdot 1-\alpha_\ast,\h_1(T,\dZ)\right)$. 
\end{example}

Fix a prime $\ell\in k^\times$. Recall that we have an inverse system of 
$G_k$-modules 
\[\xymatrix{
  A[\ell] 
    & \ar[l]_-\ell A[\ell^2]
    & \ar[l]_-\ell A[\ell^3] 
    & \ar[l] \cdots
}\]
where here we think of $A[\ell^n]$ as $A(\bar k)[\ell^n]$. The inverse limit is 
$T_\ell A=\varprojlim A[\ell^n]$, and we set $V_\ell A=T_\ell A\otimes \dQ$. We 
call $T_\ell A$ and $V_\ell A$ the \emph{$\ell$-adic Tate modules associated with 
$A$}. We will use $V_\ell$ as an $\ell$-adic avatar for 
$\h_1(A,\dQ_\ell)$. In fact, $T_\ell A\simeq \h^1(\et A,\dZ_\ell)^\vee$ as a 
$G_k$-module. (This is essentially a tautology. For lisse $\ell$-adic sheaves 
$\sF$ on $A$, one has 
$\h^\bullet(A,\sF) = \h^\bullet\left(\pi_1(A),\sF_0\right)$, where $\sF_0$ is 
the stalk of $\sF$ at $0$. For $\sF=\dZ_\ell$, this gives 
$\h^1(\et A,\dZ_\ell) = \hom(T A,\dZ_\ell) = (T_\ell A)^\vee$.)

\begin{theorem}
Let $\ell$ be a prime invertible in $k$. For any $\alpha\in \End(A)$, we have 
$P_\alpha = \det(t\cdot 1-\alpha_\ast,T_\ell A)$. 
\end{theorem}
\begin{proof}
This is nontrivial. See \cite[I.10.20]{mi}. 
\end{proof}

\begin{corollary}
For $\alpha\in \End^\circ(A)$, we have $P_\alpha(\alpha)=0$. 
\end{corollary}
\begin{proof}
We use the fact (see \cite[I.10.15]{mi}) that the natural map 
\[
  \End(A)\otimes\dZ_\ell \to \End_{\dZ_\ell} \left(T_\ell A\right)
\]
is injective. In $\End(T_\ell A)$, one has $P_\alpha(\alpha)=0$ by the 
Cayley-Hamilton theorem. Injectivity tells us that 
$P_\alpha(\alpha)=0$ in $\End(A)\otimes\dZ_\ell$, and since $\End(A)$ is 
torsion-free, we see that $P_\alpha(\alpha)=0$ in $\End(A)$.
\end{proof}

From the theorem, we see that the characteristic polynomial of $\alpha$ acting 
on $T_\ell A$ is in $\dZ[t]$, and is independent of $\ell$. This is highly 
non-obvious. Note that $A\mapsto T_\ell A$ is a functor from abelian varieties 
over $k$ to $\dZ_\ell$-representations of $G_k$. If $k$ has characteristic $p$ 
and we want to assign a $p$-adic representation of $G_k$ to an abelian variety, 
we have to work harder. Of course, $T_p A$ is a $\dZ_p$-module with a 
$G_k$-action, but there examples when $\rank_{\dZ_p} T_p A < 2\dim A$. In this 
case, instead of studying $T_p A$, (essentially the $p$-adic \'etale cohomology 
of $A$) one should study the crystalline or rigid cohomology of $A$. If the 
base field $k$ is perfect, these yield $W(k)$-modules with the ``correct'' 
rank. For a brief survey of crystalline cohomology, see \cite{il94}, and for an  
introduction to rigid cohomology, see \cite{st07}. 










% 10-24-13
\section{Abelian varieties over finite fields}

Let $A$ be an abelian variety over $\dF_q$, where $q$ is a power of $p$. For 
example, $A$ could be the jacobian of a smooth curve. Recall that there is a 
distinguished endomorphism $\Phi=\Phi_A$ of $A$, called the Frobenius of $A$. 
If we embed $A$ into some projective space $\dP^n$, then in coordinates we 
have $\Phi(x_0:\cdots:x_n) = (x_0^q:\cdots:x_n^q)$. As a morphism of schemes, 
$\Phi$ is the identity on the underlying space of $A$, and is the $q$-th power 
map on $\sO_A$. Let $d\geqslant 1$ be the dimension of $A$. 


\subsection*{Characteristic polynomial of Frobenius}

Recall that there is a polynomial $P_A=P_{\Phi_A}\in \dZ[t]$ of degree $2 d$ 
such that $P_A(n)=\deg(n-\Phi_A)$ for all integers $n$. Also, if $\ell$ is a 
prime not dividing $q$, $P_A$ is the characteristic polynomial of $\Phi_\ast$ 
as a $\dZ_\ell$-linear map $\Phi_\ast:T_\ell A\to T_\ell A$. Thus we have a 
map $P:\mathsf{AbVar}_{\dF_q} \to \dZ[t]$. 

\begin{theorem}
If $A$ and $B$ are isogenous abelian varieties over $\dF_q$, then 
$P_A=P_B$.
\end{theorem}
\begin{proof}
Let $f:A\to B$ be an isogeny. For each $e$, we have an exact sequence 
\[\xymatrix{
  0 \ar[r] 
    & C \ar[r] 
    & A[\ell^e] \ar[r]^-f 
    & A[\ell^e] \ar[r]
    & 0\text{,}
}\]
where $C$ is independant of $e$ if $e\gg 1$ (since $C\subset \ker(f)$, a finite 
group). At the level of Tate modules, if $f_\ast(x)=0$, then 
$f(x_i)=0$ in $B[\ell^i]$ for all $i$, so each $x_i\in C$. But $C$ is a finite 
group, so it contains no nonzero sequences $(x_i)$ with $\ell x_{i+1}=x_i$ for 
all $i$. Thus $x=0$, so $f_\ast:T_\ell A\to T_\ell B$ is injective. Since 
$T_\ell A$ and $T_\ell B$ have the same rank, the map 
$f_\ast:V_\ell A\to V_\ell B$ is an isomorphism. (So far we have shown that 
$V_\ell A$ is isogeny-invariant over any field.) It is easy to check that 
$f\circ \Phi_A=\Phi_B\circ f$. It follows that 
$f_\ast\circ (\Phi_A)_\ast = (\Phi_A)_\ast \circ f$, and from this we see that 
$P_A=P_B$. 
\end{proof}

Alternatively, we could note that 
$T_\ell:\mathsf{AbVar}_k\to \mathsf{Rep}_{\dZ_\ell}(G_k)$ naturally descends to 
a functor 
$V_\ell:\mathsf{AbVar}_k\otimes\dQ\to \mathsf{Rep}_{\dZ_\ell}(G_k)\otimes\dQ$. 
Since $\mathsf{AbVar}_k\otimes\dQ=\mathsf{AbVar}_k^\text{iso}$ and 
$\mathsf{Rep}_{\dZ_\ell}(G_k)\otimes\dQ=\mathsf{Rep}_{\dQ_\ell}(G_k)$, this 
gives a functor 
\[
  V_\ell:\mathsf{AbVar}_k^\text{iso} \to \mathsf{Rep}_{\dQ_\ell}(G_k) \text{.}
\]
Here and elsewhere, if $\cA$ is an additive category, we write 
$\cA\otimes\dQ$ for the localization of $\cA$ at the class of morphisms 
$n\cdot 1_A$, $n\in \dZ\smallsetminus 0$.

It turns out that $P_A(0)=\deg(-\Phi_A)=\deg(\Phi_A)=q^g$; this can be verified 
by a direct (but messy) computation. A more interesting quantity is 
$P_A(1)=\deg(1-\Phi)$. Let $f=1-\Phi$. We claim that $f:A\to A$ is \'etale. 
Essentially, the map $d f:\operatorname{Lie}(A) \to \operatorname{Lie}(A)$ is 
the identity, and this comes down to the fact that the differential of 
Frobenius is zero (morally, $\frac{d}{dx}x^q=q x^{q-1}=0$). Thus 
$P_A(1)=\# \ker(f)$. Note that $f(x)=0$ if and only if $\Phi(x)=x$, i.e. 
$x\in A(\dF_q)$. So $P_A(1)=\#A(\dF_q)$. This has a surprising consequence: the 
quantity $\# A(\dF_q)$ is isogeny-invariant! This fails badly over number 
fields. 

Let's specialize to elliptic curves. Let $E$ be an elliptic curve over 
$\dF_q$. We have $P_E(t)=t^2-a t+q$, for some integer $a=a(E)$. One calls $a$ 
the trace of Frobenius. Indeed, $a=\trace(\Phi_{E,\ast},T_\ell)$ for 
all $\ell\ne p$. Since $\# E(\dF_p)=P_A(1)=1-a+q$, we could have defined 
$a=1+q-\# E(\dF_q)$. Since $\# \dP^1(\dF_q)=q+1$, we can think of $a$ as an 
arithmetically interesting ``error term'' measuring how much $E(\dF_q)$ and 
$\dP^1(\dF_q)$ differ. 

\begin{theorem}[Hasse bound]
We have $|a| \leqslant 2\sqrt q$, i.e. 
\[
  | \# E(\dF_q) - (q+1)| \leqslant 2\sqrt q \text{.}
\]
\end{theorem}
\begin{proof}
Let $n\in\dQ$, and take $P_E(n)=n^2-a n+q = \deg(n-\pi_E)\geqslant 0$. Thus 
$t^2-a t+q\geqslant 0$ for all $t\in \dR$. Basic calculus tells us that 
$a^2-4 q\leqslant 0$, i.e. $|a|\leqslant 2\sqrt q$. 
\end{proof}

An equivalent way of formulating the Hasse bound is to claim that the complex 
roots of $P_E$ have absolute value $\sqrt q$. Indeed, one computes 
\[
  \left|\frac{a\pm \sqrt{a^2-4 q}}{2}\right| 
    = \left|\frac{a\pm \sqrt{4 q-a^2} i}{2}\right| 
    = \sqrt{\frac{a^2}{4} + \frac{4 q-a^2}{4}}
    = \sqrt q \text{.}
\]
If $6$ is a unit in $\dF_q$, then we can write $E$ as $y^2=x^3+a x+b$. It 
follows that 
\[
  \# E(\dF_q) = q+1 + \sum_{x\in \dF_q} \left(\frac{x^3+a x+b}{q}\right) \text{,}
\]
where $\big(\frac{c}{q}\big)=0$ if $c=0$, $1$ if $c$ is a square in $\dF_q$, 
and $-1$ otherwise. 

A special case of the Honda-Tate theorem says that for each integer $a$ with 
$|a|\leqslant 2\sqrt{q}$, there is an elliptic curve $E$ over $\dF_q$ with 
$a(E)=a$. So the Hasse bound is sharp. Moreover, we will see that $a(E)$, and 
hence $P_E$, determines $E$ up to isogeny. 

\begin{example}
Fix a prime $p\equiv 3\pmod 4$, and consider the elliptic curve $E$ over 
$\dF_p$ given by the equation $y^2=x^3-x$. Recall that 
$\End^\circ(E_{\dF_{p^2}})$ was a quaternion algebra over $\dQ$, of type 
$(-1,-p)$. We used the fact that $\Phi_E^2=-p$, but didn't prove this. We 
know that $P_E(\Phi_E)=0$, i.e. $\Phi_E^2-a \Phi_E+p$, so all we need to do 
is show that $a=0$. Since $a=p+1-\# E(\dF_p)$, we just need to show that 
$\# E(\dF_p)=p+1$. The two sets 
\begin{align*}
  \{x\in \dF_p &: x^3-x\in (\dF_p^\times)^2\} \\
  \{x\in \dF_p &: x^3-x\notin (\dF_p)^2\}
\end{align*}
are bijective via $x\mapsto -x$. Call their common cardinality $m$. 
Since $\#\{x\in \dF_p:x^3-x=0\} = 3$, we have $p=2 m+3$, so 
$\# E(\dF_p)=2 m+3+1=p+1$. 
\end{example}


\subsection*{Zeta functions}

Let $A$ be an abelian variety over $\dF_q$. We can consider its base extension 
$A_{\dF_{q^n}}$, which is an abelian variety over $\dF_{q^n}$. It has a 
characteristic polynomial $P_{A_{\dF_{p^n}}}$. Write 
\[
  P_A(t) = \prod_{i=1}^{2 d} (x-\omega_i) \text{,}
\]
where the $\omega_i\in \dC$. 

\begin{theorem}\label{thm:char-poly-power}
We have $P_{A_{\dF_{q^n}}}(t) = \prod_{i=1}^{2 d} (x-\omega_i^n)$. 
\end{theorem}
\begin{proof}
Let $A'=A_{\dF_{q^n}}$, and fix a prime $\ell\nmid q$. We have equality 
$V_\ell A = V_\ell A'$; write $V$ for this vector space. The Frobenius 
on $A$ induces a linear map $\Phi_{A,\ast}:V\to V$ with characteristic 
polynomial $P_A$. We have $\Phi_A^n=\Phi_{A'}^n$ as morphisms on $A'$, so 
$\Phi_{A',\ast} = \Phi_{A,\ast}^n$, whence the result. 
\end{proof}

Let's look at the case where $E/\dF_q$ is an elliptic curve. We have 
$P_E(t)=t^2-a t+q$, where $a=a(E)\in \dZ$ is the trace of Frobenius acting on 
$T_\ell E$ for any $\ell\nmid q$. Recall that since $P_E(1)=\# E(\dF_q)$, we 
get $a=q+1-\# E(\dF_q)$. Moreover, we showed that $|a|\leqslant 2\sqrt q$. 
Equivalently, the roots of $P_E$ have absolute value $q^{1/2}$. 

\begin{theorem}[Weil]
Let $A$ be an abelian variety over $\dF_q$. Then the roots of $P_A$ in $\dC$ 
have absolute value $q^{1/2}$. 
\end{theorem}

Back to the case of elliptic curves. We can factor 
$P_E(t)=(t-\omega_1)(t-\omega_2)$ where $\omega_1+\omega_2=a$ and 
$\omega_1 \omega_2 = q$. We know that 
\[
  P_{E_{\dF_{q^n}}}(t) = (x-\omega_1^n)(x-\omega_2^n) 
    = x^2 - (\omega_1^n + \omega_2^n) t + q^n \text{,}
\]
so $\# E(\dF_{q^n}) = q^n+1 - (\omega_1^n+\omega_2^n)$. Recall that the 
\emph{zeta function} of $E$ is the formal power series 
\[
  Z(E,t) = \exp\left(\int \sum_{n\geqslant 1} \# E(\dF_{q^n}) t^n\, \frac{dt}{t}\right) \text{.}
\]
We can compute:
\begin{align*}
  \int \sum_{n\geqslant 1} \# E(\dF_{q^n}) t^n\, \frac{dt}{t}
    &= \sum_{n\geqslant 1} \# E(\dF_{q^n}) \frac{t^n}{n} \\
    &= \sum \frac{(q t)^n}{n} + \sum \frac{t^n}{n} - \sum \frac{(\omega_1 t)^n}{n} - \sum \frac{(\omega_2 t)^n}{n} \\
    &= -\log(1-q t) - \log(1-t) + \log(1-\omega_1 t) + \log(1-\omega_2 t) \\
    &= \log\left(\frac{(1-\omega_1 t)(1-\omega_2 t)}{(1-t)(1-q t)} \right) \text{.}
\end{align*}
It follows that 
\[
  Z(E,t) = \frac{1-a t+q t^2}{(1-t)(1-q t)} \text{.}
\]
Note that the numerator is $t^2 P_E(1/t)$. 

\begin{example}
Let $E/\dF_5$ be the elliptic curve $y^2=x^3+x+2$. One can check directly that 
$E(\dF_5) = \{0,(1,\pm 2), (4,0)\}$. Thus $\# E(\dF_5) = 4=5+1-a$, so $a=2$. 
It follows that $P_E(t) = t^2-2 t+5$ and 
$Z(E,t) =\frac{1-2 t+5 t^2}{(1-t)(1-5 t)}$. In this case, 
\[
  \sum_{n\geqslant 1} \# E(\dF_{5^n}) t^n = t\frac{d}{dt}\log Z(E,t)
    = 4t + 32 t^2 + 148 t^3 + 640 t^4 + 3044 t^5 + O(t^6) \text{.}
\]
\end{example}

One puts $\zeta(E,s) = Z(E,q^{-s})$. The fact that the zeros of 
$P_E$ have absolute value $q^{1/2}$ implies that the zeros of 
$\zeta(E,s)$ have real part $\frac 1 2$. So the ``Riemann hypothesis'' for 
$\zeta(E,s)$ is a theorem!


\subsection*{Honda-Tate theory}

\begin{definition}
A \emph{$q$-Weil number} is an algebraic integer $\omega\in \bar\dQ$ such that 
under any embedding $\dQ(\omega)\hookrightarrow\dC$, the image of $\omega$ has 
absolute value $q^{1/2}$. 
\end{definition}

Two $q$-Weil numbers $\omega,\omega'$ are \emph{conjugate} if there exists a 
field isomorphism $\sigma:\dQ(\omega) \to \dQ(\omega')$ such that 
$\sigma(\omega)=\omega'$, i.e. $\omega$ and $\omega'$ lie in the same 
$G_\dQ$-orbit in $\bar\dQ$. Equivalently, $\omega$ and $\omega'$ are conjugate 
if they have the same minimal polynomial over $\dQ$. 

It is easy to check if a given algebraic integer $\omega$ is $q$-Weil. Let 
$k=\dQ(\omega)$, and classify embeddings $k\hookrightarrow \dC$. The number 
$\omega$ is $q$-Weil if and only if $\omega\bar\omega = q$ in each such 
embedding.  

\begin{theorem}[Honda-Tate]
Let $A$ be an abelian variety over $\dF_q$. 
\begin{enumerate}
  \item If $A$ is simple, then $P_A(t) = h(t)^e$ for an irreducible polynomial 
    $h\in \dZ[t]$ and $e\geqslant 1$.
  \item The map 
    \[
      \{\text{isogeny classes of simple abelian varieties over $\dF_q$}\} \to \{\text{conjugacy classes of $q$-Weil numbers}\}
    \]
    sending $A$ to the set of roots in $\bar\dQ$ of $P_A$, is a bijection. 
  \item Fix $h\in \dZ[t]$ the minimal polynomial of a $q$-Weil number. Then 
    there exists a unique $e\geqslant 1$ such that $h^e$ is $P_A$ for a simple 
    $A/\dF_q$. In fact, it is the smallest $e\geqslant 1$ such that 
    \begin{itemize}
      \item $h(0)^e>0$ 
      \item for every monic $\dQ_p$-irreducible factor $g\in \dQ_p[t]$ of $h$, 
        we have $v_p(g(0)^e)\in r\dZ$, where $q=p^r$. 
     \end{itemize}
\end{enumerate}
\end{theorem}

The injectivity of the map is due to Tate, and the surjectivity is due to 
Honda. 

\begin{corollary}
The map 
\[
  \{\text{isogeny classes of elliptic curves over $\dF_q$}\} \to \{a\in \dZ:|a|\leqslant 2\sqrt q\}
\]
given by $E\mapsto a(E)=\trace(\Phi_E,T_\ell E) = q+1-\# E(\dF_q)$ is a bijection. 
\end{corollary}

\begin{example}
The number $\sqrt 5 i$ is $5$-Weil, with minimal polynomial $t^2+5$. The 
conditions of part 3 of the Honda-Tate theorem show that there exists an 
abelian variety $E$ over $\dF_5$ such that $P_E=t^2+5$. As an exercise, check 
that $E:y^2=x^3+1$ works. 
\end{example}

\begin{example}
The number $\sqrt 5$ is $5$-Weil with minimal polynomial $t^2-5$. It is easy to 
check that $e=2$, so there is a (simple) abelian variety $A$ over $\dF_5$ such 
that $P_A(t) = (t^2-5)^2$. One can show that $P_{A_{\dF_{25}}}(t) = (t-5)^4$. 
Since $5$ is a $25$-Weil number, there exists an elliptic curve $E$ over 
$\dF_{25}$ such that $P_E(t)=(t-5)^2$. We will find that $A_{\dF_{25}}$ is 
isogenous to $E\times E$. 
\end{example}





% notes on 10-31-2013

\begin{lemma}
Let $A$ and $B$ be abelian varieties over $\dF_q$. Then 
$P_{A\times B}=P_A\times P_B$. 
\end{lemma}
\begin{proof}
On $A\times B$, we have $\Phi_{A\times B}=\Phi_A\times \Phi_B$. Fix 
$\ell\nmid q$, and consider $V_\ell(A\times B)=V_\ell A\oplus V_\ell B$. On 
$V_\ell(A\times B)$, we have 
$\Phi_{A\times B,\ast} = \Phi_{A,\ast}\times \Phi_{B,\ast}$. So it comes down 
to showing that the characteristic polynomial of $f\oplus g$ is the product of 
the respective characteristic polynomials. But this is obvious. 
\end{proof}

For any abelian variety $A$ over $\dF_q$, the Poincar\'e reducibility theorem 
implies $A$ is isogenous to $\prod B_i^{n_i}$, where the $B_i$ are simple and 
pairwise non-isogenous. The lemma gives 
$P_A=P_{\prod B_i^{n_i}} = \prod P_{B_i}^{n_i}$, where the $P_{B_i}$ are powers 
of distinct irreducible polynomials. If we started with $P_A$, we could factor 
it as $P_A=\prod h_i^{m_i}$, where the $h_i$ are distinct monic irreducible 
integral polyomials. For each $h_i$, there is a unique (and computable) 
$e_i\geqslant 1$ such that $h_i^{e_i} = P_{B_i}$. Thus 
$P_A=\prod P_{B_i}^{n_i}$, where $n_i=m_i/e_i$. 

\begin{theorem}
Let $A$ and $B$ be abelian varieties over $\dF_q$. Then $A$ and $B$ are 
isogenous if and only if $P_A=P_B$.
\end{theorem}

We can rephrase this as: $A$ and $B$ are isogenous if and only if 
$V_\ell A$ and $V_\ell B$ are isomorphic $G_{\dF_q}=\widehat\dZ$-modules.

Let $A$ be a simple abelian variety over $\dF_q$. Let 
$D=\End^\circ(A)=\End_{\dF_q}(A)\otimes\dQ$; this is a division algebra over 
$\dQ$. Then the field $F=\dQ(\Phi_A)$ is contained in the 
center of $D$. 

\begin{theorem}
Let $A$ be a simple abelian variety over $\dF_q$. Then 
\begin{enumerate}
  \item $D=\End^\circ(A)$ has center $F=\dQ(\Phi_A)$ 
  \item $\dim_F D = e^2$, where $P_A =h^e$ with $h$ irreducible
  \item $2\dim A = e\cdot [F:\dQ]$. 
\end{enumerate}
\end{theorem}

The division algebra $D$ can be described explicitly from $\Phi_A$. You can 
give local invariants that classify it over each $F_v$, where $v$ ranges over 
the places of $F$. 

The previous remark merits some explanation. Let $k$ be an arbitrary field. 
Let $\brauer(k)$, be the set of isomorphism classes of division algebras with 
center $k$. The set $\brauer(k)$ has a highly non-obvious group structure. For 
$D,D'\in \brauer(k)$, there is a unique $D''\in \brauer(k)$ such that 
$D\otimes_k D'\simeq M_n(D'')$ for some $n$. Set $D''=D+D'$. Under this 
operation, $\operatorname{Br}(k)$ is an abelian group, where the inverse of 
$D$ is opposite algebra $D^\circ$. It turns out (see 
\cite[X.5]{se79}) that $\brauer(k)$ is naturally isomorphic to the Galois 
cohomology group $\h^2(G_k,(k^s)^\times) = \h^2(k,\dG_m)$. If $k$ is a 
nonarchimedean local field, there is a canonical isomorphism 
$\brauer(k) \to \dQ/\dZ$, so to specify a division algebra with center $k$ is 
the same as giving an element of $\dQ/\dZ$. 

Suppose $k$ is a number field. If $v$ is a place of $k$, then the operation 
$D\mapsto D\otimes_k k_v$ defines a homomorphism $\brauer(k) \to \brauer(k_v)$. 
It turns out that the image of $D$ under this map is $0$ for all but finitely 
many $v$. In fact, we have an exact sequence
\[\xymatrix{
  0 \ar[r] 
    & \brauer(k) \ar[r] 
    & \displaystyle\bigoplus_v \brauer(k_v) \ar[r] 
    & \dQ/\dZ \ar[r] 
    & 0 \text{.}
}\]
This is very deep -- at the level of the main theorems of class field theory. 
For a proof of this (and the rest of class field theory) see 
\cite[2.86]{sh92}. In any case, to give an element of $\brauer(k)$, it is 
sufficient to  give an element of $\brauer(k_{v_i})=\dQ/\dZ$ for finitely many 
finite places $v_1,\dots,v_r$ and an element of $\brauer(\dR)=\dZ/2$ for each 
real place of $k$.

\begin{example}
Let $E$ be an elliptic curve over $\dF_q$ with $P_E=x^2+q$. Then $\Phi_E^2=-q$, 
so $F=\dQ(\Phi_E)\simeq\dQ(\sqrt{-q})$. It follows that $e=1$, so  
$\End^\circ(E)=\dQ(\Phi_E)$. 
\end{example}

\begin{example}
Let $E$ be an elliptic curve over $\dF_q$ such that $P_E$ is reducble. Then 
$P_E(t)=(t-\omega)^2$, where $\omega\in \dZ$ with $|\omega|=q^{1/2}$. It 
follows that $q$ is a square and $\omega=\pm q^{1/2}$. Then 
$\Phi_E=\omega\in \dZ$, so $F=\dQ(\Phi_E)=\dQ$ and $e=2$. The division ring  
$\End^\circ (E)$ is a quaternion algebra (we saw an example earlier). 
\end{example}


\subsection*{Curves and their jacobians} % maybe the Weil conjectures -> new section?

Here and elsewhere we will consider alternating sums 
\[
  \sum (-1)^i \trace(f_i,H_i)
\]
where $f_\bullet:H_\bullet \to H_\bullet$ is a graded linear endomorphism of a 
locally finite-dimensional graded vector space. We will write 
$\trace(f_\bullet,H_\bullet)$, or sometimes just $\trace(f,H)$, for this 
alternating sum. 

Let's start with some motivation. Let $X$ and $Y$ be smooth oriented manifolds 
of dimension $n$. Let $f:X\to Y$ be a smooth map that is finite-to-one. For 
$x\in X$, we can choose small neighborhoods $U,V$ of $x$ and $y=f(x)$ such 
that $U$ and $V$ are $n$-balls, and for which $f:U\to V$ is injective. 
The relative homology $\h^n(U,U\smallsetminus x)$ and $\h^n(V,V\smallsetminus y)$ are 
both isomorphic to $\dZ$ with a canonical basis coming from the orientation. 
With respect to these bases, $f_\ast$ is multiplication by an integer, called 
the \emph{degree of $f$ at $x$}, and denoted $\deg_x f$. 

\begin{theorem}[Lefschetz]
Let $f:X\to X$ be smooth with finitely many nondegenerate fixed points. Then 
we have 
\[
  \sum_{x\in X^f} \deg_x f = \trace(f_\ast,\h_\bullet(X,\dQ))
\]
\end{theorem}
If $f$ is ``well-behaved'' around each fixed point, the local degrees are all 
one, so the theorem reduces to $\# X^f=\trace(f_\ast,\h_\bullet(X,\dQ))$. If 
$X$ is a Riemann surface, the alternating sum is 
\[
  \trace(f_\ast,\h_0(X,\dQ)) - \trace(f_\ast,\h_1(X,\dQ)) + \trace(f_\ast,\h_2(X,\dQ))\text{.}
\]

There is an analogue of the Lefschetz fixed point theorem for \'etale 
cohomology. Let $X$ be a nice variety over a field $k$, and let 
$f:X\to X$ be an arbitrary morphism. Let $\ell$ be a prime invertible in $k$. 
It is proven in \cite[IV.3.3]{de77} that one has 
\[
  (\Gamma_f \cdot \Delta_X) = \trace(f^\ast,\h^\bullet(X,\dQ_\ell))\text{.}
\]
Here $(\Gamma_f\cdot \Delta)$ is the intersection number of the graph of $f$ 
and the diagonal as cycles in $X\times X$. If $k=\dF_q$ and $f=\Phi$ is the 
Frobenius on $X$, then $\Gamma_\Phi$ and $\Delta_X$ intersect transversally 
with multiplicity one, so 
$(\Gamma_\Phi\cdot \Delta_X)=\# X^\Phi=\# X(\dF_q)$. More generally (see 
\cite[IV.3.7]{de77}) we have
\[
  \# X(\dF_{q^n}) = \sum (-1)^i \trace({\Phi^n}^\ast, \h^i(X,\dQ_\ell)) \text{.}
\]

If $X=C$ is a nice curve over $\dF_q$, we can be much more concrete. The 
alternating sum has only three terms:
\[
  \# C(\dF_{q^n}) = \trace(\Phi^n,\h^0(C,\dQ_\ell)) - \trace^1(\Phi^n,\h^0(C,\dQ_\ell)) + \trace(\Phi^n,\h^2(C,\dQ_\ell))
\]
One can show that the trace on $\h^0(C,\dQ_\ell)$ is $1$, while the trace on 
$\h^2(C,\dQ_\ell)$ is $q^n$. Let $J$ be the jacobian of $C$. Since 
$\h^1(C,\dQ_\ell)^\vee \simeq V_\ell J$ as $G_{\dF_q}$-modules, we have 
\[
  \# C(\dF_{q^n}) = q^n+1 - \trace(\Phi_\ast^n, V_\ell J) \text{.}
\]
The following theorem is a straightforward consequence of the Lefschetz fixed 
point theorem and Theorem \ref{thm:char-poly-power}. 

\begin{theorem}
Let $C$ be a nice curve over $\dF_q$ of genus $g$. Let $J$ be its jacobian, and 
write $P_J(t) = \prod_{i=1}^{2 g} (x-\omega_i)$. Then 
\[
  \# C(\dF_{q^n}) = q^n+1 - (\omega_1^n + \cdots + \omega_{2 g}^n) \text{.}
\]
\end{theorem}

\begin{corollary}
$\# C(\dF_{q^n}) - (q^n+1)| \leqslant 2 g q^{n/2}$.
\end{corollary}










\bibliographystyle{amsplain}
\bibliography{7390-sources}

\end{document}

% !TEX root = 7390-notes.tex





\section{Some theorems of Faltings}





\subsection{Background and Tate's conjecture}

The goal of this section is to describe the relationships between a web of 
conjectures that Faltings proved in his groundbreaking paper 
\cite{fa86}. 

Let $A$ be a $d$-dimensional abelian variety over a field $k$. As usual, we 
write $\bar k$ for the algebraic closure of $k$ and $G_k=\gal(\bar k/k)$ for 
the absolute Galois group of $k$. Fix a prime $\ell$ invertible in $k$. The 
groups $A[\ell^n] = \{x\in A(\bar k):\ell^n x=0\}$ are abstractly isomorphic 
to $(\dZ/\ell^n)^{\oplus 2d}$, and carry a continuous action of $G_k$. They 
fit into an inverse system 
\[\xymatrix{
  A[\ell] 
    & A[\ell^2] \ar[l]_-\ell 
    & A[\ell^3] \ar[l]_-\ell 
    & \cdots \ar[l]
}\]
Put 
\[
  T_\ell A = \varprojlim A[\ell^n] = \left\{(x_n)\in \prod A[\ell^n] : \ell x_{n+1} = x_n\right\} \text{.}
\]
This is the \emph{$\ell$-adic Tate module of $A$}. As a $\dZ_\ell$-module, 
$T_\ell A \simeq \dZ_\ell^{\oplus 2 d}$. What makes $T_\ell A$ interesting is 
that it carries a continuous action of $G_k$, induced by the action of $G_k$ 
on the $A[\ell^n]$. In other words, after choosing a basis of $T_\ell A$, we 
have a continuous representation 
\[
  \rho_{A,\ell} : G_k \to \gl{2 d}{\dZ_\ell} \text{.}
\]

The action of $G_k$ on $T_\ell A$ factors through 
the smaller group $\operatorname{GSp}(2 n,\dZ_\ell)$ of symplectic simlitudes. 
One sees this via the \emph{Weil pairing}. There is, for any $n$ invertible in 
$k$, a natural perfect pairing $A[n]\times A^\vee[n] \to \mu_n$, defined at the 
level of schemes. For a prime $\ell$ invertible in $k$, these pairings patch 
together to give a perfect $G_k$-equivariant pairing 
$T_\ell A \times T_\ell A^\vee \to \dZ_\ell(1)$. After a choice of polarization 
$\lambda:A\to A^\vee$, we get an (alternating) pairing 
$T_\ell A\times T_\ell A\to \dZ_\ell(1)$. If $\ell$ is relatively prime to the 
degree of $\lambda$, then this pairing is perfect. In what follows, we will 
always assume this to be the case. For a proof of these facts in a pretty 
general setting, see \cite[11]{gm13}. 

It is natural to ask how much $\rho_{A,\ell}$ ``knows about'' $A$, especially 
if $k$ is a number field, or more generally, a finitely generated field. 

Let $X$ be a nice variety over a finitely generated field $k$. For each $i$, 
there is a canonical homomorphism 
\[
  \operatorname{cl}:\chow^i(X) \to \h^{2 i}(X,\dQ_\ell)(i)\text{,}
\]
defined in \cite[VI 2.2.10]{de77}. One calls $\operatorname{cl}(Z)$ the 
cohomology class associated with a cycle $Z$. 

\begin{conjecture}[Tate]
The set $\h^{2 i}(X,\dQ_\ell)(i)^{G_k}$ is the $\dQ_\ell$-subspace of $\h^{2 i}(X,\dQ_\ell)$ 
generated by $\operatorname{cl}(\chow^i(X))$. 
\end{conjecture}

This is essentially Conjecture 1 in \cite{ta65}. Often, ``the Tate conjecture'' 
means the following special case. 

\begin{conjecture}[Tate]
Let $A,B$ be abelian varieties over a finitely generated field $k$. For any 
prime $\ell$ invertible in $k$, the natural map 
\[
  \hom_k(A,B)\otimes\dQ_\ell \to \hom_{G_k}(V_\ell A, V_\ell B) 
\]
is a bijection. 
\end{conjecture}

See the remarks after Conjecture 1 in Tate's paper for a proof that the second 
conjecture follows from the first. Another way of stating the (second version 
of the) Tate conjecture is that for any finitely generated field $k$, the 
functor $V_\ell:\mathsf{AbVar}_k^\text{iso} \to \mathsf{Rep}_{G_k}(\dQ_\ell)$ 
is fully faithful. 

\begin{example}
Let $k=\dF_q$ be a finite field. Then $G_k$ is naturally isomorphic to 
$\widehat\dZ$, the profinite completion of $\dZ$. Here $1\in \widehat\dZ$ 
corresponds to the \emph{arithmetic Frobenius} $\frob_q\in G_{\dF_q}$, given by 
$x\mapsto x^q$. Representations 
$\rho:G_{\dF_q} \to \gl{n}{\dQ_\ell}$ are determined by 
$\rho(\frob_q)$. If such a representation is semisimple, the 
\emph{Brauer-Nesbitt theorem} tells us that $\rho$ is determined by the 
characteristic polynomial of $\rho(\frob_q)$. For an abelian variety $A$ over 
$\dF_q$, we know that the characteristic polynomial of 
$\rho_{A,\ell}(\frob_q)$ is $P_A(t)\in \dZ[t]$, which determines $A$ up to 
isogeny by Honda-Tate theory. 
\end{example}

Since we will be using characteristic polynomials quite a lot, let us state a 
suitably general version of the Brauer-Nesbitt theorem. Fix a field $k$, and 
for an arbitrary group $G$, let $K_0(G)$ denote the Grothendieck group of 
finite-dimensional $k$-representations of $G$. By the ``characteristic 
polynomial'' of a representation $\rho:G \to \operatorname{GL}_k(V)$, we mean 
the map $\chi_\rho:G\to \Lambda(k)=1+t k\llbracket t\rrbracket$ defined by 
\[
  \chi_\rho(g) = \frac{1}{\det(1-\rho(g)\cdot t, V)} \text{.}
\]
Alternatively, $t\frac{d}{dt} \log \chi_\rho(g) = \sum \trace(\rho(g)^n)$. 

\begin{theorem}[Brauer-Nesbitt]
If $S$ spans $k[G]$ as a $k$-vector space, then the map 
$\chi:K_0(G) \to \Lambda(k)^S$ given by $[\rho]\mapsto \chi_\rho$ is an 
injection. 
\end{theorem}
\begin{proof}
This is Theorem 5.21 of \cite{eg11}. 
\end{proof}

\begin{corollary}
If $k$ has characteristic zero and 
$\rho_1,\rho_2:G \to \operatorname{GL}_k(V)$ are two semisimple representations 
with identical characters, then $\rho_1\simeq \rho_2$. 
\end{corollary}






% notes on 11-26-2013

\begin{theorem}[Faltings' isogeny theorem]
Let $A$ and $B$ be abelian varieties over a number field $k$. For any prime 
$\ell$, we have $\rho_{A,\ell}\simeq \rho_{B,\ell}$ as $G_k$-modules if and 
only if $A$ and $B$ are isogenous over $k$. 
\end{theorem}

From this, we see that we can fruitfully study $A$ via $\rho_{A,\ell}$. For 
example, the rank of an abelian variety only depends on its isogeny class, so 
$\rank A$ only depends on $\rho_{A,\ell}$. 

If $k$ is either finite or a global field, the representation $\rho_{A,\ell}$ 
is semisimple, so $\rho_{A,\ell}$ is determined by the characteristic 
polynomial of $\rho_{A,\ell}(\frob_q)$. For this, one needs the 
\emph{\v Cebotarev density theorem}. 





\subsection{Image of Frobenius for number fields}

Fix a number field $k$, and a finite place $v$ of $k$. Let 
$\fp\subset \fo=\fo_k$ be the corresponding maximal ideal. Let $k_v$ be the 
completion of $k$ at $v$. We choose $\bar k\subset \overline{k_v}$; this gives 
a map $G_{k_v} \to G_k$, defined by $\sigma\mapsto \sigma|_{\bar k}$. This map 
is only well-defined up to conjugation. By Krasner's lemma, the map is an 
injection. Reduction modulo $\fp$ gives a homomorphism 
$G_{k_v} \to G_{\kappa_v}=\widehat\dZ$, where $\kappa_v = \fo_v/\fp$ is the 
residue field of $\fp$. This map is surjective, so we have an exact sequence 
(where we write $D_v$ for the image of $G_{k_v}$ in $G_k$):
\[\xymatrix{
  1 \ar[r] 
    & I_v \ar[r] 
    & D_v \ar[r] 
    & \widehat\dZ \ar[r] 
    & 1 \text{.}
}\]
The group $G_{\kappa_v}$ is procyclic, with generator 
$\frob_{N v}$, where as usual $N v = \# \kappa_v$. Write $\frob_v$ for a lift 
of $\frob_{N v}$ to $D_v$. The element $\frob_v\in G_k$ is only well-defined up 
to conjugacy and multiplication by $I_v$. 

As before, let $A$ be an abelian variety over $k$ with good reduction at $v$. 
Then (by definition) there exists an abelian scheme $\cA$ over $\fo_v$ whose 
generic fiber is $A_{k_v}$. The scheme $\cA$ fits into a commutative diagram 
with cartesian squares: 
\[\xymatrix{
  A_v \ar[r] \ar[d] 
    & \cA \ar[d] 
    & A_{k_v} \ar[l] \ar[d] \\
  \spec(\kappa_v) \ar[r] 
    & \spec(\fo_v) 
    & \spec(k_v) \ar[l] 
}\]
We have define $A_v=\cA_{\kappa_v}$. The property of being abelian is stable 
under base change, so $A_v$ is an abelian variety over $\kappa_v$, and we have 
a reduction map 
\[
  A(k_v) = \cA(\fo_v) \to \cA(\kappa_v) = A_v(\kappa_v) \text{.}
\]
Extending to algebraic closures, we get a map 
$A(\overline{k_v}) \to A_v(\overline{\kappa_v})$. This is a homomorphism with 
pro-$p$ kernel. Let $\ell\nmid v$ (i.e. $\ell$ is relatively prime to the 
residue characteristic of $v$). At the level of torsion, we have isomorphisms 
\[
  A(\overline{k_v})[\ell^n] \to A_v(\overline{\kappa_v})[\ell^n] \text{.}
\]
The map is injective because its kernel is pro-$p$, and it is surjective by 
cardinality considerations -- both groups have cardinality $(\ell^n)^{2 d}$). 
This gives us an isomorphism 
$A(\bar k)[\ell^n] = A(\overline{k_v})[\ell^n]\xrightarrow\sim A_v(\kappa_v)[\ell^n]$. 
These groups have (compatible) actions of $G_k$, $G_{k_v}$ and $G_{\kappa_v}$. In 
particular, the inertia group $I_v$ acts trivially on $A(\bar k)[\ell^n]$. 

It follows that $\frob_v$, \emph{a priori} only well-defined up to conjugacy 
and multiplication by $I_v$, has a well-defined action on $A[\ell^n]$, and 
hence on $T_\ell A$. That is, we have the following theorem. 

\begin{theorem}\label{thm:ab-var-good}
Let $A$ be an abelian variety over $k$ with good reduction at $v$. Then for 
$v\nmid \ell$, we have  
\begin{enumerate}
  \item $\rho_{A,\ell}$ is unramified at $v$ (i.e. $\rho_{A,\ell}(I_v) = 1$) 
  \item $\rho_{A,\ell}(\frob_v)$ is well-defined up to conjugacy and has 
    characteristic polynomial $P_{A_v}(t)$ with integer coefficients that do 
    not depend on $\ell$. 
\end{enumerate}
\end{theorem}
\begin{proof}
See \ref{sec:char-frob} for a definition of $P_{A_v}(t)$. This is Theorem 1, 
paired with the corollary to Theorem 3 in \cite{st68}. 
\end{proof}

Recall the \v Cebotarev density theorem. Let $k$ be a number field, $K/k$ a 
finite Galois extension. For $v$ unramified in $K/k$, there is a well-defined 
conjugacy class $\frob_v\in \gal(K/k)^\natural$. \v Cebotarev's density theorem 
is essentially the Sato-Tate conjecture for the motive 
$h(\spec K)$, i.e. it predicts equidistribution of Frobenii, in the appropriate 
sense. 

\begin{theorem}[\v Cebotarev]
Let $K/k$ be a finite Galois extension of number fields with Galois group $G$. Then 
$\{\frob_v\}\subset G^\natural$ is equidistributed with respect to the Haar 
measure on $G$. 
\end{theorem}
\begin{proof}
See \cite[1.2.2]{se68} for a beautiful proof using the representation theory of 
compact groups. 
\end{proof}

Recall that the statement ``$\{\frob_v\}\subset G^\natural$ is 
equidistributed'' means that for any conjugacy class $C\subset G$, we have 
\[
  \lim_{x \to \infty} \frac{\{\# v : N v \leqslant x \text{ and } \frob_v\in C\}}{\# \{v:N v\leqslant x\}} = \frac{\# C}{\# G}
\]
It follows that each conjugacy class in $G$ is Frobenius for infinitely many 
primes.  

For example, if $k=\dQ$ and $K=\dQ(\zeta_n)$, then $\gal(K/\dQ)$ is naturally 
isomorphic to $(\dZ/n)^\times$. For $p\nmid n$, the Frobenius $\frob_p$ 
corresponds to $p\in (\dZ/n)^\times$. Dirichlet's theorem says that for 
$a\in (\dZ/n)^\times$, there exist infinitely many $p$ such that 
$p\equiv a\pmod n$, i.e. the \v Cebotarev density theorem holds for cyclotomic 
extensions. 

\begin{theorem}[N\'eron-Ogg-Shafarevich]
Let $A$ be an abelian variety over a number field $k$. Let $v$ be a place of 
$k$, and let $\ell$ be a prime with $v\nmid \ell$. Then $A$ has good reduction 
at $v$ if and only if $\rho_{A,\ell}$ is unramified at $v$. 
\end{theorem}
\begin{proof}
This is the main theorem of \cite{st68}. 
\end{proof}





\subsection{\texorpdfstring{$L$}{L}-function of an abelian variety}

Let's define the $L$-function of an arbitrary abelian variety over a number 
field $k$. For a place $v$ of $k$, choose a prime $\ell$ with $v\nmid \ell$. 
The action of $\frob_v$ on $T_\ell A$ is only well-defined up to the action of 
$I_v$, but $(T_\ell A)_{I_v} = T_\ell A / \{\sigma x-x:x\in I_v\}$ has a 
well-defined action of $\frob_v$. Define
\begin{align*}
  L_v(A,t) &= \det\left(1-\rho_{A,\ell}(\frob_v)\cdot t,(T_\ell A)_{I_v}\right) \\
  L(A,s) &= \prod_{v\nmid \infty} L_v\left(A,(N v)^{-s}\right)^{-1} \text{.}
\end{align*}
This is well-defined by the following theorem. 

\begin{theorem}
Let $A$ be an abelian variety over a number field $k$. For any finite place 
$v$, the local factor $L_v(A,t)$ is an element of $\dZ[t]$ that does not depend 
on $\ell$. 
\end{theorem}
\begin{proof}
For $v$ a place of good reduction, this is Theorem \ref{thm:ab-var-good}. The 
general case is a bit more subtle. Characteristic polynomials are invariant 
under transpose, so we can replace $(T_\ell A)_{I_v}$ with its dual 
\[
  \left((T_\ell A)_{I_v}\right)^\vee = \left((T_\ell A)^\vee\right)^{I_v} = (T_\ell A(-1))^{I_v} = (T_\ell A)^{I_v}(-1) \text{,}
\]
the second inequality coming from the Weil pairing and third coming from 
the fact that the $\ell$-adic cyclotomic character is unramified at 
$v\nmid \ell$. 

Let $\cA$ be the N\'eron model for $A$ over 
$\fo_v$, and let $A_v$ be the connected component of the identity in 
$\cA_{\kappa_v}$. By Lemma 2 of \cite{st68}, there is a $D_v$-equivariant 
isomorphism $(T_\ell A)^{I_v} \to T_\ell A_v$. 

Chevalley's theorem (see \cite{co02} for a modern proof) gives us a linear 
algebraic group $G\subset A_v$ such that $B=A_v/G$ is an abelian variety. In 
other words, we have a short exact sequence 
\[\xymatrix{
  1 \ar[r] 
    & G \ar[r] 
    & A_v \ar[r] 
    & B \ar[r] 
    & 0 \text{.} 
}\]
The group $G$ splits into a product $G=T\times U$, where $T$ is a (possibly 
non-split) torus and $U$ is unipotent. The group $U$ will be an iterated 
extension of copies of $\dG_a$, so $T_\ell U=0$. 

Let $\widehat T=\hom_{\bar k}(T_{\bar k},\dG_{m,\bar k})$ be the group of 
characters of $T$. This has an obvious continuous $G_k$-action, and there is a 
$G_k$-equivariant pairing 
\[
  T_\ell T \otimes \widehat T \to \dZ_\ell(1) \text{,}
\]
given by $(x_n)_n\otimes \chi \mapsto (\chi(x_n))_n$. It is easy to see (by 
base-change to $\bar k$) that this pairing is nondegenerate, so we have a 
$G_k$-isomorphism $T_\ell T \simeq \widehat T^\vee \otimes \dZ_\ell(1)$. 
We obtain 
\[
  \det(1-\rho_{A_v,\ell}(\frob_v)\cdot t) = \det(1-\rho_{B,\ell}(\frob_v)\cdot t,T_\ell B(-1)) \cdot \det(1-\frob_v\cdot t,\widehat T\otimes \dZ_\ell) \text{.}
\]
Since $T_\ell B(-1)\simeq T_\ell B^\vee$ and $G_k$ acts on 
$\widehat T\otimes \dZ_\ell$ via its action on $\widehat T$, the characteristic 
polynomial of Frobenius is an element of $\dZ[t]$ independent of $\ell$. 
\end{proof}

Let's check that our definition of $L(A,s)$ agrees with our previous definition 
in the case that $A=E$ is an elliptic curve over $k$. If $E$ has good reduction 
at $v$, $(T_\ell E)_{I_v}=T_\ell E$ and there is nothing to prove. If $E$ has 
bad reduction at $v$, then as before let $E_v$ be the connected component 
of the special fiber of the N\'eron model at $v$. Recall that $E$ has 
\emph{multiplicative reduction} at $v$ if $E_v$ is a torus, and \emph{additive 
reduction} if $E_v$ is unipotent. Clearly  
\[
  \rank_{\dZ_\ell} (T_\ell E)^{I_p}
  =
  \begin{cases}
    2 & \text{good reduction} \\
    1 & \text{mult. reduction} \\
    0 & \text{add. reduction}
  \end{cases}
\]
If $E$ has split multiplicative reduction at $v$, then the local factor 
$L_v(E,t)$ is the (reverse of) the characteristic polynomial of Frobenius 
acting on $T_\ell \dG_m(-1) = \dZ_\ell$. On the other hand, if $E$ has 
nonsplit multiplicative reduction at $v$, then by \cite[III,2.5]{si06}, 
$E_v$ splits after a quadratic base-change, from which we see that 
$\frob_v$ acts on $\widehat E_v$ as $-1$, whence the following: 
\[
  L_v(E,t) = 
    \begin{cases}
      1 & \text{additive reduction} \\
      1-t & \text{split multiplicative reduction} \\
      1+t & \text{nonsplit multiplicative reduction} \\
      1 - a_p t + p t^2 & \text{good reduction} 
    \end{cases}
\]

The function $L(A,s)$ should have an analytic continuation, functional equation, 
it should satisfy BSD ($\ord_{s=1} L(A,s) = \rank_\dZ A(\dQ)$), and a ``fancy BSD'' 
with a precise prediction of the coefficient in Taylor series. 
By the Weil conjectures, the function $L(A,s)$ converges on some region 
$\{\Im s>c\}$. 





\subsection{Tate conjectures and isogenies}

We begin with the following useful theorem.

\begin{theorem}\label{thm:trace-determines-rep}
Let $k$ be a number field and $\rho_1,\rho_2:G_k \to \gl{n}{\dZ_\ell}$ 
continuous semisimple representations. If 
$\trace \rho_1(\frob_v) = \trace \rho_2(\frob_v)$ for all $v$ in a density-one 
set of places, then $\rho_1\simeq \rho_2$. 
\end{theorem}
\begin{proof}
By the \v Cebotarev density theorem, the set $\{\frob_v\}\subset G_k^\natural$ 
is dense. It follows that $\trace \rho_1 = \trace \rho_2$, so the conclusion 
follows from the Brauer-Nesbitt theorem. 
\end{proof}

We are mainly interested in the case when $\rho_1=\rho_{A,\ell}$ and 
$\rho_2=\rho_{B,\ell}$ for $A,B$ abelian varieties over $k$. The theorem tells 
us that if $P_{A_v} = P_{B_v}$ for almost all primes, then 
$\rho_{A,\ell}\simeq \rho_{B,\ell}$. A morphism $f:A\to B$ of abelian varieties 
induces a $G_k$-equivariant morphism $f_\ast:T_\ell A \to T_\ell B$. If $f$ is 
an isogeny, then $f_\ast$ is an isomorphism after tensoring with $\dQ$. In 
particular, if we think of $\rho_{A,\ell}$ as a $\dQ_\ell$-representation, then 
$\rho_{A,\ell}\simeq \rho_{B,\ell}$. It follows that $A$ and $B$ have the same 
bad primes. 

The following theorem was conjectured by Tate, and proved when $k$ is a finite 
field. 

\begin{theorem}[Faltings]
Let $k$ be a finitely generated field and $A,B$ abelian varieties over $k$. 
Then 
\begin{enumerate}
  \item (Semisimplicity) The representation  $\rho_{A,\ell}$ is semisimple. 
  \item (Tate conjecture) The natural map
    \[
      \hom(A,B)\otimes\dZ_\ell \to \hom_{G_k}(T_\ell A,T_\ell B)
    \]
    is an isomorphism. 
\end{enumerate}
\end{theorem}
\begin{proof}
See \cite{fa86} for a proof when $k$ is a number field. 
\end{proof}

\begin{corollary}[Isogeny theorem]\label{thm:isogeny-thm}
Abelian varieties $A$ and $B$ over a number field $k$ are isogenous if and only 
if $\rho_{A,\ell}$ and $\rho_{B,\ell}$ are isomorphic. 
\end{corollary}
\begin{proof}
We've already seen that if $A$ and $B$ are isogenous, then 
$\rho_{A,\ell}\simeq \rho_{B,\ell}$. The Tate conjecture gives us an 
isomorphism 
\[\xymatrix{
  \hom(A,B)\otimes\dZ_\ell \ar[r]^-\sim 
    & \hom_{G_k}(T_\ell A,T_\ell B) \text{.}
}\]
Assuming $\rho_{A,\ell}$ and $\rho_{B,\ell}$ are isomorphic, we can choose 
a specific isomorphism $f:\rho_{A,\ell}\to \rho_{B,\ell}$. Since 
$\hom_{G_k}(T_\ell A,T_\ell B)$ is a finite rank $\dZ_\ell$-module isomorphic 
to $\hom(A,B)\otimes \dZ_\ell$, the space $\hom(A,B)$ is dense in 
$\hom_{G_k}(T_\ell A,T_\ell B)$. The property ``$f:T_\ell A\to T_\ell B$ is an 
isomorphism'' is open, so there exists $\varphi:A\to B$ such that 
$\varphi_\ast$ is an isomorphism. We claim that $\varphi$ is an isogeny. 
Indeed, let $C=(\ker\varphi)^\circ\subset A$. If $C\ne 0$, then 
$\rank T_\ell C > 0$. This cannot be, because $\varphi_\ast(T_\ell C) = 0$ and 
$\varphi_\ast$ is an isomorphism. Thus $C=0$, so $\ker \varphi$ is finite. By 
dimension considerations, $\varphi$ is an isogeny. 
\end{proof}

Choose a finite place $v$ of $k$ at which $A$ has good reduction. The 
polynomial $P_{A_v}(t)$ is integral, monic, and has degree $2 d$. So we can 
write 
\[
  P_{A_v}(t) = t^{2 d} - a_v(A) t^{2 d-1} + \cdots 
\]
where $a_v(A)=\trace\rho_{A,\ell}(\frob_v)\in \dZ$. We have 
$|a_v(A)|\leqslant 2 g \sqrt{N v}$, since the roots of $P_{A_v}$ have 
absolute value $\sqrt{N v}$. 

If $A=E$ is an elliptic curve over $\dQ$, then this definition of $a_v(E)$ 
agrees with the the standard definition $a_p(E)=p+1-\# E(\dF_p)$. If 
$C$ is a nice curve over $\dQ$ of genus $g$, then for 
$A=\jac C$, we have $\# C(\dF_p) = p+1-a_p(A)$. 

\begin{theorem}
Let $A$ and $B$ be abelian varieties over a number field $k$. Let $S$ be a 
density-zero set of places of $k$, containing the infinite places, as well as 
the bad places for $A$ and $B$. Then $A$ is isogenous to $B$ if and only if 
$a_v(A)=a_v(B)$ for all $v\notin S$. 
\end{theorem}
\begin{proof}
Fix a prime $\ell$. If $A$ and $B$ are isogenous, then 
$\rho_{A,\ell}\simeq \rho_{B,\ell}$, so 
$a_v(A)=\trace(\rho_{A,\ell}(\frob_v))=\trace(\rho_{B,\ell}(\frob_v))=a_v(B)$ 
for all places $v\notin S\cup\{\ell\}$. The converse is an immediate corollary 
of \ref{thm:trace-determines-rep}. and the isogeny theorem 
(\ref{thm:isogeny-thm}). 
\end{proof}

This theorem is not especially useful, because it requires checking 
$a_v(A)=a_v(B)$ at an infinite set of places. The following lemma and its 
corollary give us a way of capturing the isogeny class of an abelian variety 
using a finite amount of data. 





\subsection{Finiteness theorems}

\begin{lemma}[Faltings]
Let $k$ be a number field, $S$ a finite set of places, and $n\geqslant 1$ an 
integer. Then there is a finite set $T$ of places, disjoint from $S$ and 
depending only on $(k,S,n)$, such that if 
$\rho_1,\rho_2:G_{k,S} \to \gl{n}{\dZ_\ell}$ are continuous representations 
with $\trace\rho_1(\frob_v) = \trace \rho_2(\frob_v)$ for all $v\in T$, then 
$\rho_1\simeq \rho_2$. 
\end{lemma}
\begin{proof}
Without loss of generality, we can assume $S$ contains all places dividing 
$\ell$. Let $d = \ell^{2 n^2} = \# M_n(\dF_\ell)\times N_n(\dF_\ell)$. By 
Hermite's theorem, there are only finitely many extensions of $k$ unramified 
outside $S$ with degree $\leqslant d$. Let $K/k$ be a Galois extension 
containing all these and let $G=\gal(K/k)$. The \v Cebotarev density theorem 
tells us that there is a finite set $T$ (disjoint from $S$) of places of $k$ 
such that $G^\natural = \{\frob_v:v\in T\}$. 

Now let $\rho_1,\rho_2$ be as in the statement of the lemma. Set 
$\rho=\rho_1\times\rho_2:G_{k,S} \to \gl{n}{\dZ_\ell}\times \gl{n}{\dZ_\ell}$. 
Let $R$ be the $\dZ_\ell$-subalgebra of 
$M_n(\dZ_\ell)\times M_n(\dZ_\ell)$ generated by the image of $\rho$. Note that 
$R$ is a free $\dZ_\ell$-module of rank at most $2 n^2$. We can consider the 
reduction of $\rho$ modulo $\ell$, i.e. $\bar\rho:G_k \to (R/\ell)^\times$. We 
know that $\# (R/\ell)^\times \leqslant d$, so $\bar\rho$ factors through $G$ 
as in the commutative diagram: 
\[\xymatrix{
  G_k \ar[r]^-{\bar\rho} \ar@{->>}[d] 
    & (R/\ell)^\times \\
  G \ar[ur]
}\]
It follows that $R/\ell$ is generated (as a group) by the images of 
$\{\rho([\frob_v]):\in T\}$. By Nakayama's lemma, $R$ is generated as a 
$\dZ_\ell$-module by $\{\rho([\frob_v]):v\in T\}$. 

Let $\varphi:R \to \dZ/\ell$ be the map $(g,h)\mapsto \trace g-\trace h$. This 
is a homomorphism of $\dZ_\ell$-modules. Assume $a_v(A)=a_v(B)$ for all 
$v\in T$. Then for $v\in T$, we have 
\[
  \varphi(\rho(\frob_v)) = \trace \rho_{A,\ell}(\frob_v) - \trace\rho_{B,\ell}(\frob_v) = a_v(A)-a_v(B) = 0 
\]
This implies $\varphi=0$ since $\varphi$ vanishes on a set of generators of 
$R$. It follows that $\trace \rho_{A,\ell} = \trace\rho_{B,\ell}$. Since 
$\rho_{A,\ell}$ and $\rho_{B,\ell}$ are semisimple, this implies 
$\rho_{A,\ell}\simeq \rho_{B,\ell}$, and the isogeny theorem tells us that 
$A$ and $B$ are isogenous. 
\end{proof}

\begin{corollary}
Let $k$ be a number field, $S$ a finite set of places of $k$ and 
$d\geqslant 1$ an integer. Then there is a finite set $T$ of places of $k$, 
disjoint from $S$ and depending only on $(k,S,d)$, such that if $A$ and $B$ 
are $d$-dimensional abelian varieties with good reduction outside $S$, then 
$A$ and $B$ are isogenous if and only if $a_v(A)=a_v(B)$ for all $v\in T$. 
\end{corollary}

\begin{conjecture}[Shafarevich, for abelian varieties]
Fix a number field $k$ and a finite set $S$ of places, and an integer 
$d\geqslant 1$. Then there are only finitely many isomorphism classes of 
$d$-dimensional abelian varieties over $k$ with good reduction outside $S$. 
\end{conjecture}

Since isogenous abelian varieties have the same dimension and bad primes, 
the conjecture breaks up into two pieces. 

\begin{conjecture}[F1]
Given an abelian variety over $k$, then up to isomorphism there are only 
finitely many abelian varieties over $k$ which are isogenous to $k$. 
\end{conjecture}

\begin{conjecture}[F2]
Let $d\geqslant 1$ be an integer, $k$ a number field and $S$ a finite set of 
places of $S$. Then there are only finitely many isogeny classes of 
$d$-dimensional abelian varieties over $k$ with good reduction outside $S$. 
\end{conjecture}

Faltings proved F1 (he used Faltings heights -- this is hard). There is 
another approach of Masser-W\"ustholz. Zarhin proved that F1 implies the 
Tate conjecture and semisimplicity. This, combined with semisimplicity 
implies F2. 

\begin{proof}[Proof of F2]
Take $A$ over $k$ of dimension $d\geqslant 1$, with good reduction outside $S$. 
Faltings' lemma gives us a finite set $T$ of places for which the isogeny class 
of $A$ is determined by $\{a_v(A):v\in T\}$. Recall that the $a_v(A)$ are 
integers with absolute value $\leqslant 2 g\sqrt{N v}$. It follows that there 
are only finitely many possibilities for the $a_v$, and hence only finitely 
many abelian varieties over $k$ isogenous to $A$. 
\end{proof}

Combining F1 and F2, we get the Shafarevich conjecture for abelian varieties. 
This implies the (actual) Shafarevich conjecture. 

\begin{conjecture}[Shafarevich, for curves]
Fix a number field $k$, an integer $g\geqslant 1$, and a finite set $S$ of 
places of $k$. Then there are only finitely many nice curves over $k$ of genus 
$g$ with good reduction outside $S$. 
\end{conjecture}
\begin{proof}
Let $J$ be the jacobian of $C$. Then $J$ is an abelian variety over $k$ of 
dimension $g$, with good reduction outside $S$. There are only finitely many 
possibilities for $J$ (up to isomorphism). Recall that $C$ is determined by 
$(J,\theta)$. It is a theorem (of Narasim, Nori) from algebraic geometry that 
if $A$ is an abelian variety over an algebraically closed field, then $A$ has 
only finitely many principle polarizations up to $\aut(A)$. Thus there can be 
only finitely many $C$ corresponding to $J$. 
\end{proof}





\subsection{Proof of the Mordell conjecture}

Parshin (1968) proved that the Shafarevich conjecture proves the Mordell 
conjecture (now Faltings' theorem). 

\begin{conjecture}[Mordell]
Let $C$ be a nice curve of genus $g\geqslant 2$ over a number field $k$. Then 
$C(k)$ is finite. 
\end{conjecture}

\begin{lemma}[technical]
Fix a curve $C$ over $k$ of genus $g\geqslant 2$. Then there is a finite 
extension $k'/k$ and a finite set $S'$ of places of $k'$ such that we have the 
following property: for every $x\in C(k)$ there is a finite morphism 
$\varphi_x:W_x \to C_{k'}$ such that $W_x$ is a nice curve over $k'$ with good 
reduction outside $S'$, $\varphi_x$ is ramified only at $x$ (and actually is 
ramified at $x$), and $\deg\varphi_x \leqslant 2\cdot 4^g$. 
\end{lemma}
\begin{proof}
Just a sketch. Assume $C(k)\ne \varnothing$, and we get an embedding 
$j:C\hookrightarrow J=\jac C$. The map ``multiplication by two'' is an 
\'etale self-covering of $J$; we let $\widetilde C$ be the pullback: 
\[\xymatrix{
  \widetilde C \ar[r] \ar[d]^-\varphi 
    & J \ar[d]^-2 \\
  C \ar[r] 
    & J 
}\]
By a theorem of Chevalley-Weil, there is a finite extension $L/k$ such that 
$\varphi^{-1}(x)\subset \widetilde C(L)$ for all $x\in C(k)$. For 
$x\in C(k)$, take distinct $x_1,x_2\in \widetilde C(L)$ such that 
$\varphi(x_i)=x$. Consider $x_1-x_2+2 D=(f)$ in $\jac{\widetilde C}$, for 
some divisor $D\in \divisor(\widetilde C)$ defined over a finite extension 
$k'/L$. (This uses Mordell-Weil.) Let 
$\varphi_x:W_x \to \widetilde C_{k'}$ correspond to the inclusion 
$k'(\widetilde C)\hookrightarrow k'(\widetilde C)[\sqrt f]$ of function 
fields. It's not to hard to show that $W_x$ has the desired properties. 
\end{proof}

Assuming the lemma, we can prove the Mordell conjecture. Suppose $C(k)$ is 
infinite. The lemma gives us morphisms $\varphi_x:W_x \to C_{k'}$ for each 
$x\in C(k)$. The genus of $W_x$ is bounded (using Riemann-Hurwitz) since the 
$\deg\varphi_x$ is bounded and $\varphi_x$ is only ramified only at $x$. 
The Shafarevich conjecture tells us there are only finitely many possibilities 
for the $W_x$. In particular, there exists $W/k'$ that is isomorphic to 
infinitely many $W_x$. We have maps 
$W\xrightarrow\sim W_x \xrightarrow{\varphi_x} C_k$, unramified only at $x$. 
Choose $k'\hookrightarrow\dC$; this gives a morphism 
$\varphi_x:W(\dC) \to C(\dC)$ of compact Riemann surfaces, ramified only at 
$x$. This contradicts the following 

\begin{theorem}[de Franchis, 1913]
If $X,Y$ are compact Riemann surfaces of genus $\geqslant 2$, then there are 
only finitely many non-constant morphisms $X\to Y$. 
\end{theorem}










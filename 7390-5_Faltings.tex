% !TEX root = 7390-notes.tex





\section{Some theorems of Faltings}





\subsection{Background and Tate's conjecture}

The goal of this section is to describe the relationships between a web of 
conjectures that Faltings proved in his groundbreaking paper 
\cite{fa86}. 

Let $A$ be a $d$-dimensional abelian variety over a field $k$. As usual, we 
write $\bar k$ for the algebraic closure of $k$ and $G_k=\gal(\bar k/k)$ for 
the absolute Galois group of $k$. Fix a prime $\ell$ invertible in $k$. The 
groups $A[\ell^n] = \{x\in A(\bar k):\ell^n x=0\}$ are abstractly isomorphic 
to $(\dZ/\ell^n)^{\oplus 2d}$, and carry a continuous action of $G_k$. They 
fit into an inverse system 
\[\xymatrix{
  A[\ell] 
    & A[\ell^2] \ar[l]_-\ell 
    & A[\ell^3] \ar[l]_-\ell 
    & \cdots \ar[l]
}\]
Put 
\[
  T_\ell A = \varprojlim A[\ell^n] = \left\{(x_n)\in \prod A[\ell^n] : \ell x_{n+1} = x_n\right\} \text{.}
\]
This is the \emph{$\ell$-adic Tate module of $A$}. As a $\dZ_\ell$-module, 
$T_\ell A \simeq \dZ_\ell^{\oplus 2 d}$. What makes $T_\ell A$ interesting is 
that it carries a continuous action of $G_k$, induced by the action of $G_k$ 
on the $A[\ell^n]$. In other words, after choosing a basis of $T_\ell A$, we 
have a continuous representation 
\[
  \rho_{A,\ell} : G_k \to \gl{2 d}{\dZ_\ell} \text{.}
\]

The action of $G_k$ on $V_\ell = T_\ell A\otimes\dZ$ factors through 
the smaller group $\operatorname{GSp}(2 n,\dQ_\ell)$. One sees this via the 
\emph{Weil pairing}. Recall that $A^\vee = \picard_A^\circ$, which represents 
the functor 
\[
  T \mapsto \picard^\circ(A_T)/\picard(T) \text{.}
\]
See Section \ref{sec:picard-scheme} for more details. The identity morphism 
in $A^\vee(A^\vee)$ corresponds to an invertible sheaf $\sP$ on 
$A\times A^\vee$, called the \emph{Poincar\'e bundle}. This gives a 
biextension of $(A,A^\vee)$ by $\dG_m$ \cite[VII 2.9.5]{gr72}, and thus, by 
\cite[VIII 2.2]{gr72}, a $G_k$-equivariant pairing 
\[
  e:V_\ell A \times V_\ell A^\vee \to V_\ell \dG_m = \dQ_\ell(1) \text{.}
\]
See \cite[IX 1.0]{gr72} for a brief summary. Choosing a polarization 
$\lambda:A \to A^\vee$, we get an alternating nondegenerate pairing on 
$V_\ell A$, so after a suitable change of basis, the image of 
$\rho_{A,\ell}$ lands inside $\operatorname{GSp}(2 d,\dQ_\ell)$. We will mostly 
just think of $\rho_{A,\ell}$ as a representation with values in 
$\gl{2d}{\dZ_\ell}$ or $\gl{2d}{\dQ_\ell}$. It is 
natural to ask how much $\rho_{A,\ell}$ ``knows about'' $A$, especially if $k$ 
is a number field, or more generally, a finitely generated field. 

Let $X$ be a nice variety over a finitely generated field $k$. For each $i$, 
there is a canonical homomorphism 
\[
  \operatorname{cl}:\chow^i(X) \to \h^{2 i}(X,\dQ_\ell)(i)\text{,}
\]
defined in \cite[VI 2.2.10]{de77}. One calls $\operatorname{cl}(Z)$ the 
cohomology class associated with a cycle $Z$. 

\begin{conjecture}[Tate]
The set $\h^{2 i}(X,\dQ_\ell)(i)^{G_k}$ is the $\dQ_\ell$-subspace of $\h^{2 i}(X,\dQ_\ell)$ 
generated by $\operatorname{cl}(\chow^i(X))$. 
\end{conjecture}

This is essentially Conjecture 1 in \cite{ta65}. Often, ``the Tate conjecture'' 
means the following special case. 

\begin{conjecture}[Tate]
Let $A,B$ be abelian varieties over a finitely generated field $k$. For any 
prime $\ell$ invertible in $k$, the natural map 
\[
  \hom_k(A,B)\otimes\dQ_\ell \to \hom_{G_k}(V_\ell A, V_\ell B) \text{,}
\]
is a bijection. 
\end{conjecture}

See the remarks after Conjecture 1 in Tate's paper for a proof that the second 
conjecture follows from the first. Another way of stating the (second version 
of the) Tate conjecture is that for any finitely generated field $k$, the 
functor $V_\ell:\mathsf{AbVar}_k^\text{iso} \to \mathsf{Rep}_{G_k}(\dQ_\ell)$ 
is fully faithful. 

\begin{example}
Let $k=\dF_q$ be a finite field. Then $G_k$ is naturally isomorphic to 
$\widehat\dZ$, the profinite completion of $\dZ$. Here $1\in \widehat\dZ$ 
corresponds to the \emph{arithmetic Frobenius} $\frob_q\in G_{\dF_q}$, given by 
$x\mapsto x^q$. Representations 
$\rho:G_{\dF_q} \to \gl{n}{\dQ_\ell}$ are determined by 
$\rho(\frob_q)$. If such a representation is semisimple, the 
\emph{Brauer-Nesbitt theorem} tells us that $\rho$ is determined by the 
characteristic polynomial of $\rho(\frob_q)$. For an abelian variety $A$ over 
$\dF_q$, we know that the characteristic polynomial of 
$\rho_{A,\ell}(\frob_q)$ is $P_A(t)\in \dZ[t]$, which determines $A$ up to 
isogeny by Honda-Tate theory. 
\end{example}

Since we will be using characteristic polynomials quite a lot, let us state a 
suitably general version of the Brauer-Nesbitt theorem. Fix a field $k$, and 
for an arbitrary group $G$, let $K_0(G)$ denote the Grothendieck group of 
finite-dimensional $k$-representations of $G$. By the ``characteristic 
polynomial'' of a representation $\rho:G \to \operatorname{GL}_k(V)$, we mean 
the formal power series 
\[
  \chi_\rho(g) = \frac{1}{\det(1-\rho(g)\cdot t, V)} \in \Lambda(k) = 1+t k\llbracket t\rrbracket \text{.}
\]

\begin{theorem}[Brauer-Nesbitt]
If $S$ spans $k[G]$ as a $k$-vector space, then the map 
$\chi:K_0(G) \to \Lambda(k)^S$ given by $[\rho]\mapsto \chi_\rho$ is an 
injection. 
\end{theorem}
\begin{proof}
This is Theorem 5.21 of \cite{eg11}. 
\end{proof}

\begin{corollary}
If $G$ is a group and $\rho_1,\rho_2:G \to \operatorname{GL}_k(V)$ are two 
semisimple representations with equal characteristic polynomials, then 
$\rho_1\simeq \rho_2$. 
\end{corollary}






% notes on 11-26-2013

\begin{theorem}[Faltings' isogeny theorem]
Let $A$ and $B$ be abelian varieties over a number field $k$. For any prime 
$\ell$, we have $\rho_{A,\ell}\simeq \rho_{B,\ell}$ as $G_k$-modules if and 
only if $A$ and $B$ are isogenous over $k$. 
\end{theorem}

From this, we see that we can fruitfully study $A$ via $\rho_{A,\ell}$. For 
example, the rank of an abelian variety only depends on its isogeny class, so 
$\rank A$ only depends on $\rho_{A,\ell}$. 

If $k$ is either finite or a global field, the representation $\rho_{A,\ell}$ 
is semisimple, so $\rho_{A,\ell}$ is determined by the characteristic 
polynomial of $\rho_{A,\ell}(\frob_q)$. For this, one needs the 
\emph{\v Cebotarev density theorem}. 

\textbf{(add details here or later)}





\subsection{Image of Frobenius for number fields}

Fix a number field $k$, and a finite place $v$ of $k$. Let 
$\fp\subset \fo=\fo_k$ be the corresponding maximal ideal. Let $k_v$ be the 
completion of $k$ at $v$. We choose $\bar k\subset \overline{k_v}$; this gives 
a map $G_{k_v} \to G_k$, defined by $\sigma\mapsto \sigma|_{\bar k}$. This map 
is only well-defined up to conjugation. In fact, this map is an injection. 
Reduction modulo $\fp$ gives a homomorphism 
$G_{k_v} \to G_{\kappa_v}=\widehat\dZ$, where $\kappa_v = \fo_v/\fp$ is the 
residue field of $\fp$. This map is surjective, so we have an exact sequence 
(where we write $D_v$ for the image of $G_{k_v}$ in $G_k$):
\[\xymatrix{
  1 \ar[r] 
    & I_v \ar[r] 
    & D_v \ar[r] 
    & \widehat\dZ \ar[r] 
    & 1
}\]
The group $G_{\kappa_v}$ is procyclic, with generator 
$\frob_{N v}$ where $N v = \# \kappa_v$. Write $\frob_v$ for a lift of 
$\frob_{N v}$ to $D_v$. The element $\frob_v\in G_k$ is only well-defined up to 
conjugacy and multiplication by $I_v$. 

As before, let $A$ be an abelian variety over $k$ with good reduction at $v$. 
In other words, there exists an abelian scheme $\cA$ over $\fo_v$ whose generic 
fiber is $A_{k_v}$. (As in a cartesian diagram:
\[\xymatrix{
  A_v \ar[r] \ar[d] 
    & \cA_v \ar[d] 
    & A_{k_v} \ar[l] \ar[d] \\
  \spec(\kappa_v) \ar[r] 
    & \spec(\fo_v) 
    & \spec(k_v) \ar[l] 
}\]
so that $A_v = \cA_{\kappa_v}$. In particular, $A_v$ is an abelian variety over 
$\kappa_v$, and we have a reduction map 
\[
  A(k_v) = \cA(\fo_v) \to \cA(\kappa_v) = A_v(\kappa_v) \text{.}
\]
Extending to algebraic closures, we get a map 
$A(\overline{k_v}) \to A_v(\overline{\kappa_v})$. This is a homomorphism with 
pro-$p$ kernel. Let $\ell\nmid N v$. At the level of torsion, we have 
isomorphisms 
\[
  A(\overline{k_v})[\ell^n] \to A_v(\overline{\kappa_v})[\ell^n]
\]
(the map is injective since its kernel is pro-$p$, and it's surjective by 
cardinality considerations: both groups have size $(\ell^n)^{2 d}$). This gives 
us an isomorphism 
$A(\bar k)[\ell^n] = A(\overline{k_v})[\ell^n]\xrightarrow\sim A_v(\kappa_v)[\ell^n]$. 
These groups have (compatible) actions of $G_k$, $G_{k_v}$ and $G_{\kappa_v}$. In 
particular, the inertia group $I_v$ acts trivially on $A(\bar k)[\ell^n]$. 

\textbf{(mention Ogg-N\'eron-Shafarevich)}

Summarizing: we have a well-defined action of $\frob_v$ on $A[\ell^n]$. 
Patching, $\frob_v$ has a well-defined action on $T_\ell A$. (This action 
matches the action of $\frob_{N v}$ on $T_\ell A_v$.) 

\begin{theorem}
Let $A$ be an abelian variety over $k$ with good reduction at $v$. Then 
\begin{enumerate}
  \item $\rho_{A,\ell}$ is unramified at $v$ (i.e. $\rho_{A,\ell}(I_v) = 1$) 
  \item Moreover, $\rho_{A,\ell}$ is well-defined up to conjugacy and has 
    characteristic polynomial $P_{A_v}(t)$ with integer coefficients that are 
    independent of $\ell$. 
\end{enumerate}
\end{theorem}

(\textbf{mention Serre's version using Haar measures})

Recall the \v Cebotarev density theorem. Let $L/k$ be a finite Galois extension 
of number fields. For $v$ unramified in $L/k$, there is a well-defined 
conjugacy class $[\frob_v]$ in $\gal(L/k)$. Take any conjugacy class $C$ in 
$\gal(L/k)$. Then 
\[
  \lim_{x \to \infty} \frac{\{\# v : N v \leqslant x \text{ and } [\frob_v]=C\}}{\# \{v:N v\leqslant x\}} = \frac{\# C}{\# \gal(L/k)}
\]
(In particular, each conjugacy class is the Frobenius for infinitely many 
primes.) 

For example, if $L=\dQ(\zeta_n)$, then $\gal(L/\dQ)$ is naturally isomorphic to 
$(\dZ/n)^\times$. For $p\nmid n$, one has $\frob_p \mapsto p\in (\dZ/n)^\times$. 
Dirichlet's theorem says that for $a\in (\dZ/n)^\times$, there exist infinitely 
many $p$ such that $p\equiv a\pmod n$. 

(\textbf{sort all this out})

\begin{theorem}[N\'eron-Ogg-Shafarevich]
Let $A$ be an abelian variety over a number field $k$. Let $v$ be a place of 
$k$, and let $\ell$ be a prime with $v\nmid \ell$. Then $A$ has good reduction 
at $v$ if and only if $\rho_{A,\ell}$ is unramified at $v$. 
\end{theorem}
\begin{proof}
Find Serre-Tate paper.
\end{proof}

Let's define the $L$-function of a general abelian variety. For a place $v$, 
choose a prime $\ell$ with $v\nmid \ell$. The action of 
$\frob_v$ on $T_\ell A$ is only well-defined up to the action of 
$I_v$. So $(T_\ell A)^{I_v}$ has a well-defined action of $\frob_v$. Set 
\[
  L_v(A,t) = \det\left(1-\rho_{A,\ell}(\frob_v)\cdot t,(T_\ell A)^{I_v}\right) \text{.}
\]
(This is the revere of $P_{A_v}(t)$ if $A$ has good reduction at $v$.) We define 
\[
  L(A,s) = \prod_{v\nmid \infty} L_v(A,(N v)^{-s}) \text{.}
\]

If $A=E$ is an elliptic curve over $\dQ$, then 
\[
  \rank_{\dZ_\ell} (T_\ell E)^{I_p}
  =
  \begin{cases}
    2 & \text{good reduction} \\
    1 & \text{mult. reduction} \\
    0 & \text{add. reduction}
  \end{cases}
\]

\textbf{(work on compatibility between this and classical definition of 
local factors at bad places.)}

The function $L(A,s)$ should have an analytic continuation, functional equation, 
it should satisfy BSD ($\ord_{s=1} L(A,s) = \rank_\dZ A(\dQ)$), and a ``fancy BSD'' 
with a precise prediction of the coefficient in Taylor series. 

The function $L(A,s)$ converges on some region $\{\Im s>c\}$. 





% notes on 12-03-2013

As before, let $A$ be a $d$-dimensional abelian variety over a number field 
$k$. Fix a prime $\ell$. As we have seen, there is a continuous representation 
\[
  \rho_{A,\ell} : G_k \to \gl{2 d}{\dZ_\ell} \text{,}
\]
coming from the action of $G_k$ on the $\ell$-adic Tate module of $A$. Let $v$ 
be a finite place of $k$, corresponding to a prime $\fp\subset \fo_k$. Recall 
that $A$ has good reduction at $v$ if and only if $\rho_{A,\ell}$ is unramified 
at $v$, i.e. $\rho_{A,\ell}(I_v)=1$, where $I_v\subset G_k$ is an inertia 
group of $v$. Choose $\frob_v\in G_k$, such that $\frob_v$ maps to the usual 
Frobenius under $D_v \twoheadrightarrow G_{\kappa_v}$. For $v\nmid \ell$ at 
which $A$ has good reduction, the element 
$\rho_{A,\ell}(\frob_v)\in \gl{2 d}{\dZ_\ell}$ is well-defined up 
to conjugacy. So the characteristic polynomial 
$\det(t\cdot 1-\rho_{A,\ell}(\frob_v)$ is well-defined. Even better, this 
polynomial, \emph{a priori} an element of $\dZ_\ell[t]$, is equal to 
$P_{A_v}(t)$, so it is an element of $\dZ[t]$, independent of $\ell$. By the 
\v Cebotarev density theorem, the conjugacy classes $\{\frob_v\}$ are dense 
in $G_k$, so the map 
$\sigma\mapsto \det(1\cdot t-\rho_{A,\ell}(\sigma))$ is determined by the 
$P_{A_v}$. 

Let $\varphi:A\to B$ be a morphism of abelian varieties. This induces a 
$G_k$-equivariant morphism $\varphi_\ast:T_\ell A \to T_\ell B$. If $\varphi$ 
is an isogeny, then $\varphi_\ast$ is an isomorphism after tensoring with 
$\dQ$. In particular, if we think of $\rho_{A,\ell}$ as a 
$\dQ_\ell$-representation, then $\rho_{A,\ell}\simeq \rho_{B,\ell}$. It follows 
that $A$ and $B$ have the same bad primes. 

In general, we have a map 
\[
  \hom(A,B) \to \hom_{G_k}(T_\ell A,T_\ell B)
\]
The following properties were conjectured by Tate and proved by Faltings. 
\begin{enumerate}
  \item (Semisimplicity) The representation 
    $\rho_{A,\ell}:G_k \to \gl{2 d}{\dQ_\ell}$ is semisimple. 
    Equivalently, $V_\ell A = V_1 \oplus \cdots \oplus V_r$, where each 
    $V_r$ is an irreducible $G_k$-module. 
  \item (Tate conjecture) There is an isomorphism 
    \[
      \hom(A,B)\otimes\dQ_\ell \to \hom_{G_k}(V_\ell A,V_\ell B) \text{.}
    \]
\end{enumerate}

Tate proved these conjectures over a finite field. This implies the injectivity 
part of Honda-Tate. 

\begin{theorem}[Isogeny theorem]
Abelian varieties $A$ and $B$ over a number field $k$ are isogenous if and only 
if $\rho_{A,\ell}$ and $\rho_{B,\ell}$ are isomorphic. 
\end{theorem}
\begin{proof}
We've already shown that if $A$ and $B$ are isogenous, then 
$\rho_{A,\ell}\simeq \rho_{B,\ell}$. The Tate conjecture gives us an 
isomorphism 
\[\xymatrix{
  \hom(A,B)\otimes\dQ_\ell \ar[r]^-\sim 
    & \hom_{G_k}(V_\ell A,V_\ell B) \text{.}
}\]
Assuming $\rho_{A,\ell}$ and $\rho_{B,\ell}$ are isomorphic, we can choose 
a specific isomorphism $f:\rho_{A,\ell}\to \rho_{B,\ell}$. We know that 
$\hom(A,B)\simeq \dZ \alpha_1\oplus \cdots \oplus \dZ \alpha_s$, so we have 
$f=\sum m_i \alpha_i$ with the $m_i\in \dQ_\ell$. Without loss of generality, 
we can assume $m_i\in \dZ_\ell$. Let $\varphi=\sum n_i \alpha_i$, where the 
$n_i\in \dZ$ are ``sufficiently close'' to $m_i\in \dZ_\ell$. We have a map 
$\varphi_\ast:V_\ell A \to V_\ell B$, which we claim is an isomorphism. 
This follows from the fact that isomorphisms are open in 
$\hom_{G_k}(V_\ell A,V_\ell B)$. We claim that $\varphi$ is an isogeny. 
Let $C=(\ker\varphi)^\circ\subset A$. If $C\ne 0$, then $\varphi(C[\ell^n])=0$ 
for all $n$, so $\varphi_\ast(V_\ell C)=0$. This cannot be, because 
$\dim V_\ell C>0$. Thus $C=0$, so $\ker C$ is finite, so $\varphi$ is an 
isogeny. 
\end{proof}

Choose a finite place $v$ of $k$ at which $A$ has good reduction. The 
polynomial $P_{A_v}(t)$ is integral, monic, and has degree $2 d$. So we can 
write 
\[
  P_{A_v}(t) = t^{2 d} - a_v(A) t^{2 d-1} + \cdots 
\]
where $a_v(A)\in \dZ$. We have $|a_v(A)|\leqslant 2 g \sqrt{N v}$ since the 
roots of $P_{A_v}$ have absolute value $\sqrt{N v}$. 

If $A=E$ is an elliptic curve over $\dQ$, then this definition of $a_v(E)$ 
agrees with the the standard definition $a_p(E)=p+1-\# E(\dF_p)$. If 
$C$ is a nice curve over $\dQ$ of genus $g$, then for 
$A=\jac C$, we have $\# C(\dF_p) = p+1-a_p(A)$. 

\begin{theorem}
Let $A$ and $B$ be abelian varieties over a number field $k$. Let $S$ be a
finite set of places of $k$, containing the infinite places, as well as the 
bad places for $A$ and $B$. Then $A$ is isogenous to $B$ if and only if 
$a_v(A)=a_v(B)$ for all $v\notin S$. 
\end{theorem}
\begin{proof}
Fix a prime $\ell$. If $A$ and $B$ are isogenous, then 
$\rho_{A,\ell}\simeq \rho_{B,\ell}$, so 
$a_v(A)=\trace(\rho_{A,\ell}(\frob_v))=\trace(\rho_{B,\ell}(\frob_v))=a_v(B)$ 
for all places $v\notin S\cup\{\ell\}$. 

Now we prove the converse. We know that $\rho_{A,\ell}$ is semisimple, so its 
character $\chi=\trace\circ \rho_{A,\ell}:G_k \to \dQ_\ell$ determines 
$\rho_{A,\ell}$ by Brauer-Nesbitt. The function $\chi$ is determined by its 
values $\chi(\frob_v)$ with $v\notin S$, since $\chi$ is continuous and the 
$\frob_v$ are dense in $G_k$. But 
$\chi(\frob_v)=\trace \rho_{A,\ell}(\frob_v) = a_v(A)$, so $\{a_v(A)\}$ 
determines $\rho_{A,\ell}$, and hence the isogeny class of $A$. 
\end{proof}

(You could also just say all $v$ in a density-one set of places.) 





% notes on 12-05-2013

Let $A$ be a $d$-dimensional abelian variety over a number field $k$. For any 
prime $\ell$, the group $G_k=\gal(\bar k/k)$ acts on $T_\ell A$, giving a 
representation 
$\rho_{A,\ell}:G_k \to \aut_{\dQ_\ell}(V_\ell A) \simeq \gl{2 d}{\dQ_\ell}$. 
For a (finite) place $v\nmid \ell$ for which $A$ has good reduction, the 
representation $\rho_{A,\ell}$ is unramified at $v$. Moreover, the 
characteristic polynomial $\det(t-\rho_{A,\ell}(\frob_v))$ is equal to 
$P_{A_v}(t)\in \dZ[t]$, so it is independent of $\ell$. 

Recall we proved that if $A$ and $B$ are abelian varieties over $k$, then 
$A$ and $B$ are isogenous if and only if $\rho_{A,\ell}\simeq \rho_{B,\ell}$. 
Taking traces, we got that $A$ and $B$ are isogenous if and only if 
$a_v(A)=a_v(B)$ for a density-one set of places. 

\begin{lemma}[Faltings]
Take $d$-dimensional abelian varieties $A,B$ over a number field $k$, with good 
reduction outside a finite set of places $S$. Then there is a finite set $T$ of 
places, disjoint from $S$, and depending only on $(k,S,d)$, such that 
$A$ and $B$ are isogenous if and only if $a_v(A)=a_v(B)$ for all $v\in T$. 
\end{lemma}
\begin{proof}
Without loss of generality, we can assume $S$ contains all places dividing 
$\ell$. We have a representation 
$\rho_{A,\ell}:G_k \to \gl{2 d}{\dZ_\ell}$ and similarly for 
$B$. Let 
$\rho=\rho_{A,\ell}\times \rho_{B,\ell}:G_k \to \gl{2d}{\dZ_\ell}\times \gl{2d}{\dZ_\ell}$. 
Let $R$ be the $\dZ_\ell$-subalgebra of $M_{2 d}(\dZ_\ell)\times M_{2 d}(\dZ_\ell)$ 
generated by the image of $\rho$. Note that $R$ is a free $\dZ_\ell$-module of 
rank at most $8 d^2$. We can consider the reduction of $\rho$ modulo $\ell$, 
i.e. $\bar\rho:G_k \to (R/\ell)^\times$. We know that 
$\# (R/\ell)^\times \leqslant \ell^{8 g^2}$, and that $\bar\rho$ is unramified 
outside $S$. Recall that a theorem of Hermite says that there exists a finite 
extension $K/k$ such that if $L/k$ is unramified outside $S$ and 
$[L:k]\leqslant \ell^{8 d^2}$, then $L\subset K$. We can take $K$ minimal with 
respect to this property. We have a commutative diagram: 
\[\xymatrix{
  G_k \ar[r]^-{\bar\rho} \ar@{->>}[d] 
    & (R/\ell)^\times \\
  \gal(K/k) \ar[ur]
}\]
The \v Cebotarev density theorem tells us that there is a finite set $T$ of 
places (disjoint from $S$) such that all conjugacy classes of $\gal(K/k)$ are 
all of the form $[\frob_v]$ for $v\in T$. 
(We could have used "effective Hilbert irreducibility" or effective 
\v Cebotarev to make this effective.) 
We know that $\bar\rho(G_k)$ is generated by $\{\bar\rho([\frob_v]):v\in T\}$, 
so $R/\ell$ is generated (as a group) by the images of 
$\{\rho([\frob_v]):\in T\}$. By Nakayama's lemma, $R$ is generated, as a 
$\dZ_\ell$-module, by $\{\rho([\frob_v]):v\in T\}$. 

Let $\varphi:R \to \dZ/\ell$ be the map $(g,h)\mapsto \trace g-\trace h$. This 
is a homomorphism of $\dZ_\ell$-modules. Assume $a_v(A)=a_v(B)$ for all 
$v\in T$. Then for $v\in T$, we have 
\[
  \varphi(\rho(\frob_v)) = \trace \rho_{A,\ell}(\frob_v) - \trace\rho_{B,\ell}(\frob_v) = a_v(A)-a_v(B) = 0 
\]
This implies $\varphi=0$ since $\varphi$ vanishes on a set of generators of 
$R$. It follows that $\trace \rho_{A,\ell} = \trace\rho_{B,\ell}$. Since 
$\rho_{A,\ell}$ and $\rho_{B,\ell}$ are semisimple, this implies 
$\rho_{A,\ell}\simeq \rho_{B,\ell}$, and the isogeny theorem tells us that 
$A$ and $B$ are isogenous. 
\end{proof}

\begin{conjecture}[Shafarevich, for abelian varieties]
Fix a number field $k$ and a finite set $S$ of places, and an integer 
$d\geqslant 1$. Then there are only finitely many isomorphism classes of 
$d$-dimensional abelian varieties over $k$ with good reduction outside $S$. 
\end{conjecture}

Since isogenous abelian varieties have the same dimension and bad primes, 
the conjecture breaks up into two pieces. 

\begin{conjecture}[F1]
Given an abelian variety over $k$, then up to isomorphism there are only 
finitely many abelian varieties over $k$ which are isogenous to $k$. 
\end{conjecture}

\begin{conjecture}[F2]
Let $d\geqslant 1$ be an integer, $k$ a number field and $S$ a finite set of 
places of $S$. Then there are only finitely many isogeny classes of 
$d$-dimensional abelian varieties over $k$ with good reduction outside $S$. 
\end{conjecture}

Faltings proved F1 (he used Faltings heights -- this is hard). There is 
another approach of Masser-W\"ustholz. Zarhin proved that F1 implies the 
Tate conjecture and semisimplicity. This, combined with semisimplicity 
implies F2. 

\begin{proof}[Proof of F2]
Take $A$ over $k$ of dimension $d\geqslant 1$, with good reduction outside $S$. 
Faltings' lemma gives us a finite set $T$ of places for which the isogeny class 
of $A$ is determined by $\{a_v(A):v\in T\}$. Recall that the $a_v(A)$ are 
integers with absolute value $\leqslant 2 g\sqrt{N v}$. It follows that there 
are only finitely many possibilities for the $a_v$, and hence only finitely 
many abelian varieties over $k$ isogenous to $A$. 
\end{proof}

Combining F1 and F2, we get the Shafarevich conjecture for abelian varieties. 
This implies the (actual) Shafarevich conjecture. 

\begin{conjecture}[Shafarevich, for curves]
Fix a number field $k$, an integer $g\geqslant 1$, and a finite set $S$ of 
places of $k$. Then there are only finitely many nice curves over $k$ of genus 
$g$ with good reduction outside $S$. 
\end{conjecture}
\begin{proof}
Let $J$ be the jacobian of $C$. Then $J$ is an abelian variety over $k$ of 
dimension $g$, with good reduction outside $S$. There are only finitely many 
properties for $J$ (up to isomorphism). Recall that $C$ is determined by 
$(J,\theta)$. It is a theorem (of Narasim, Nori) from algebraic geometry that 
if $A$ is an abelian variety over an algebraically closed field, then $A$ has 
only finitely many principle polarizations up to $\aut(A)$. Thus there can be 
only finitely many $C$ corresponding to $J$. 
\end{proof}

Parshin (1968) proved that the Shafarevich conjecture proves the Mordell 
conjecture (now Faltings' theorem). 

\begin{conjecture}[Mordell]
Let $C$ be a nice curve of genus $g\geqslant 2$ over a number field $k$. Then 
$C(k)$ is finite. 
\end{conjecture}

\begin{lemma}[technical]
Fix a curve $C$ over $k$ of genus $g\geqslant 2$. Then there is a finite 
extension $k'/k$ and a finite set $S'$ of places of $k'$ such that we have the 
following property: for every $x\in C(k)$ there is a finite morphism 
$\varphi_x:W_x \to C_{k'}$ such that $W_x$ is a nice curve over $k'$ with good 
reduction outside $S'$, $\varphi_x$ is ramified only at $x$ (and actually is 
ramified at $x$), and $\deg\varphi_x \leqslant 2\cdot 4^g$. 
\end{lemma}
\begin{proof}
Just a sketch. Assume $C(k)\ne \varnothing$, and we get an embedding 
$j:C\hookrightarrow J=\jac C$. The map ``multiplication by two'' is an 
\'etale self-covering of $J$; we let $\widetilde C$ be the pullback: 
\[\xymatrix{
  \widetilde C \ar[r] \ar[d]^-\varphi 
    & J \ar[d]^-2 \\
  C \ar[r] 
    & J 
}\]
By a theorem of Chevalley-Weil, there is a finite extension $L/k$ such that 
$\varphi^{-1}(x)\subset \widetilde C(L)$ for all $x\in C(k)$. For 
$x\in C(k)$, take distinct $x_1,x_2\in \widetilde C(L)$ such that 
$\varphi(x_i)=x$. Consider $x_1-x_2+2 D=(f)$ in $\jac{\widetilde C}$, for 
some divisor $D\in \divisor(\widetilde C)$ defined over a finite extension 
$k'/L$. (This uses Mordell-Weil.) Let 
$\varphi_x:W_x \to \widetilde C_{k'}$ correspond to the inclusion 
$k'(\widetilde C)\hookrightarrow k'(\widetilde C)[\sqrt f]$ of function 
fields. It's not to hard to show that $W_x$ has the desired properties. 
\end{proof}

Assuming the lemma, we can prove the Mordell conjecture. Suppose $C(k)$ is 
infinite. The lemma gives us morphisms $\varphi_x:W_x \to C_{k'}$ for each 
$x\in C(k)$. The genus of $W_x$ is bounded (using Riemann-Hurwitz) since the 
$\deg\varphi_x$ is bounded and $\varphi_x$ is only ramified only at $x$. 
The Shafarevich conjecture tells us there are only finitely many possibilities 
for the $W_x$. In particular, there exists $W/k'$ that is isomorphic to 
infinitely many $W_x$. We have maps 
$W\xrightarrow\sim W_x \xrightarrow{\varphi_x} C_k$, unramified only at $x$. 
Choose $k'\hookrightarrow\dC$; this gives a morphism 
$\varphi_x:W(\dC) \to C(\dC)$ of compact Riemann surfaces, ramified only at 
$x$. This contradicts the following 

\begin{theorem}[de Franchis, 1913]
If $X,Y$ are compact Riemann surfaces of genus $\geqslant 2$, then there are 
only finitely many non-constant morphisms $X\to Y$. 
\end{theorem}

\[\xymatrix{
  \mathsf R f_\ast \sK \overset{\mathsf L}{\boxtimes}\mathsf R g_\ast \sL \ar[r]^-\sim 
    & \mathsf Rh_\ast (\sK\overset{\mathsf L}{\boxtimes} \sL) 
}\]









